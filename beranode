#!/usr/bin/env bash
#
# beranode - CLI for managing Berachain nodes
#
# This file is auto-generated by build.sh from modular sources in src/
# Do not edit this file directly. Instead, edit the source files and rebuild.
#
# Usage: beranode <command> [options]
#

set -e


# =============================================================================
# constants
# Source: lib/constants.sh
# =============================================================================

BERANODE_VERSION="0.2.0"  # Managed by scripts/bump-version.sh - do not edit manually

# =============================================================================
# Get platform
# =============================================================================
# Detect if running on Windows (PowerShell), Linux, or macOS
readonly PLATFORM=$(uname)
if [[ "$PLATFORM" == "Darwin" ]]; then
    readonly IS_MACOS=true
    readonly IS_LINUX=false
    readonly IS_WINDOWS=false
elif [[ "$PLATFORM" == "Linux" ]]; then
    readonly IS_MACOS=false
    readonly IS_LINUX=true
    readonly IS_WINDOWS=false
elif [[ "$PLATFORM" == MINGW* ]] || [[ "$PLATFORM" == CYGWIN* ]] || [[ "$PLATFORM" == MSYS* ]]; then
    readonly IS_MACOS=false
    readonly IS_LINUX=false
    readonly IS_WINDOWS=true
else
    readonly IS_MACOS=false
    readonly IS_LINUX=false
    readonly IS_WINDOWS=false
    echo "error: unsupported platform: '${PLATFORM}'" >&2
    exit 1
fi

# Temporary
if [ "$IS_MACOS" == false ]; then
    local_red='\033[0;31m'
    local_reset='\033[0m'
    echo -e "${local_red}[ERROR] This script currently only supports macOS. Linux and Windows support coming soon.${local_reset}" >&2
    exit 1
fi


if [[ $(uname) == "Darwin" ]]; then
    readonly SED_OPT=(-i '')
else
    readonly SED_OPT=(-i)
fi

# =============================================================================
# Network Chain IDs and Names
# =============================================================================

# Network chain IDs (enforced)
readonly CHAIN_ID_DEVNET=80087
readonly CHAIN_NAME_DEVNET="devnet"
readonly CHAIN_ID_TESTNET=80069
readonly CHAIN_NAME_TESTNET="bepolia"
readonly CHAIN_ID_MAINNET=80094
readonly CHAIN_NAME_MAINNET="mainnet"
readonly GENESIS_DEPOSIT_AMOUNT=250000000000000

# =============================================================================
# Default Ports
# =============================================================================

readonly DEFAULT_CL_ETHRPC_PORT=26657
readonly DEFAULT_CL_ETHP2P_PORT=26656
readonly DEFAULT_CL_ETHPROXY_PORT=26658
readonly DEFAULT_EL_ETHRPC_PORT=8545
readonly DEFAULT_EL_AUTHRPC_PORT=8551
readonly DEFAULT_DEFAULT_EL_ETH_PORT=30303
readonly DEFAULT_EL_PROMETHEUS_PORT=9101
readonly DEFAULT_CL_PROMETHEUS_PORT=9102
readonly DEFAULT_PORT_INCREMENT=100
readonly DEFAULT_WALLET_BALANCE=1000000000000000000000000000

# =============================================================================
# Binary Names
# =============================================================================

readonly BIN_BEACONKIT="beacond"
readonly BIN_BERARETH="bera-reth"

# =============================================================================
# Beranodes Directory Structure
# =============================================================================

readonly BERANODES_PATH_BIN="/bin"
readonly BERANODES_PATH_TMP="/tmp"
readonly BERANODES_PATH_LOG="/log"
readonly BERANODES_PATH_NODES="/nodes"

readonly SUPPORTED_CAST_VERSION="1.4.3"
BERANODES_PATH=${BERANODES_PATH:-$(pwd)/beranodes}

# =============================================================================
# Repositories
# =============================================================================
readonly RELEASE_BERARETH="https://api.github.com/repos/berachain/bera-reth/releases/latest"
readonly RELEASE_BEACONKIT="https://api.github.com/repos/berachain/beacon-kit/releases/latest"
readonly REPO_BEACONKIT="https://raw.githubusercontent.com/berachain/beacon-kit/refs/heads/main/testing/networks/80094"

# =============================================================================
# Default Genesis Contracts
# =============================================================================
# These contracts are deployed at genesis with pre-set addresses.
# This ensures critical infrastructure exists from block 0.

# --- EIP-4788 Beacon Roots Contract ---
# Address: 0x000F3df6D732807Ef1319fB7B8bB8522d0Beac02
# Purpose: Stores beacon chain block roots, allowing smart contracts to
# trustlessly access consensus layer data (validator info, etc.)
# Required for Cancun-enabled networks (EIP-4788)
ETH_GENESIS_BEACON_ROOTS_ADDRESS="0x000F3df6D732807Ef1319fB7B8bB8522d0Beac02"
ETH_GENESIS_BEACON_ROOTS_CODE="0x3373fffffffffffffffffffffffffffffffffffffffe14604d57602036146024575f5ffd5b5f35801560495762001fff810690815414603c575f5ffd5b62001fff01545f5260205ff35b5f5ffd5b62001fff42064281555f359062001fff015500"
ETH_GENESIS_BEACON_ROOTS_BALANCE="0x0"
ETH_GENESIS_BEACON_ROOTS_NONCE="0x1"

# --- CREATE2 Deployer (Deterministic Deployment Proxy) ---
# Address: 0x4e59b44847b379578588920cA78FbF26c0B4956C
# Purpose: Allows deploying contracts to deterministic addresses using CREATE2
# The same contract deployed with same bytecode + salt = same address on any chain
# This is a standard address used across many EVM chains
ETH_GENESIS_CREATE2_DEPLOYER_ADDRESS="0x4e59b44847b379578588920cA78FbF26c0B4956C"
ETH_GENESIS_CREATE2_DEPLOYER_CODE="0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe03601600081602082378035828234f58015156039578182fd5b8082525050506014600cf3"
ETH_GENESIS_CREATE2_DEPLOYER_BALANCE="0x0"
ETH_GENESIS_CREATE2_DEPLOYER_NONCE="0x1"

# --- Multicall3 ---
# Address: 0xcA11bde05977b3631167028862bE2a173976CA11
# Purpose: Batch multiple read-only calls into a single RPC request
# Essential for efficient dApp frontends and indexers
# Standard deployment address across EVM chains
ETH_GENESIS_MULTICALL3_ADDRESS="0xcA11bde05977b3631167028862bE2a173976CA11"
ETH_GENESIS_MULTICALL3_CODE="0x6080604052600436106100f35760003560e01c80634d2301cc1161008a578063a8b0574e11610059578063a8b0574e1461025a578063bce38bd714610275578063c3077fa914610288578063ee82ac5e1461029b57600080fd5b80634d2301cc146101ec57806372425d9d1461022157806382ad56cb1461023457806386d516e81461024757600080fd5b80633408e470116100c65780633408e47014610191578063399542e9146101a45780633e64a696146101c657806342cbb15c146101d957600080fd5b80630f28c97d146100f8578063174dea711461011a578063252dba421461013a57806327e86d6e1461015b575b600080fd5b34801561010457600080fd5b50425b6040519081526020015b60405180910390f35b61012d610128366004610a85565b6102ba565b6040516101119190610bbe565b61014d610148366004610a85565b6104ef565b604051610111929190610bd8565b34801561016757600080fd5b50437fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0140610107565b34801561019d57600080fd5b5046610107565b6101b76101b2366004610c60565b610690565b60405161011193929190610cba565b3480156101d257600080fd5b5048610107565b3480156101e557600080fd5b5043610107565b3480156101f857600080fd5b50610107610207366004610ce2565b73ffffffffffffffffffffffffffffffffffffffff163190565b34801561022d57600080fd5b5044610107565b61012d610242366004610a85565b6106ab565b34801561025357600080fd5b5045610107565b34801561026657600080fd5b50604051418152602001610111565b61012d610283366004610c60565b61085a565b6101b7610296366004610a85565b610a1a565b3480156102a757600080fd5b506101076102b6366004610d18565b4090565b60606000828067ffffffffffffffff8111156102d8576102d8610d31565b60405190808252806020026020018201604052801561031e57816020015b6040805180820190915260008152606060208201528152602001906001900390816102f65790505b5092503660005b8281101561047757600085828151811061034157610341610d60565b6020026020010151905087878381811061035d5761035d610d60565b905060200281019061036f9190610d8f565b6040810135958601959093506103886020850185610ce2565b73ffffffffffffffffffffffffffffffffffffffff16816103ac6060870187610dcd565b6040516103ba929190610e32565b60006040518083038185875af1925050503d80600081146103f7576040519150601f19603f3d011682016040523d82523d6000602084013e6103fc565b606091505b50602080850191909152901515808452908501351761046d577f08c379a000000000000000000000000000000000000000000000000000000000600052602060045260176024527f4d756c746963616c6c333a2063616c6c206661696c656400000000000000000060445260846000fd5b5050600101610325565b508234146104e6576040517f08c379a000000000000000000000000000000000000000000000000000000000815260206004820152601a60248201527f4d756c746963616c6c333a2076616c7565206d69736d6174636800000000000060448201526064015b60405180910390fd5b50505092915050565b436060828067ffffffffffffffff81111561050c5761050c610d31565b60405190808252806020026020018201604052801561053f57816020015b606081526020019060019003908161052a5790505b5091503660005b8281101561068657600087878381811061056257610562610d60565b90506020028101906105749190610e42565b92506105836020840184610ce2565b73ffffffffffffffffffffffffffffffffffffffff166105a66020850185610dcd565b6040516105b4929190610e32565b6000604051808303816000865af19150503d80600081146105f1576040519150601f19603f3d011682016040523d82523d6000602084013e6105f6565b606091505b5086848151811061060957610609610d60565b602090810291909101015290508061067d576040517f08c379a000000000000000000000000000000000000000000000000000000000815260206004820152601760248201527f4d756c746963616c6c333a2063616c6c206661696c656400000000000000000060448201526064016104dd565b50600101610546565b5050509250929050565b43804060606106a086868661085a565b905093509350939050565b6060818067ffffffffffffffff8111156106c7576106c7610d31565b60405190808252806020026020018201604052801561070d57816020015b6040805180820190915260008152606060208201528152602001906001900390816106e55790505b5091503660005b828110156104e657600084828151811061073057610730610d60565b6020026020010151905086868381811061074c5761074c610d60565b905060200281019061075e9190610e76565b925061076d6020840184610ce2565b73ffffffffffffffffffffffffffffffffffffffff166107906040850185610dcd565b60405161079e929190610e32565b6000604051808303816000865af19150503d80600081146107db576040519150601f19603f3d011682016040523d82523d6000602084013e6107e0565b606091505b506020808401919091529015158083529084013517610851577f08c379a000000000000000000000000000000000000000000000000000000000600052602060045260176024527f4d756c746963616c6c333a2063616c6c206661696c656400000000000000000060445260646000fd5b50600101610714565b6060818067ffffffffffffffff81111561087657610876610d31565b6040519080825280602002602001820160405280156108bc57816020015b6040805180820190915260008152606060208201528152602001906001900390816108945790505b5091503660005b82811015610a105760008482815181106108df576108df610d60565b602002602001015190508686838181106108fb576108fb610d60565b905060200281019061090d9190610e42565b925061091c6020840184610ce2565b73ffffffffffffffffffffffffffffffffffffffff1661093f6020850185610dcd565b60405161094d929190610e32565b6000604051808303816000865af19150503d806000811461098a576040519150601f19603f3d011682016040523d82523d6000602084013e61098f565b606091505b506020830152151581528715610a07578051610a07576040517f08c379a000000000000000000000000000000000000000000000000000000000815260206004820152601760248201527f4d756c746963616c6c333a2063616c6c206661696c656400000000000000000060448201526064016104dd565b506001016108c3565b5050509392505050565b6000806060610a2b60018686610690565b919790965090945092505050565b60008083601f840112610a4b57600080fd5b50813567ffffffffffffffff811115610a6357600080fd5b6020830191508360208260051b8501011115610a7e57600080fd5b9250929050565b60008060208385031215610a9857600080fd5b823567ffffffffffffffff811115610aaf57600080fd5b610abb85828601610a39565b90969095509350505050565b6000815180845260005b81811015610aed57602081850181015186830182015201610ad1565b81811115610aff576000602083870101525b50601f017fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe0169290920160200192915050565b600082825180855260208086019550808260051b84010181860160005b84811015610bb1578583037fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe001895281518051151584528401516040858501819052610b9d81860183610ac7565b9a86019a9450505090830190600101610b4f565b5090979650505050505050565b602081526000610bd16020830184610b32565b9392505050565b600060408201848352602060408185015281855180845260608601915060608160051b870101935082870160005b82811015610c52577fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffa0888703018452610c40868351610ac7565b95509284019290840190600101610c06565b509398975050505050505050565b600080600060408486031215610c7557600080fd5b83358015158114610c8557600080fd5b9250602084013567ffffffffffffffff811115610ca157600080fd5b610cad86828701610a39565b9497909650939450505050565b838152826020820152606060408201526000610cd96060830184610b32565b95945050505050565b600060208284031215610cf457600080fd5b813573ffffffffffffffffffffffffffffffffffffffff81168114610bd157600080fd5b600060208284031215610d2a57600080fd5b5035919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052603260045260246000fd5b600082357fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff81833603018112610dc357600080fd5b9190910192915050565b60008083357fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe1843603018112610e0257600080fd5b83018035915067ffffffffffffffff821115610e1d57600080fd5b602001915036819003821315610a7e57600080fd5b8183823760009101908152919050565b600082357fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc1833603018112610dc357600080fd5b600082357fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffa1833603018112610dc357600080fdfea2646970667358221220bb2b5c71a328032f97c676ae39a1ec2148d3e5d6f73d95e9b17910152d61f16264736f6c634300080c0033"
ETH_GENESIS_MULTICALL3_BALANCE="0x0"
ETH_GENESIS_MULTICALL3_NONCE="0x1"

# --- WBERA (Wrapped BERA) ---
# Address: 0x6969696969696969696969696969696969696969
# Purpose: ERC-20 wrapper for the native BERA token
# Allows BERA to be used in DeFi protocols that require ERC-20 tokens
# Equivalent to WETH on Ethereum
ETH_GENESIS_WBERA_ADDRESS="0x6969696969696969696969696969696969696969"
ETH_GENESIS_WBERA_CODE="0x6080604052600436106100dc575f3560e01c806370a082311161007c578063a9059cbb11610057578063a9059cbb14610365578063d0e30db014610384578063d505accf1461038c578063dd62ed3e146103ab575f80fd5b806370a08231146102be5780637ecebe00146102ef57806395d89b4114610320575f80fd5b806323b872dd116100b757806323b872dd1461019b5780632e1a7d4d146101ba578063313ce567146101d95780633644e515146101f4575f80fd5b806306fdde03146100ef578063095ea7b31461014657806318160ddd14610175575f80fd5b366100eb576100e96103df565b005b5f80fd5b3480156100fa575f80fd5b5060408051808201909152600c81527f577261707065642042657261000000000000000000000000000000000000000060208201525b60405161013d9190610865565b60405180910390f35b348015610151575f80fd5b506101656101603660046108e0565b6103eb565b604051901515815260200161013d565b348015610180575f80fd5b506805345cdf77eb68f44c545b60405190815260200161013d565b3480156101a6575f80fd5b506101656101b5366004610908565b61043a565b3480156101c5575f80fd5b506100e96101d4366004610942565b6104f2565b3480156101e4575f80fd5b506040516012815260200161013d565b3480156101ff575f80fd5b50604080518082018252600c81527f577261707065642042657261000000000000000000000000000000000000000060209182015281517f8b73c3c69bb8fe3d512ecc4cf759cc79239f7b179b0ffacaa9a75d522b39400f81527fb6c9387dd48cdde7d71a807357f57f1fef05232a4af3ed7fdf1f050c8e1a69fe918101919091527fc89efdaa54c0f20c7adf612882df0950f5a951637e0307cdcb4c672f298b8bc69181019190915246606082015230608082015260a0902061018d565b3480156102c9575f80fd5b5061018d6102d8366004610959565b6387a211a2600c9081525f91909152602090205490565b3480156102fa575f80fd5b5061018d610309366004610959565b6338377508600c9081525f91909152602090205490565b34801561032b575f80fd5b5060408051808201909152600581527f57424552410000000000000000000000000000000000000000000000000000006020820152610130565b348015610370575f80fd5b5061016561037f3660046108e0565b610518565b6100e96103df565b348015610397575f80fd5b506100e96103a6366004610979565b61058f565b3480156103b6575f80fd5b5061018d6103c53660046109e6565b602052637f5e9f20600c9081525f91909152603490205490565b6103e93334610768565b565b5f82602052637f5e9f20600c52335f52816034600c2055815f52602c5160601c337f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b92560205fa350600192915050565b5f8360601b33602052637f5e9f208117600c526034600c2080548019156104765780851115610470576313be252b5f526004601cfd5b84810382555b50506387a211a28117600c526020600c2080548085111561049e5763f4d678b85f526004601cfd5b84810382555050835f526020600c208381540181555082602052600c5160601c8160601c7fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef602080a3505060019392505050565b6104fc33826107e4565b5f385f3884335af16105155763b12d13eb5f526004601cfd5b50565b5f6387a211a2600c52335f526020600c208054808411156105405763f4d678b85f526004601cfd5b83810382555050825f526020600c208281540181555081602052600c5160601c337fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef602080a350600192915050565b60408051808201909152600c81527f57726170706564204265726100000000000000000000000000000000000000006020909101527fb6c9387dd48cdde7d71a807357f57f1fef05232a4af3ed7fdf1f050c8e1a69fe7fc89efdaa54c0f20c7adf612882df0950f5a951637e0307cdcb4c672f298b8bc64286101561061b57631a15a3cc5f526004601cfd5b6040518960601b60601c99508860601b60601c985065383775081901600e52895f526020600c2080547f8b73c3c69bb8fe3d512ecc4cf759cc79239f7b179b0ffacaa9a75d522b39400f835284602084015283604084015246606084015230608084015260a08320602e527f6e71edae12b1b97f4d1f60370fef10105fa2faae0126114a169c64845d6126c983528b60208401528a60408401528960608401528060808401528860a084015260c08320604e526042602c205f528760ff16602052866040528560605260208060805f60015afa8c3d51146107035763ddafbaef5f526004601cfd5b019055777f5e9f20000000000000000000000000000000000000000089176040526034602c20889055888a7f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925602060608501a360405250505f60605250505050505050565b6805345cdf77eb68f44c548181018181101561078b5763e5cfe9575f526004601cfd5b806805345cdf77eb68f44c5550506387a211a2600c52815f526020600c208181540181555080602052600c5160601c5f7fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef602080a35050565b6387a211a2600c52815f526020600c2080548083111561080b5763f4d678b85f526004601cfd5b82900390556805345cdf77eb68f44c805482900390555f81815273ffffffffffffffffffffffffffffffffffffffff83167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef602083a35050565b602081525f82518060208401528060208501604085015e5f6040828501015260407fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe0601f83011684010191505092915050565b803573ffffffffffffffffffffffffffffffffffffffff811681146108db575f80fd5b919050565b5f80604083850312156108f1575f80fd5b6108fa836108b8565b946020939093013593505050565b5f805f6060848603121561091a575f80fd5b610923846108b8565b9250610931602085016108b8565b929592945050506040919091013590565b5f60208284031215610952575f80fd5b5035919050565b5f60208284031215610969575f80fd5b610972826108b8565b9392505050565b5f805f805f805f60e0888a03121561098f575f80fd5b610998886108b8565b96506109a6602089016108b8565b95506040880135945060608801359350608088013560ff811681146109c9575f80fd5b9699959850939692959460a0840135945060c09093013592915050565b5f80604083850312156109f7575f80fd5b610a00836108b8565b9150610a0e602084016108b8565b9050925092905056fea164736f6c634300081a000a"
ETH_GENESIS_WBERA_BALANCE="0x0"
ETH_GENESIS_WBERA_NONCE="0x1"

# --- Permit2 (Uniswap) ---
# Address: 0x000000000022D473030F116dDEE9F6B43aC78BA3
# Purpose: Advanced token approval patterns for secure token transfers
# Standard deployment address used across all EVM chains
# Enables time-limited and granular allowances
ETH_GENESIS_PERMIT2_ADDRESS="0x000000000022D473030F116dDEE9F6B43aC78BA3"
ETH_GENESIS_PERMIT2_CODE="0x6040608081526004908136101561001557600080fd5b600090813560e01c80630d58b1db1461126c578063137c29fe146110755780632a2d80d114610db75780632b67b57014610bde57806330f28b7a14610ade5780633644e51514610a9d57806336c7851614610a285780633ff9dcb1146109a85780634fe02b441461093f57806365d9723c146107ac57806387517c451461067a578063927da105146105c3578063cc53287f146104a3578063edd9444b1461033a5763fe8ec1a7146100c657600080fd5b346103365760c07ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc3601126103365767ffffffffffffffff833581811161033257610114903690860161164b565b60243582811161032e5761012b903690870161161a565b6101336114e6565b9160843585811161032a5761014b9036908a016115c1565b98909560a43590811161032657610164913691016115c1565b969095815190610173826113ff565b606b82527f5065726d697442617463685769746e6573735472616e7366657246726f6d285460208301527f6f6b656e5065726d697373696f6e735b5d207065726d69747465642c61646472838301527f657373207370656e6465722c75696e74323536206e6f6e63652c75696e74323560608301527f3620646561646c696e652c000000000000000000000000000000000000000000608083015282519a8b9181610222602085018096611f93565b918237018a8152039961025b7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe09b8c8101835282611437565b5190209085515161026b81611ebb565b908a5b8181106102f95750506102f6999a6102ed9183516102a081610294602082018095611f66565b03848101835282611437565b519020602089810151858b015195519182019687526040820192909252336060820152608081019190915260a081019390935260643560c08401528260e081015b03908101835282611437565b51902093611cf7565b80f35b8061031161030b610321938c5161175e565b51612054565b61031b828661175e565b52611f0a565b61026e565b8880fd5b8780fd5b8480fd5b8380fd5b5080fd5b5091346103365760807ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc3601126103365767ffffffffffffffff9080358281116103325761038b903690830161164b565b60243583811161032e576103a2903690840161161a565b9390926103ad6114e6565b9160643590811161049f576103c4913691016115c1565b949093835151976103d489611ebb565b98885b81811061047d5750506102f697988151610425816103f9602082018095611f66565b037fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe08101835282611437565b5190206020860151828701519083519260208401947ffcf35f5ac6a2c28868dc44c302166470266239195f02b0ee408334829333b7668652840152336060840152608083015260a082015260a081526102ed8161141b565b808b61031b8261049461030b61049a968d5161175e565b9261175e565b6103d7565b8680fd5b5082346105bf57602090817ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc3601126103325780359067ffffffffffffffff821161032e576104f49136910161161a565b929091845b848110610504578580f35b8061051a610515600193888861196c565b61197c565b61052f84610529848a8a61196c565b0161197c565b3389528385528589209173ffffffffffffffffffffffffffffffffffffffff80911692838b528652868a20911690818a5285528589207fffffffffffffffffffffffff000000000000000000000000000000000000000081541690558551918252848201527f89b1add15eff56b3dfe299ad94e01f2b52fbcb80ae1a3baea6ae8c04cb2b98a4853392a2016104f9565b8280fd5b50346103365760607ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc36011261033657610676816105ff6114a0565b936106086114c3565b6106106114e6565b73ffffffffffffffffffffffffffffffffffffffff968716835260016020908152848420928816845291825283832090871683528152919020549251938316845260a083901c65ffffffffffff169084015260d09190911c604083015281906060820190565b0390f35b50346103365760807ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc360112610336576106b26114a0565b906106bb6114c3565b916106c46114e6565b65ffffffffffff926064358481169081810361032a5779ffffffffffff0000000000000000000000000000000000000000947fda9fa7c1b00402c17d0161b249b1ab8bbec047c5a52207b9c112deffd817036b94338a5260016020527fffffffffffff0000000000000000000000000000000000000000000000000000858b209873ffffffffffffffffffffffffffffffffffffffff809416998a8d5260205283878d209b169a8b8d52602052868c209486156000146107a457504216925b8454921697889360a01b16911617179055815193845260208401523392a480f35b905092610783565b5082346105bf5760607ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc3601126105bf576107e56114a0565b906107ee6114c3565b9265ffffffffffff604435818116939084810361032a57338852602091600183528489209673ffffffffffffffffffffffffffffffffffffffff80911697888b528452858a20981697888a5283528489205460d01c93848711156109175761ffff9085840316116108f05750907f55eb90d810e1700b35a8e7e25395ff7f2b2259abd7415ca2284dfb1c246418f393929133895260018252838920878a528252838920888a5282528389209079ffffffffffffffffffffffffffffffffffffffffffffffffffff7fffffffffffff000000000000000000000000000000000000000000000000000083549260d01b16911617905582519485528401523392a480f35b84517f24d35a26000000000000000000000000000000000000000000000000000000008152fd5b5084517f756688fe000000000000000000000000000000000000000000000000000000008152fd5b503461033657807ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc360112610336578060209273ffffffffffffffffffffffffffffffffffffffff61098f6114a0565b1681528084528181206024358252845220549051908152f35b5082346105bf57817ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc3601126105bf577f3704902f963766a4e561bbaab6e6cdc1b1dd12f6e9e99648da8843b3f46b918d90359160243533855284602052818520848652602052818520818154179055815193845260208401523392a280f35b8234610a9a5760807ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc360112610a9a57610a606114a0565b610a686114c3565b610a706114e6565b6064359173ffffffffffffffffffffffffffffffffffffffff8316830361032e576102f6936117a1565b80fd5b503461033657817ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc36011261033657602090610ad7611b1e565b9051908152f35b508290346105bf576101007ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc3601126105bf57610b1a3661152a565b90807fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff7c36011261033257610b4c611478565b9160e43567ffffffffffffffff8111610bda576102f694610b6f913691016115c1565b939092610b7c8351612054565b6020840151828501519083519260208401947f939c21a48a8dbe3a9a2404a1d46691e4d39f6583d6ec6b35714604c986d801068652840152336060840152608083015260a082015260a08152610bd18161141b565b51902091611c25565b8580fd5b509134610336576101007ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc36011261033657610c186114a0565b7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffdc360160c08112610332576080855191610c51836113e3565b1261033257845190610c6282611398565b73ffffffffffffffffffffffffffffffffffffffff91602435838116810361049f578152604435838116810361049f57602082015265ffffffffffff606435818116810361032a5788830152608435908116810361049f576060820152815260a435938285168503610bda576020820194855260c4359087830182815260e43567ffffffffffffffff811161032657610cfe90369084016115c1565b929093804211610d88575050918591610d786102f6999a610d7e95610d238851611fbe565b90898c511690519083519260208401947ff3841cd1ff0085026a6327b620b67997ce40f282c88a8e905a7a5626e310f3d086528401526060830152608082015260808152610d70816113ff565b519020611bd9565b916120c7565b519251169161199d565b602492508a51917fcd21db4f000000000000000000000000000000000000000000000000000000008352820152fd5b5091346103365760607ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc93818536011261033257610df36114a0565b9260249081359267ffffffffffffffff9788851161032a578590853603011261049f578051978589018981108282111761104a578252848301358181116103265785019036602383011215610326578382013591610e50836115ef565b90610e5d85519283611437565b838252602093878584019160071b83010191368311611046578801905b828210610fe9575050508a526044610e93868801611509565b96838c01978852013594838b0191868352604435908111610fe557610ebb90369087016115c1565b959096804211610fba575050508998995151610ed681611ebb565b908b5b818110610f9757505092889492610d7892610f6497958351610f02816103f98682018095611f66565b5190209073ffffffffffffffffffffffffffffffffffffffff9a8b8b51169151928551948501957faf1b0d30d2cab0380e68f0689007e3254993c596f2fdd0aaa7f4d04f794408638752850152830152608082015260808152610d70816113ff565b51169082515192845b848110610f78578580f35b80610f918585610f8b600195875161175e565b5161199d565b01610f6d565b80610311610fac8e9f9e93610fb2945161175e565b51611fbe565b9b9a9b610ed9565b8551917fcd21db4f000000000000000000000000000000000000000000000000000000008352820152fd5b8a80fd5b6080823603126110465785608091885161100281611398565b61100b85611509565b8152611018838601611509565b838201526110278a8601611607565b8a8201528d611037818701611607565b90820152815201910190610e7a565b8c80fd5b84896041867f4e487b7100000000000000000000000000000000000000000000000000000000835252fd5b5082346105bf576101407ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc3601126105bf576110b03661152a565b91807fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff7c360112610332576110e2611478565b67ffffffffffffffff93906101043585811161049f5761110590369086016115c1565b90936101243596871161032a57611125610bd1966102f6983691016115c1565b969095825190611134826113ff565b606482527f5065726d69745769746e6573735472616e7366657246726f6d28546f6b656e5060208301527f65726d697373696f6e73207065726d69747465642c6164647265737320737065848301527f6e6465722c75696e74323536206e6f6e63652c75696e7432353620646561646c60608301527f696e652c0000000000000000000000000000000000000000000000000000000060808301528351948591816111e3602085018096611f93565b918237018b8152039361121c7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe095868101835282611437565b5190209261122a8651612054565b6020878101518589015195519182019687526040820192909252336060820152608081019190915260a081019390935260e43560c08401528260e081016102e1565b5082346105bf576020807ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc36011261033257813567ffffffffffffffff92838211610bda5736602383011215610bda5781013592831161032e576024906007368386831b8401011161049f57865b8581106112e5578780f35b80821b83019060807fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffdc83360301126103265761139288876001946060835161132c81611398565b611368608461133c8d8601611509565b9485845261134c60448201611509565b809785015261135d60648201611509565b809885015201611509565b918291015273ffffffffffffffffffffffffffffffffffffffff80808093169516931691166117a1565b016112da565b6080810190811067ffffffffffffffff8211176113b457604052565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b6060810190811067ffffffffffffffff8211176113b457604052565b60a0810190811067ffffffffffffffff8211176113b457604052565b60c0810190811067ffffffffffffffff8211176113b457604052565b90601f7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe0910116810190811067ffffffffffffffff8211176113b457604052565b60c4359073ffffffffffffffffffffffffffffffffffffffff8216820361149b57565b600080fd5b6004359073ffffffffffffffffffffffffffffffffffffffff8216820361149b57565b6024359073ffffffffffffffffffffffffffffffffffffffff8216820361149b57565b6044359073ffffffffffffffffffffffffffffffffffffffff8216820361149b57565b359073ffffffffffffffffffffffffffffffffffffffff8216820361149b57565b7ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc01906080821261149b576040805190611563826113e3565b8082941261149b57805181810181811067ffffffffffffffff8211176113b457825260043573ffffffffffffffffffffffffffffffffffffffff8116810361149b578152602435602082015282526044356020830152606435910152565b9181601f8401121561149b5782359167ffffffffffffffff831161149b576020838186019501011161149b57565b67ffffffffffffffff81116113b45760051b60200190565b359065ffffffffffff8216820361149b57565b9181601f8401121561149b5782359167ffffffffffffffff831161149b576020808501948460061b01011161149b57565b91909160608184031261149b576040805191611666836113e3565b8294813567ffffffffffffffff9081811161149b57830182601f8201121561149b578035611693816115ef565b926116a087519485611437565b818452602094858086019360061b8501019381851161149b579086899897969594939201925b8484106116e3575050505050855280820135908501520135910152565b90919293949596978483031261149b578851908982019082821085831117611730578a928992845261171487611509565b81528287013583820152815201930191908897969594936116c6565b602460007f4e487b710000000000000000000000000000000000000000000000000000000081526041600452fd5b80518210156117725760209160051b010190565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052603260045260246000fd5b92919273ffffffffffffffffffffffffffffffffffffffff604060008284168152600160205282828220961695868252602052818120338252602052209485549565ffffffffffff8760a01c16804211611884575082871696838803611812575b5050611810955016926118b5565b565b878484161160001461184f57602488604051907ff96fb0710000000000000000000000000000000000000000000000000000000082526004820152fd5b7fffffffffffffffffffffffff000000000000000000000000000000000000000084846118109a031691161790553880611802565b602490604051907fd81b2f2e0000000000000000000000000000000000000000000000000000000082526004820152fd5b9060006064926020958295604051947f23b872dd0000000000000000000000000000000000000000000000000000000086526004860152602485015260448401525af13d15601f3d116001600051141617161561190e57565b60646040517f08c379a000000000000000000000000000000000000000000000000000000000815260206004820152601460248201527f5452414e534645525f46524f4d5f4641494c45440000000000000000000000006044820152fd5b91908110156117725760061b0190565b3573ffffffffffffffffffffffffffffffffffffffff8116810361149b5790565b9065ffffffffffff908160608401511673ffffffffffffffffffffffffffffffffffffffff908185511694826020820151169280866040809401511695169560009187835260016020528383208984526020528383209916988983526020528282209184835460d01c03611af5579185611ace94927fc6a377bfc4eb120024a8ac08eef205be16b817020812c73223e81d1bdb9708ec98979694508715600014611ad35779ffffffffffff00000000000000000000000000000000000000009042165b60a01b167fffffffffffff00000000000000000000000000000000000000000000000000006001860160d01b1617179055519384938491604091949373ffffffffffffffffffffffffffffffffffffffff606085019616845265ffffffffffff809216602085015216910152565b0390a4565b5079ffffffffffff000000000000000000000000000000000000000087611a60565b600484517f756688fe000000000000000000000000000000000000000000000000000000008152fd5b467f00000000000000000000000000000000000000000000000000000000000138de03611b69577f1dc08c4ac637ae13fdbae95e53fb95942c41e44de89165404e5111c4e5b560ae90565b60405160208101907f8cad95687ba82c2ce50e74f7b754645e5117c3a5bec8151c0726d5857980a86682527f9ac997416e8ff9d2ff6bebeb7149f65cdae5e32e2b90440b566bb3044041d36a604082015246606082015230608082015260808152611bd3816113ff565b51902090565b611be1611b1e565b906040519060208201927f190100000000000000000000000000000000000000000000000000000000000084526022830152604282015260428152611bd381611398565b9192909360a435936040840151804211611cc65750602084510151808611611c955750918591610d78611c6594611c60602088015186611e47565b611bd9565b73ffffffffffffffffffffffffffffffffffffffff809151511692608435918216820361149b57611810936118b5565b602490604051907f3728b83d0000000000000000000000000000000000000000000000000000000082526004820152fd5b602490604051907fcd21db4f0000000000000000000000000000000000000000000000000000000082526004820152fd5b959093958051519560409283830151804211611e175750848803611dee57611d2e918691610d7860209b611c608d88015186611e47565b60005b868110611d42575050505050505050565b611d4d81835161175e565b5188611d5a83878a61196c565b01359089810151808311611dbe575091818888886001968596611d84575b50505050505001611d31565b611db395611dad9273ffffffffffffffffffffffffffffffffffffffff6105159351169561196c565b916118b5565b803888888883611d78565b6024908651907f3728b83d0000000000000000000000000000000000000000000000000000000082526004820152fd5b600484517fff633a38000000000000000000000000000000000000000000000000000000008152fd5b6024908551907fcd21db4f0000000000000000000000000000000000000000000000000000000082526004820152fd5b9073ffffffffffffffffffffffffffffffffffffffff600160ff83161b9216600052600060205260406000209060081c6000526020526040600020818154188091551615611e9157565b60046040517f756688fe000000000000000000000000000000000000000000000000000000008152fd5b90611ec5826115ef565b611ed26040519182611437565b8281527fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe0611f0082946115ef565b0190602036910137565b7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff8114611f375760010190565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b805160208092019160005b828110611f7f575050505090565b835185529381019392810192600101611f71565b9081519160005b838110611fab575050016000815290565b8060208092840101518185015201611f9a565b60405160208101917f65626cad6cb96493bf6f5ebea28756c966f023ab9e8a83a7101849d5573b3678835273ffffffffffffffffffffffffffffffffffffffff8082511660408401526020820151166060830152606065ffffffffffff9182604082015116608085015201511660a082015260a0815260c0810181811067ffffffffffffffff8211176113b45760405251902090565b6040516020808201927f618358ac3db8dc274f0cd8829da7e234bd48cd73c4a740aede1adec9846d06a1845273ffffffffffffffffffffffffffffffffffffffff81511660408401520151606082015260608152611bd381611398565b919082604091031261149b576020823592013590565b6000843b61222e5750604182036121ac576120e4828201826120b1565b939092604010156117725760209360009360ff6040608095013560f81c5b60405194855216868401526040830152606082015282805260015afa156121a05773ffffffffffffffffffffffffffffffffffffffff806000511691821561217657160361214c57565b60046040517f815e1d64000000000000000000000000000000000000000000000000000000008152fd5b60046040517f8baa579f000000000000000000000000000000000000000000000000000000008152fd5b6040513d6000823e3d90fd5b60408203612204576121c0918101906120b1565b91601b7f7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff84169360ff1c019060ff8211611f375760209360009360ff608094612102565b60046040517f4be6321b000000000000000000000000000000000000000000000000000000008152fd5b929391601f928173ffffffffffffffffffffffffffffffffffffffff60646020957fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe0604051988997889687947f1626ba7e000000000000000000000000000000000000000000000000000000009e8f8752600487015260406024870152816044870152868601378b85828601015201168101030192165afa9081156123a857829161232a575b7fffffffff000000000000000000000000000000000000000000000000000000009150160361230057565b60046040517fb0669cbc000000000000000000000000000000000000000000000000000000008152fd5b90506020813d82116123a0575b8161234460209383611437565b810103126103365751907fffffffff0000000000000000000000000000000000000000000000000000000082168203610a9a57507fffffffff0000000000000000000000000000000000000000000000000000000090386122d4565b3d9150612337565b6040513d84823e3d90fdfea164736f6c6343000811000a"
ETH_GENESIS_PERMIT2_BALANCE="0x0"
ETH_GENESIS_PERMIT2_NONCE="0x1"

# --- BeaconDeposit Contract ---
# Address: 0x4242424242424242424242424242424242424242
# Purpose: Handles validator deposits for Berachain's Proof-of-Stake consensus
# Validators deposit BERA (min 10,000) to participate in consensus
# Events from this contract are used by the beacon chain for staking management
ETH_GENESIS_BEACON_DEPOSIT_ADDRESS="0x4242424242424242424242424242424242424242"
ETH_GENESIS_BEACON_DEPOSIT_CODE="0x608060405234801561001057600080fd5b50600436106100935760003560e01c8063621fd130116100665780636353586511610050578063635358651461011f578063c5f2892f14610132578063d2354e4a1461014557600080fd5b80637f8661a11461010c578063a38b4f4114610114575b600080fd5b6100a661009e36600461066c565b600092915050565b60405160ff90911681526020015b60405180910390f35b6100bd61015857610158565b60405190815260200161009e565b61010a6101083660046106df565b565b005b61010a61016957610169565b61010a61012236600461071f565b50565b61010a61013036600461078c565b565b6100bd6101403660046107f8565b610179565b61010a61015336600461080e565b600080fd5b600080fd5b50565b50565b600080fd5b600080fd5b919050565b600080fd5b505050565b50565b600080fd5b50565b50565b600080fd5b50565b600080fd5b6000806000604084860312156101a857600080fd5b833567ffffffffffffffff808211156101c057600080fd5b818601915086601f8301126101d457600080fd5b8135818111156101e357600080fd5b8760208285010111156101f557600080fd5b6020928301955093505084013561020b81610257565b809150509250925092565b60006020828403121561022857600080fd5b5035919050565b60006020828403121561024157600080fd5b813561024c81610257565b809150509291505056fea164736f6c6343000817000a"
ETH_GENESIS_BEACON_DEPOSIT_BALANCE="0x0"
ETH_GENESIS_BEACON_DEPOSIT_NONCE="0x1"
ETH_GENESIS_BEACON_DEPOSIT_STORAGE_KEY="0x0000000000000000000000000000000000000000000000000000000000000000,0x0000000000000000000000000000000000000000000000000000000000000001"
ETH_GENESIS_BEACON_DEPOSIT_STORAGE_VALUE="0x0000000000000000000000000000000000000000000000000000000000000000,0x0000000000000000000000000000000000000000000000000000000000000000"

# =============================================================================
# Prague Upgrade Configurations
# =============================================================================

# --- Prague1 ---
ETH_GENESIS_PRAGUE1_TIME=1756915200
ETH_GENESIS_PRAGUE1_BASE_FEE_CHANGE_DENOMINATOR=48
ETH_GENESIS_PRAGUE1_MIN_BASE_FEE=1000000000
ETH_GENESIS_PRAGUE1_POL_DISTRIBUTOR="0xD2f19a79b026Fb636A7c300bF5947df113940761"
# Empty on purpose
ETH_GENESIS_PRAGUE1_BEX_VAULT=
ETH_GENESIS_PRAGUE1_RESCUE_ADDRESS=
ETH_GENESIS_PRAGUE1_BLOCKED_ADDRESSES=

# --- Prague2 ---
ETH_GENESIS_PRAGUE2_TIME=1759248000
ETH_GENESIS_PRAGUE2_BASE_FEE_CHANGE_DENOMINATOR=
ETH_GENESIS_PRAGUE2_MIN_BASE_FEE=0
ETH_GENESIS_PRAGUE2_POL_DISTRIBUTOR=
ETH_GENESIS_PRAGUE2_BEX_VAULT=
ETH_GENESIS_PRAGUE2_RESCUE_ADDRESS=
ETH_GENESIS_PRAGUE2_BLOCKED_ADDRESSES=

# --- Prague3 ---
ETH_GENESIS_PRAGUE3_TIME=1762164459
ETH_GENESIS_PRAGUE3_BASE_FEE_CHANGE_DENOMINATOR=
ETH_GENESIS_PRAGUE3_MIN_BASE_FEE=
ETH_GENESIS_PRAGUE3_POL_DISTRIBUTOR=
ETH_GENESIS_PRAGUE3_BEX_VAULT="0x4be03f781c497a489e3cb0287833452ca9b9e80b"
ETH_GENESIS_PRAGUE3_RESCUE_ADDRESS="0xD276D30592bE512a418f2448e23f9E7F372b32A2"
ETH_GENESIS_PRAGUE3_BLOCKED_ADDRESSES="0xF8Bec8cB704b8BD427FD209A2058b396C4BC543e,0x0000000000000000000000000000000000000000"

# --- Prague4 ---
ETH_GENESIS_PRAGUE4_TIME=1762963200
ETH_GENESIS_PRAGUE4_BASE_FEE_CHANGE_DENOMINATOR=
ETH_GENESIS_PRAGUE4_MIN_BASE_FEE=
ETH_GENESIS_PRAGUE4_POL_DISTRIBUTOR=
ETH_GENESIS_PRAGUE4_BEX_VAULT=
ETH_GENESIS_PRAGUE4_RESCUE_ADDRESS=
ETH_GENESIS_PRAGUE4_BLOCKED_ADDRESSES=

# =============================================================================
# Default Beacond app.toml - See ./beacond/config/app.toml
# =============================================================================
readonly APPTOML_PRUNING="everything"
readonly APPTOML_PRUNING_KEEP_RECENT="0"
readonly APPTOML_PRUNING_INTERVAL="0"
readonly APPTOML_HALT_HEIGHT=0
readonly APPTOML_HALT_TIME=0
readonly APPTOML_MIN_RETAIN_BLOCKS=0
readonly APPTOML_INTER_BLOCK_CACHE=true
readonly APPTOML_INDEX_EVENTS=() # Ex: ["message.sender", "message.recipient"]
readonly APPTOML_IAVL_CACHE_SIZE=781250
readonly APPTOML_IAVL_DISABLE_FASTNODE=true
readonly APPTOML_APP_DB_BACKEND="pebbledb"

# Telemetry Configuration
readonly APPTOML_TELEMETRY_SERVICE_NAME="beacond_node"
readonly APPTOML_TELEMETRY_ENABLED=true
readonly APPTOML_TELEMETRY_ENABLE_HOSTNAME=true
readonly APPTOML_TELEMETRY_ENABLE_HOSTNAME_LABEL=true
readonly APPTOML_TELEMETRY_ENABLE_SERVICE_LABEL=true
readonly APPTOML_TELEMETRY_PROMETHEUS_RETENTION_TIME=60
readonly APPTOML_TELEMETRY_GLOBAL_LABELS=() # Ex: [["chain_id", "cosmoshub-1"]]
readonly APPTOML_TELEMETRY_METRICS_SINK=""
readonly APPTOML_TELEMETRY_STATSD_ADDR=""
readonly APPTOML_TELEMETRY_DATADOG_HOSTNAME="my_beacond_node"

# BeaconKit Configuration
readonly APPTOML_BEACON_KIT_CHAIN_SPEC="devnet" # Ex: "devnet" | "testnet" | "mainnet"
readonly APPTOML_BEACON_KIT_CHAIN_SPEC_FILE="" # Ex: "./testing/networks/80094/chain-spec.json"
readonly APPTOML_BEACON_KIT_SHUTDOWN_TIMEOUT="5m0s"

# BeaconKit Engine Configuration
readonly APPTOML_BEACON_KIT_ENGINE_RPC_DIAL_URL="http://localhost:8551"
readonly APPTOML_BEACON_KIT_ENGINE_RPC_TIMEOUT="2s"
readonly APPTOML_BEACON_KIT_ENGINE_RPC_RETRY_INTERVAL="100ms"
readonly APPTOML_BEACON_KIT_ENGINE_RPC_MAX_RETRY_INTERVAL="10s"
readonly APPTOML_BEACON_KIT_ENGINE_RPC_STARTUP_CHECK_INTERVAL="3s"
readonly APPTOML_BEACON_KIT_ENGINE_RPC_JWT_REFRESH_INTERVAL="30s"
readonly APPTOML_BEACON_KIT_ENGINE_JWT_SECRET_PATH="~/config/jwt.hex"

# BeaconKit Logger Configuration
readonly APPTOML_BEACON_KIT_LOGGER_TIME_FORMAT="RFC3339"
readonly APPTOML_BEACON_KIT_LOGGER_LOG_LEVEL="info"
readonly APPTOML_BEACON_KIT_LOGGER_STYLE="pretty"

# BeaconKit KZG Configuration
readonly APPTOML_BEACON_KIT_KZG_TRUSTED_SETUP_PATH="~/config/kzg-trusted-setup.json"
readonly APPTOML_BEACON_KIT_KZG_IMPLEMENTATION="crate-crypto/go-kzg-4844"

# BeaconKit Payload Builder Configuration
readonly APPTOML_BEACON_KIT_PAYLOAD_BUILDER_ENABLED=true
readonly APPTOML_BEACON_KIT_PAYLOAD_BUILDER_SUGGESTED_FEE_RECIPIENT="0x0000000000000000000000000000000000000000"
readonly APPTOML_BEACON_KIT_PAYLOAD_BUILDER_PAYLOAD_TIMEOUT="850ms"

# BeaconKit Validator Configuration
readonly APPTOML_BEACON_KIT_VALIDATOR_GRAFFITI=""
readonly APPTOML_BEACON_KIT_VALIDATOR_AVAILABILITY_WINDOW="8192"

# BeaconKit Node API Configuration
readonly APPTOML_BEACON_KIT_NODE_API_ENABLED="false"
readonly APPTOML_BEACON_KIT_NODE_API_ADDRESS="0.0.0.0:3500"
readonly APPTOML_BEACON_KIT_NODE_API_LOGGING="false"

# =============================================================================
# Default Beacond client.toml - See ./beacond/config/client.toml
# =============================================================================

readonly CLIENTTOML_CHAIN_ID="devnet-beacon-80087"
readonly CLIENTTOML_KEYRING_BACKEND="test"
readonly CLIENTTOML_KEYRING_DEFAULT_KEYNAME=""
readonly CLIENTTOML_OUTPUT="text"
readonly CLIENTTOML_NODE="tcp://localhost:26657"
readonly CLIENTTOML_BROADCAST_MODE="sync"
readonly CLIENTTOML_GRPC_ADDRESS=""
readonly CLIENTTOML_GRPC_INSECURE=false

# =============================================================================
# Default Beacond config.toml - See ./beacond/config/config.toml
# =============================================================================

# Main Base Config
readonly CONFIGTOML_VERSION="1.0.1"
readonly CONFIGTOML_PROXY_APP="tcp://127.0.0.1:26658"
readonly CONFIGTOML_MONIKER="beranode-<MONIKER>"
readonly CONFIGTOML_DB_BACKEND="pebbledb"
readonly CONFIGTOML_DB_DIR="data"
readonly CONFIGTOML_LOG_LEVEL="info"
readonly CONFIGTOML_LOG_FORMAT="plain"
readonly CONFIGTOML_GENESIS_FILE="config/genesis.json"
readonly CONFIGTOML_PRIV_VALIDATOR_KEY_FILE="config/priv_validator_key.json"
readonly CONFIGTOML_PRIV_VALIDATOR_STATE_FILE="data/priv_validator_state.json"
readonly CONFIGTOML_PRIV_VALIDATOR_LADDR=""
readonly CONFIGTOML_NODE_KEY_FILE="config/node_key.json"
readonly CONFIGTOML_ABCI="socket"
readonly CONFIGTOML_FILTER_PEERS=false

# RPC Server Configuration
readonly CONFIGTOML_RPC_LADDR="tcp://127.0.0.1:26657"
readonly CONFIGTOML_RPC_CORS_ALLOWED_ORIGINS=()
readonly CONFIGTOML_RPC_CORS_ALLOWED_METHODS=("HEAD" "GET" "POST")
readonly CONFIGTOML_RPC_CORS_ALLOWED_HEADERS=("Origin" "Accept" "Content-Type" "X-Requested-With" "X-Server-Time")
readonly CONFIGTOML_RPC_UNSAFE=false
readonly CONFIGTOML_RPC_MAX_OPEN_CONNECTIONS=900
readonly CONFIGTOML_RPC_MAX_SUBSCRIPTION_CLIENTS=100
readonly CONFIGTOML_RPC_MAX_SUBSCRIPTIONS_PER_CLIENT=5
readonly CONFIGTOML_RPC_EXPERIMENTAL_SUBSCRIPTION_BUFFER_SIZE=200
readonly CONFIGTOML_RPC_EXPERIMENTAL_WEBSOCKET_WRITE_BUFFER_SIZE=200
readonly CONFIGTOML_RPC_EXPERIMENTAL_CLOSE_ON_SLOW_CLIENT=false
readonly CONFIGTOML_RPC_TIMEOUT_BROADCAST_TX_COMMIT="10s"
readonly CONFIGTOML_RPC_MAX_REQUEST_BATCH_SIZE=10
readonly CONFIGTOML_RPC_MAX_BODY_BYTES=1000000
readonly CONFIGTOML_RPC_MAX_HEADER_BYTES=1048576
readonly CONFIGTOML_RPC_TLS_CERT_FILE=""
readonly CONFIGTOML_RPC_TLS_KEY_FILE=""
readonly CONFIGTOML_RPC_PPROF_LADDR=""

# gRPC Server Configuration
readonly CONFIGTOML_GRPC_LADDR=""
readonly CONFIGTOML_GRPC_VERSION_SERVICE_ENABLED=true
readonly CONFIGTOML_GRPC_BLOCK_SERVICE_ENABLED=true
readonly CONFIGTOML_GRPC_BLOCK_RESULTS_SERVICE_ENABLED=true
readonly CONFIGTOML_GRPC_PRIVILEGED_LADDR=""
readonly CONFIGTOML_GRPC_PRIVILEGED_PRUNING_SERVICE_ENABLED=false

# P2P Configuration
readonly CONFIGTOML_P2P_LADDR="tcp://0.0.0.0:26656"
readonly CONFIGTOML_P2P_EXTERNAL_ADDRESS=""
readonly CONFIGTOML_P2P_SEEDS=""
readonly CONFIGTOML_P2P_PERSISTENT_PEERS=""
readonly CONFIGTOML_P2P_ADDR_BOOK_FILE="config/addrbook.json"
readonly CONFIGTOML_P2P_ADDR_BOOK_STRICT=true
readonly CONFIGTOML_P2P_MAX_NUM_INBOUND_PEERS=40
readonly CONFIGTOML_P2P_MAX_NUM_OUTBOUND_PEERS=10
readonly CONFIGTOML_P2P_UNCONDITIONAL_PEER_IDS=""
readonly CONFIGTOML_P2P_PERSISTENT_PEERS_MAX_DIAL_PERIOD="0s"
readonly CONFIGTOML_P2P_FLUSH_THROTTLE_TIMEOUT="10ms"
readonly CONFIGTOML_P2P_MAX_PACKET_MSG_PAYLOAD_SIZE=1024
readonly CONFIGTOML_P2P_SEND_RATE=5120000
readonly CONFIGTOML_P2P_RECV_RATE=5120000
readonly CONFIGTOML_P2P_PEX=true
readonly CONFIGTOML_P2P_SEED_MODE=false
readonly CONFIGTOML_P2P_PRIVATE_PEER_IDS=""
readonly CONFIGTOML_P2P_ALLOW_DUPLICATE_IP=false
readonly CONFIGTOML_P2P_HANDSHAKE_TIMEOUT="20s"
readonly CONFIGTOML_P2P_DIAL_TIMEOUT="3s"

# Mempool Configuration
readonly CONFIGTOML_MEMPOOL_TYPE="nop"
readonly CONFIGTOML_MEMPOOL_RECHECK=false
readonly CONFIGTOML_MEMPOOL_RECHECK_TIMEOUT="0s"
readonly CONFIGTOML_MEMPOOL_BROADCAST=false
readonly CONFIGTOML_MEMPOOL_WAL_DIR=""
readonly CONFIGTOML_MEMPOOL_SIZE=0
readonly CONFIGTOML_MEMPOOL_MAX_TX_BYTES=0
readonly CONFIGTOML_MEMPOOL_MAX_TXS_BYTES=0
readonly CONFIGTOML_MEMPOOL_CACHE_SIZE=0
readonly CONFIGTOML_MEMPOOL_KEEP_INVALID_TXS_IN_CACHE=false
readonly CONFIGTOML_MEMPOOL_EXPERIMENTAL_MAX_GOSSIP_CONNECTIONS_TO_PERSISTENT_PEERS=0
readonly CONFIGTOML_MEMPOOL_EXPERIMENTAL_MAX_GOSSIP_CONNECTIONS_TO_NON_PERSISTENT_PEERS=0

# State Sync Configuration
readonly CONFIGTOML_STATESYNC_ENABLE=false
readonly CONFIGTOML_STATESYNC_RPC_SERVERS=""
readonly CONFIGTOML_STATESYNC_TRUST_HEIGHT=0
readonly CONFIGTOML_STATESYNC_TRUST_HASH=""
readonly CONFIGTOML_STATESYNC_TRUST_PERIOD="168h0m0s"
readonly CONFIGTOML_STATESYNC_DISCOVERY_TIME="15s"
readonly CONFIGTOML_STATESYNC_TEMP_DIR=""
readonly CONFIGTOML_STATESYNC_CHUNK_REQUEST_TIMEOUT="10s"
readonly CONFIGTOML_STATESYNC_CHUNK_FETCHERS="4"

# Block Sync Configuration
readonly CONFIGTOML_BLOCKSYNC_VERSION="v0"

# Consensus Configuration
readonly CONFIGTOML_CONSENSUS_WAL_FILE="data/cs.wal/wal"
readonly CONFIGTOML_CONSENSUS_TIMEOUT_PROPOSE="2s"
readonly CONFIGTOML_CONSENSUS_TIMEOUT_PROPOSE_DELTA="500ms"
readonly CONFIGTOML_CONSENSUS_TIMEOUT_PREVOTE="2s"
readonly CONFIGTOML_CONSENSUS_TIMEOUT_PREVOTE_DELTA="500ms"
readonly CONFIGTOML_CONSENSUS_TIMEOUT_PRECOMMIT="2s"
readonly CONFIGTOML_CONSENSUS_TIMEOUT_PRECOMMIT_DELTA="500ms"
readonly CONFIGTOML_CONSENSUS_TIMEOUT_COMMIT="0s"
readonly CONFIGTOML_CONSENSUS_SKIP_TIMEOUT_COMMIT=false
readonly CONFIGTOML_CONSENSUS_DOUBLE_SIGN_CHECK_HEIGHT=0
readonly CONFIGTOML_CONSENSUS_CREATE_EMPTY_BLOCKS=true
readonly CONFIGTOML_CONSENSUS_CREATE_EMPTY_BLOCKS_INTERVAL="0s"
readonly CONFIGTOML_CONSENSUS_PEER_GOSSIP_SLEEP_DURATION="100ms"
readonly CONFIGTOML_CONSENSUS_PEER_GOSSIP_INTRALOOP_SLEEP_DURATION="0s"
readonly CONFIGTOML_CONSENSUS_PEER_QUERY_MAJ23_SLEEP_DURATION="2s"

# Storage Configuration
readonly CONFIGTOML_STORAGE_DISCARD_ABCI_RESPONSES=true
readonly CONFIGTOML_STORAGE_EXPERIMENTAL_DB_KEY_LAYOUT="v1"
readonly CONFIGTOML_STORAGE_COMPACT=false
readonly CONFIGTOML_STORAGE_COMPACTION_INTERVAL="1000"
readonly CONFIGTOML_STORAGE_PRUNING_INTERVAL="10s"
readonly CONFIGTOML_STORAGE_PRUNING_DATA_COMPANION_ENABLED=false
readonly CONFIGTOML_STORAGE_PRUNING_DATA_COMPANION_INITIAL_BLOCK_RETAIN_HEIGHT=0
readonly CONFIGTOML_STORAGE_PRUNING_DATA_COMPANION_INITIAL_BLOCK_RESULTS_RETAIN_HEIGHT=0

# Transaction Indexer Configuration
readonly CONFIGTOML_TX_INDEX_INDEXER="null"
readonly CONFIGTOML_TX_INDEX_PSQL_CONN=""

# Instrumentation Configuration
readonly CONFIGTOML_INSTRUMENTATION_PROMETHEUS=true
readonly CONFIGTOML_INSTRUMENTATION_PROMETHEUS_LISTEN_ADDR=":26660"
readonly CONFIGTOML_INSTRUMENTATION_MAX_OPEN_CONNECTIONS=800
readonly CONFIGTOML_INSTRUMENTATION_NAMESPACE="cometbft"


# =============================================================================
# logging
# Source: lib/logging.sh
# =============================================================================

if [[ -t 1 ]] && [[ "${TERM:-}" != "dumb" ]]; then
    RED='\033[0;31m'
    GREEN='\033[0;32m'
    YELLOW='\033[0;33m'
    BLUE='\033[0;34m'
    BOLD='\033[1m'
    DIM='\033[2m'
    RESET='\033[0m'
else
    RED=''
    GREEN=''
    YELLOW=''
    BLUE=''
    BOLD=''
    DIM=''
    RESET=''
fi

# =============================================================================
# Logging Functions
# =============================================================================

# Print a header
print_header() {
    [[ "$DEBUG_MODE" == "true" ]] && echo "[DEBUG] Function: print_header" >&2
    echo ""
    echo -e "${BOLD}$*${RESET}"
    echo -e "${DIM}$(printf '%.0s' {1..50})${RESET}"
}

# Logging functions
log_info() {
    [[ "$DEBUG_MODE" == "true" ]] && echo "[DEBUG] Function: log_info" >&2
    echo -e "${BLUE}[INFO]${RESET} $*"
}

log_success() {
    [[ "$DEBUG_MODE" == "true" ]] && echo "[DEBUG] Function: log_success" >&2
    echo -e "${GREEN}[OK]${RESET} $*"
}

log_warn() {
    [[ "$DEBUG_MODE" == "true" ]] && echo "[DEBUG] Function: log_warn" >&2
    echo -e "${YELLOW}[WARN]${RESET} $*"
}

log_error() {
    [[ "$DEBUG_MODE" == "true" ]] && echo "[DEBUG] Function: log_error" >&2
    echo -e "${RED}[ERROR]${RESET} $*" >&2
}


# =============================================================================
# utils
# Source: lib/utils.sh
# =============================================================================

generate_random_name() {
    [[ "$DEBUG_MODE" == "true" ]] && echo "[DEBUG] Function: generate_random_name" >&2
    local adjectives=("happy" "quick" "silent" "wise" "brave" "fuzzy" "gentle" "shy" "fancy" "tiny" "giant" "strong")
    local actions=("run" "jump" "fly" "swim" "climb" "read" "hello" "goodbye" "sing" "whisper" "smile" "wink")
    local things=("tiger" "mountain" "river" "cloud" "forest" "moon" "star" "something" "echo" "flame" "ocean" "field")

    # Select one random adjective, one random action, and one random thing
    local first="${adjectives[$((RANDOM % ${#adjectives[@]}))]}"
    local second="${actions[$((RANDOM % ${#actions[@]}))]}"
    local third="${things[$((RANDOM % ${#things[@]}))]}"

    echo "${first}-${second}-${third}"
}

# =============================================================================
# EVM Key Operations
# =============================================================================

# Helper to generate an EVM wallet private key (64 hex chars) using Foundry's 'forge'
generate_evm_private_key() {
    [[ "$DEBUG_MODE" == "true" ]] && echo "[DEBUG] Function: generate_evm_private_key" >&2
    local private_key=$(cast wallet new 2>/dev/null | awk -F': ' '/Private key:/ {print $2}' | xargs)
    if [[ $? -ne 0 || -z "$private_key" ]]; then
        log_error "Failed to generate EVM private key using cast."
        return 1
    fi
    echo "$private_key"
}

# Helper to derive an EVM wallet address from a private key (64 hex chars) using 'cast'
get_evm_address_from_private_key() {
    [[ "$DEBUG_MODE" == "true" ]] && echo "[DEBUG] Function: get_evm_address_from_private_key" >&2
    local priv_key="$1"
    local address=$(cast wallet address --private-key "$priv_key" 2>/dev/null)
    if [[ $? -ne 0 || -z "$address" ]]; then
        log_error "Failed to compute EVM address from private key using cast."
        return 1
    fi
    echo "$address"
}

# =============================================================================
# Version Checking
# =============================================================================

# Checks if `cast` is installed and meets SUPPORTED_CAST_VERSION.
check_cast_version() {
    [[ "$DEBUG_MODE" == "true" ]] && echo "[DEBUG] Function: check_cast_version" >&2
    if ! command -v cast >/dev/null 2>&1; then
        log_error "'cast' (from Foundry) is not installed or not in PATH."
        return 1
    fi

    # Get current version ignoring "nightly". Extract first version in output (semver)
    cast_version_raw="$(cast --version 2>/dev/null | head -n1 | awk '{print $3}')"
    cast_version="${cast_version_raw%%-*}"  # Remove any -nightly or -foo
    required_version="${SUPPORTED_CAST_VERSION}"

    # Compare versions function (returns 0 if arg1 >= arg2)
    version_ge() {
        [ "$1" = "$2" ] && return 0
        local IFS=.
        local i ver1=($1) ver2=($2)
        # Fill empty fields in ver1 with zeros
        for ((i=${#ver1[@]}; i<${#ver2[@]}; i++)); do
            ver1[i]=0
        done
        for ((i=0; i<${#ver1[@]}; i++)); do
            [[ -z ${ver2[i]} ]] && ver2[i]=0
            if ((10#${ver1[i]} > 10#${ver2[i]})); then
                return 0
            elif ((10#${ver1[i]} < 10#${ver2[i]})); then
                return 1
            fi
        done
        return 0
    }

    if version_ge "$cast_version" "$required_version"; then
        log_success "Found 'cast' version $cast_version (required >= $required_version)"
        return 0
    else
        log_error "'cast' version $cast_version is less than required $required_version"
        return 1
    fi
}

# =============================================================================
# Directory Management
# =============================================================================

# Helper function to ensure a directory exists, creating it if necessary
ensure_dir_exists() {
    [[ "$DEBUG_MODE" == "true" ]] && echo "[DEBUG] Function: ensure_dir_exists" >&2
    local dir_path="$1"
    local description="$2"

    if [[ -z "${dir_path}" ]]; then
        log_error "${description} path is not set."
        return 1
    fi
    if [[ ! -d "${dir_path}" ]]; then
        log_info "Creating ${description}: ${dir_path}"
        mkdir -p "${dir_path}"
        if [[ $? -ne 0 ]]; then
            log_error "Failed to create ${description}: ${dir_path}"
            return 1
        fi
        log_success "${description} created: ${dir_path}"
    fi
    log_info "${description} exists: ${dir_path}"
}


# =============================================================================
# genesis
# Source: lib/genesis.sh
# =============================================================================

generate_eth_genesis_file() {
    [[ "$DEBUG_MODE" == "true" ]] && echo "[DEBUG] Function: generate_eth_genesis_file" >&2
    # Parse flags for function arguments with defaults

    # CHAIN IDENTITY
    # =============================================================================
    # Chain ID uniquely identifies this blockchain network. It's used in transaction
    # signing (EIP-155) to prevent replay attacks across different networks.
    # Berachain devnet uses chain ID 80087.
    # Berachain bepolia testnet uses chain ID 80069.
    # Berachain mainnet uses chain ID 80094.
    local genesis_file_path=""
    local chain_id="80087"  # Default: Berachain devnet chain ID

    # ETHEREUM HARD FORK BLOCK NUMBERS
    # =============================================================================
    # These values specify at which block number each Ethereum hard fork activates.
    # Setting them all to 0 means all upgrades are active from the genesis block.
    # This is standard practice for new EVM chains that want full compatibility.

    # Homestead (March 2016): Early protocol improvements
    # - EIP-2: Homestead gas cost changes
    # - EIP-7: DELEGATECALL opcode
    # - EIP-8: devp2p forward compatibility
    local eth_genesis_homestead_block="0"

    # DAO Fork (July 2016): Response to the DAO hack
    # daoForkSupport=true means we follow the forked chain (like mainnet Ethereum)
    local eth_genesis_dao_fork_block="0"
    local eth_genesis_dao_fork_support="true"

    # Tangerine Whistle / EIP-150 (October 2016)
    # Gas cost increases for IO-heavy operations to prevent DoS attacks
    local eth_genesis_eip150_block="0"

    # Spurious Dragon (November 2016)
    # - EIP-155: Replay attack protection using chain ID in tx signatures
    # - EIP-158: State clearing, account nonce rules
    local eth_genesis_eip155_block="0"
    local eth_genesis_eip158_block="0"

    # Byzantium (October 2017): Major upgrade including
    # - REVERT opcode, STATICCALL, precompiled contracts for zkSNARKs
    local eth_genesis_byzantium_block="0"

    # Constantinople (February 2019): Gas optimizations
    # - Bitwise shifting, CREATE2, EXTCODEHASH
    local eth_genesis_constantinople_block="0"

    # Petersburg (February 2019): Removed EIP-1283 due to reentrancy concerns
    local eth_genesis_petersburg_block="0"

    # Istanbul (December 2019): Gas repricing, new precompiles
    local eth_genesis_istanbul_block="0"

    # Muir Glacier (January 2020): Difficulty bomb delay
    local eth_genesis_muir_glacier_block="0"

    # Berlin (April 2021): Gas cost changes, access lists (EIP-2929, EIP-2930)
    local eth_genesis_berlin_block="0"

    # London (August 2021): EIP-1559 fee market, BASEFEE opcode
    local eth_genesis_london_block="0"

    # Arrow Glacier (December 2021): Difficulty bomb delay
    local eth_genesis_arrow_glacier_block="0"

    # Gray Glacier (June 2022): Final difficulty bomb delay before The Merge
    local eth_genesis_gray_glacier_block="0"

    # Merge Netsplit Block: The Merge transition (PoW -> PoS)
    local eth_genesis_merge_netsplit_block="0"

    # TIME-BASED FORK TIMESTAMPS (Post-Merge upgrades use timestamps, not blocks)
    # =============================================================================
    # Shanghai (April 2023): Beacon chain withdrawals, warm COINBASE, PUSH0 opcode
    # Timestamp 0 = active from genesis
    local eth_genesis_shanghai_time="0"

    # Cancun (March 2024): Blob transactions (EIP-4844) for L2 data availability
    # Timestamp 0 = active from genesis
    local eth_genesis_cancun_time="0"

    # Prague: Future Ethereum upgrade - scheduled for Berachain
    # Unix timestamp: 1749056400 = Wednesday, June 4, 2025 1:00:00 PM UTC
    local eth_genesis_prague_time="0"

    # PROOF-OF-STAKE CONFIGURATION
    # =============================================================================
    # Terminal Total Difficulty (TTD) is the cumulative PoW difficulty at which
    # the chain transitions to PoS (The Merge). Setting TTD=0 means the chain
    # starts as PoS from genesis with no PoW phase.
    local eth_genesis_terminal_total_difficulty="0"
    local eth_genesis_terminal_total_difficulty_passed="true"

    # BLOB TRANSACTION CONFIGURATION (EIP-4844)
    # =============================================================================
    # Blobs are large data chunks used primarily by Layer 2 rollups.
    # These parameters control blob gas pricing and limits.

    # Target blobs per block (the "ideal" number for fee stability)
    local eth_genesis_blob_target="3"

    # Maximum blobs allowed per block
    local eth_genesis_blob_max="6"

    # Controls how quickly blob base fee adjusts to demand
    # Higher value = slower adjustment. Formula: new_fee = old_fee * e^((actual-target)/fraction)
    local eth_genesis_blob_base_fee_update_fraction="3338477"

    # BERACHAIN-SPECIFIC CONFIGURATION (Prague 1-N)
    # =============================================================================
    # Support for multiple Prague upgrades: prague_times*, prague_base_fee_change_denominator*, etc.
    # Example: for n=1,2,3...
    local -a prague_times=()
    local -a prague_base_fee_change_denominator=()
    local -a prague_min_base_fee=()
    local -a prague_pol_distributor=()
    local -a prague_bex_vault=()
    local -a prague_rescue_address=()
    local -a prague_blocked_addresses=()

    # GENESIS CONFIGURATION
    # =============================================================================
    local genesis_coinbase_address="0x0000000000000000000000000000000000000000"
    local genesis_difficulty="0x01"
    local genesis_extra_data="0x0000000000000000000000000000000000000000000000000000000000000000"
    local genesis_gas_limit="0x1c9c380"
    local genesis_nonce="0x1234"
    local genesis_mix_hash="0x0000000000000000000000000000000000000000000000000000000000000000"
    local genesis_parent_hash="0x0000000000000000000000000000000000000000000000000000000000000000"
    local genesis_timestamp="0"

    # PRE-DEPLOYED CONTRACT BYTECODE
    # =============================================================================
    local eth_genesis_beacon_roots_address="$ETH_GENESIS_BEACON_ROOTS_ADDRESS"
    local eth_genesis_beacon_roots_code="$ETH_GENESIS_BEACON_ROOTS_CODE"
    local eth_genesis_beacon_roots_balance="$ETH_GENESIS_BEACON_ROOTS_BALANCE"
    local eth_genesis_beacon_roots_nonce="$ETH_GENESIS_BEACON_ROOTS_NONCE"
    local eth_genesis_create2_deployer_address="$ETH_GENESIS_CREATE2_DEPLOYER_ADDRESS"
    local eth_genesis_create2_deployer_code="$ETH_GENESIS_CREATE2_DEPLOYER_CODE"
    local eth_genesis_create2_deployer_balance="$ETH_GENESIS_CREATE2_DEPLOYER_BALANCE"
    local eth_genesis_create2_deployer_nonce="$ETH_GENESIS_CREATE2_DEPLOYER_NONCE"
    local eth_genesis_multicall3_address="$ETH_GENESIS_MULTICALL3_ADDRESS"
    local eth_genesis_multicall3_balance="$ETH_GENESIS_MULTICALL3_BALANCE"
    local eth_genesis_multicall3_nonce="$ETH_GENESIS_MULTICALL3_NONCE"
    local eth_genesis_multicall3_code="$ETH_GENESIS_MULTICALL3_CODE"
    local eth_genesis_wbera_address="$ETH_GENESIS_WBERA_ADDRESS"
    local eth_genesis_wbera_code="$ETH_GENESIS_WBERA_CODE"
    local eth_genesis_wbera_balance="$ETH_GENESIS_WBERA_BALANCE"
    local eth_genesis_wbera_nonce="$ETH_GENESIS_WBERA_NONCE"
    local eth_genesis_permit2_address="$ETH_GENESIS_PERMIT2_ADDRESS"
    local eth_genesis_permit2_code="$ETH_GENESIS_PERMIT2_CODE"
    local eth_genesis_permit2_balance="$ETH_GENESIS_PERMIT2_BALANCE"
    local eth_genesis_permit2_nonce="$ETH_GENESIS_PERMIT2_NONCE"
    local eth_genesis_beacon_deposit_address="$ETH_GENESIS_BEACON_DEPOSIT_ADDRESS"
    local eth_genesis_beacon_deposit_code="$ETH_GENESIS_BEACON_DEPOSIT_CODE"
    local eth_genesis_beacon_deposit_balance="$ETH_GENESIS_BEACON_DEPOSIT_BALANCE"
    local eth_genesis_beacon_deposit_nonce="$ETH_GENESIS_BEACON_DEPOSIT_NONCE"
    local eth_genesis_beacon_deposit_storage_key="$ETH_GENESIS_BEACON_DEPOSIT_STORAGE_KEY"
    local eth_genesis_beacon_deposit_storage_value="$ETH_GENESIS_BEACON_DEPOSIT_STORAGE_VALUE"

    # Custom contracts
    # =============================================================================
    local -a eth_genesis_custom_contract_address=()
    local -a eth_genesis_custom_contract_nonce=()
    local -a eth_genesis_custom_contract_code=()
    local -a eth_genesis_custom_contract_balance=()
    local -a eth_genesis_custom_contract_storage=()

    # Genesis allocations
    # =============================================================================
    local eth_genesis_allocations=()

    # Parse flags
    while [[ $# -gt 0 ]]; do
        key="$1"
        case $key in
            --genesis-file-path)
                genesis_file_path="$2"
                shift 2
                ;;
            --chain-id)
                chain_id="$2"
                shift 2
                ;;
            --homestead-block)
                eth_genesis_homestead_block="${2:-0}"
                shift 2
                ;;
            --dao-fork-block)
                eth_genesis_dao_fork_block="${2:-0}"
                shift 2
                ;;
            --dao-fork-support)
                eth_genesis_dao_fork_support="${2:-true}"
                shift 2
                ;;
            --eip150-block)
                eth_genesis_eip150_block="${2:-0}"
                shift 2
                ;;
            --eip155-block)
                eth_genesis_eip155_block="${2:-0}"
                shift 2
                ;;
            --eip158-block)
                eth_genesis_eip158_block="${2:-0}"
                shift 2
                ;;
            --byzantium-block)
                eth_genesis_byzantium_block="${2:-0}"
                shift 2
                ;;
            --constantinople-block)
                eth_genesis_constantinople_block="${2:-0}"
                shift 2
                ;;
            --petersburg-block)
                eth_genesis_petersburg_block="${2:-0}"
                shift 2
                ;;
            --istanbul-block)
                eth_genesis_istanbul_block="${2:-0}"
                shift 2
                ;;
            --muir-glacier-block)
                eth_genesis_muir_glacier_block="${2:-0}"
                shift 2
                ;;
            --berlin-block)
                eth_genesis_berlin_block="${2:-0}"
                shift 2
                ;;
            --london-block)
                eth_genesis_london_block="${2:-0}"
                shift 2
                ;;
            --arrow-glacier-block)
                eth_genesis_arrow_glacier_block="${2:-0}"
                shift 2
                ;;
            --gray-glacier-block)
                eth_genesis_gray_glacier_block="${2:-0}"
                shift 2
                ;;
            --merge-netsplit-block)
                eth_genesis_merge_netsplit_block="${2:-0}"
                shift 2
                ;;
            --shanghai-time)
                eth_genesis_shanghai_time="${2:-0}"
                shift 2
                ;;
            --cancun-time)
                eth_genesis_cancun_time="${2:-0}"
                shift 2
                ;;
            --prague-time)
                eth_genesis_prague_time="${2:-0}"
                shift 2
                ;;
            --terminal-total-difficulty)
                eth_genesis_terminal_total_difficulty="${2:-0}"
                shift 2
                ;;
            --terminal-total-difficulty-passed)
                eth_genesis_terminal_total_difficulty_passed="${2:-true}"
                shift 2
                ;;
            --blob-target)
                eth_genesis_blob_target="${2:-3}"
                shift 2
                ;;
            --blob-max)
                eth_genesis_blob_max="${2:-6}"
                shift 2
                ;;
            --blob-base-fee-update-fraction)
                eth_genesis_blob_base_fee_update_fraction="${2:-3338477}"
                shift 2
                ;;
            # Handle --pragueN-... flags generically for N in [1, 2, ...]
            --prague*-time)
                prague_epoch="${1#--prague}"
                prague_num="${prague_epoch%%-*}"
                prague_times[prague_num]="$2"
                shift 2
                ;;
            --prague*-base-fee-change-denominator)
                prague_epoch="${1#--prague}"
                prague_num="${prague_epoch%%-*}"
                prague_base_fee_change_denominator[prague_num]="$2"
                shift 2
                ;;
            --prague*-min-base-fee)
                prague_epoch="${1#--prague}"
                prague_num="${prague_epoch%%-*}"
                prague_min_base_fee[prague_num]="$2"
                shift 2
                ;;
            --prague*-pol-distributor)
                prague_epoch="${1#--prague}"
                prague_num="${prague_epoch%%-*}"
                prague_pol_distributor[prague_num]="$2"
                shift 2
                ;;
            --prague*-bex-vault)
                prague_epoch="${1#--prague}"
                prague_num="${prague_epoch%%-*}"
                prague_bex_vault[prague_num]="$2"
                shift 2
                ;;
            --prague*-rescue-address)
                prague_epoch="${1#--prague}"
                prague_num="${prague_epoch%%-*}"
                prague_rescue_address[prague_num]="$2"
                shift 2
                ;;
            --prague*-blocked-addresses)
                prague_epoch="${1#--prague}"
                prague_num="${prague_epoch%%-*}"
                IFS=',' read -ra addresses <<< "$2"

                valid_addresses=1
                formatted_addresses=()
                for addr in "${addresses[@]}"; do
                    if [[ "$addr" =~ ^0x[0-9a-fA-F]+$ ]]; then
                        formatted_addresses+=("$addr")
                    else
                        valid_addresses=0
                        break
                    fi
                done

                if [[ $valid_addresses -eq 1 ]]; then
                    # Store as comma-separated values (as in original)
                    prague_blocked_addresses[prague_num]=$(IFS=,; echo "${formatted_addresses[*]}")
                else
                    log_error "Invalid format for $1: expected comma-separated 0x addresses, got '$2'"
                    return 1
                fi
                shift 2
                ;;
            --genesis-coinbase-address)
                genesis_coinbase_address="${2:-0x0000000000000000000000000000000000000000}"
                shift 2
                ;;
            --genesis-difficulty)
                genesis_difficulty="${2:-0x01}"
                shift 2
                ;;
            --genesis-extra-data)
                genesis_extra_data="${2:-0x0000000000000000000000000000000000000000000000000000000000000000}"
                shift 2
                ;;
            --genesis-gas-limit)
                genesis_gas_limit="${2:-0x1c9c380}"
                shift 2
                ;;
            --genesis-nonce)
                genesis_nonce="${2:-0x1234}"
                shift 2
                ;;
            --genesis-mix-hash)
                genesis_mix_hash="${2:-0x0000000000000000000000000000000000000000000000000000000000000000}"
                shift 2
                ;;
            --genesis-parent-hash)
                genesis_parent_hash="${2:-0x0000000000000000000000000000000000000000000000000000000000000000}"
                shift 2
                ;;
            --genesis-timestamp)
                genesis_timestamp="${2:-0}"
                shift 2
                ;;
            --eth-genesis-beacon-roots-address)
                eth_genesis_beacon_roots_address="${2:-$ETH_GENESIS_BEACON_ROOTS_ADDRESS}"
                shift 2
                ;;
            --eth-genesis-beacon-roots-code)
                eth_genesis_beacon_roots_code="${2:-$ETH_GENESIS_BEACON_ROOTS_CODE}"
                shift 2
                ;;
            --eth-genesis-beacon-roots-balance)
                eth_genesis_beacon_roots_balance="${2:-$ETH_GENESIS_BEACON_ROOTS_BALANCE}"
                shift 2
                ;;
            --eth-genesis-beacon-roots-nonce)
                eth_genesis_beacon_roots_nonce="${2:-$ETH_GENESIS_BEACON_ROOTS_NONCE}"
                shift 2
                ;;
            --eth-genesis-create2-deployer-address)
                eth_genesis_create2_deployer_address="${2:-$ETH_GENESIS_CREATE2_DEPLOYER_ADDRESS}"
                shift 2
                ;;
            --eth-genesis-create2-deployer-code)
                eth_genesis_create2_deployer_code="${2:-$ETH_GENESIS_CREATE2_DEPLOYER_CODE}"
                shift 2
                ;;
            --eth-genesis-create2-deployer-balance)
                eth_genesis_create2_deployer_balance="${2:-$ETH_GENESIS_CREATE2_DEPLOYER_BALANCE}"
                shift 2
                ;;
            --eth-genesis-create2-deployer-nonce)
                eth_genesis_create2_deployer_nonce="${2:-$ETH_GENESIS_CREATE2_DEPLOYER_NONCE}"
                shift 2
                ;;
            --eth-genesis-multicall3-address)
                eth_genesis_multicall3_address="${2:-$ETH_GENESIS_MULTICALL3_ADDRESS}"
                shift 2
                ;;
            --eth-genesis-multicall3-code)
                eth_genesis_multicall3_code="${2:-$ETH_GENESIS_MULTICALL3_CODE}"
                shift 2
                ;;
            --eth-genesis-multicall3-balance)
                eth_genesis_multicall3_balance="${2:-$ETH_GENESIS_MULTICALL3_BALANCE}"
                shift 2
                ;;
            --eth-genesis-multicall3-nonce)
                eth_genesis_multicall3_nonce="${2:-$ETH_GENESIS_MULTICALL3_NONCE}"
                shift 2
                ;;
            --eth-genesis-wbera-address)
                eth_genesis_wbera_address="${2:-$ETH_GENESIS_WBERA_ADDRESS}"
                shift 2
                ;;
            --eth-genesis-wbera-code)
                eth_genesis_wbera_code="${2:-$ETH_GENESIS_WBERA_CODE}"
                shift 2
                ;;
            --eth-genesis-wbera-balance)
                eth_genesis_wbera_balance="${2:-$ETH_GENESIS_WBERA_BALANCE}"
                shift 2
                ;;
            --eth-genesis-wbera-nonce)
                eth_genesis_wbera_nonce="${2:-$ETH_GENESIS_WBERA_NONCE}"
                shift 2
                ;;
            --eth-genesis-permit2-address)
                eth_genesis_permit2_address="${2:-$ETH_GENESIS_PERMIT2_ADDRESS}"
                shift 2
                ;;
            --eth-genesis-permit2-code)
                eth_genesis_permit2_code="${2:-$ETH_GENESIS_PERMIT2_CODE}"
                shift 2
                ;;
            --eth-genesis-permit2-balance)
                eth_genesis_permit2_balance="${2:-$ETH_GENESIS_PERMIT2_BALANCE}"
                shift 2
                ;;
            --eth-genesis-permit2-nonce)
                eth_genesis_permit2_nonce="${2:-$ETH_GENESIS_PERMIT2_NONCE}"
                shift 2
                ;;
            --eth-genesis-beacon-deposit-address)
                eth_genesis_beacon_deposit_address="${2:-$ETH_GENESIS_BEACON_DEPOSIT_ADDRESS}"
                shift 2
                ;;
            --eth-genesis-beacon-deposit-code)
                eth_genesis_beacon_deposit_code="${2:-$ETH_GENESIS_BEACON_DEPOSIT_CODE}"
                shift 2
                ;;
            --eth-genesis-beacon-deposit-balance)
                eth_genesis_beacon_deposit_balance="${2:-$ETH_GENESIS_BEACON_DEPOSIT_BALANCE}"
                shift 2
                ;;
            --eth-genesis-beacon-deposit-nonce)
                eth_genesis_beacon_deposit_nonce="${2:-$ETH_GENESIS_BEACON_DEPOSIT_NONCE}"
                shift 2
                ;;
            --eth-genesis-beacon-deposit-storage-key)
                # Accept an array of storage keys as a comma-separated string, and split into a Bash array
                IFS=',' read -ra eth_genesis_beacon_deposit_storage_key <<< "${2:-$(IFS=,; echo "${ETH_GENESIS_BEACON_DEPOSIT_STORAGE_KEY[*]}")}"
                shift 2
                ;;
            --eth-genesis-beacon-deposit-storage-value)
                # Accept an array of storage values as a comma-separated string, and split into a Bash array
                IFS=',' read -ra eth_genesis_beacon_deposit_storage_value <<< "${2:-$(IFS=,; echo "${ETH_GENESIS_BEACON_DEPOSIT_STORAGE_VALUE[*]}")}"
                shift 2
                ;;
             --eth-genesis-custom*-contract-address)
                # Extract the custom contract index from the flag (e.g., --eth-genesis-custom1-contract-address)
                # Valid flag pattern is --eth-genesis-custom<index>-contract-address
                index="${1#--eth-genesis-custom}"
                index="${index%-contract-address}"

                # Only process if the provided address starts with 0x01 (as a hex string)
                if [[ "${2}" == 0x* ]]; then
                    eth_genesis_custom_contract_address[index]="${2}"
                fi
                shift 2
                ;;
            --eth-genesis-custom*-contract-code)
                # Extract the custom contract index from the flag (e.g., --eth-genesis-custom1-contract-code)
                # Valid flag pattern is --eth-genesis-custom<index>-contract-code
                index="${1#--eth-genesis-custom}"
                index="${index%-contract-code}"

                # Only process if the provided code starts with 0x01 (as a hex string)
                if [[ "${2}" == 0x* ]]; then
                    eth_genesis_custom_contract_code[index]="${2}"
                fi
                shift 2
                ;;
            --eth-genesis-custom*-contract-balance)
                # Extract the custom contract index from the flag (e.g., --eth-genesis-custom1-contract-balance)
                # Valid flag pattern is --eth-genesis-custom<index>-contract-balance
                index="${1#--eth-genesis-custom}"
                index="${index%-contract-balance}"

                # Only process if the provided balance starts with 0x01 (as a hex string)
                eth_genesis_custom_contract_balance[index]="${2}"
                shift 2
                ;;
            --eth-genesis-custom*-contract-nonce)
                # Extract the custom contract index from the flag (e.g., --eth-genesis-custom1-contract-nonce)
                # Valid flag pattern is --eth-genesis-custom<index>-contract-nonce
                index="${1#--eth-genesis-custom}"
                index="${index%-contract-nonce}"

                # Only process if the provided nonce starts with 0x01 (as a hex string)
                if [[ "${2}" == 0x* ]]; then
                    eth_genesis_custom_contract_nonce[index]="${2}"
                fi
                shift 2
                ;;
            --eth-genesis-custom*-contract-storage)
                # Extract the custom contract index from the flag (e.g., --eth-genesis-custom7-contract-storage)
                # Valid flag pattern is --eth-genesis-custom<index>-contract-storage
                index="${1#--eth-genesis-custom}"
                index="${index%-contract-storage}"

                # The value must be a comma-separated list of storage entries: 0xKEY=VALUE,...
                # We'll validate and transform this to a canonical format array
                storage_arg="$2"
                valid_format=1
                formatted_storage=""

                # Check the whole flag value for expected format: 0xKEY=VALUE,0xKEY2=VALUE2,...
                IFS=',' read -ra entries <<< "$storage_arg"
                for entry in "${entries[@]}"; do
                    # Each entry must be of the form 0xKEY=VALUE
                    if [[ "$entry" =~ ^0x[0-9a-fA-F]+=[0-9a-fA-Fx]+$ ]]; then
                        # Format each pair as JSON-style string for later use if needed.
                        [[ -n "$formatted_storage" ]] && formatted_storage+=","
                        formatted_storage+="$entry"
                    else
                        valid_format=0
                        break
                    fi
                done

                if [[ $valid_format -eq 1 ]]; then
                    eth_genesis_custom_contract_storage[index]="$formatted_storage"
                else
                    log_error "Invalid format for $1: expected '0xKEY=VALUE[,0xKEY2=VALUE2...]' got '$2'"
                    return 1
                fi
                shift 2
                ;;
            --eth-genesis-allocations)
                # Accept one or more allocations of the form 0xADDR=VALUE[,0xADDR2=VALUE2...]
                # Handle both multiple and single value scenarios
                if [[ -n "${2-}" ]]; then
                    IFS=',' read -ra eth_genesis_allocations <<< "$2"
                else
                    # Fallback to ETH_GENESIS_ALLOCATIONS env or default
                    IFS=',' read -ra eth_genesis_allocations <<< "${ETH_GENESIS_ALLOCATIONS[*]}"
                fi
                shift 2
                ;;
            *)
                echo "Unknown flag: $1"
                shift
                ;;
        esac
    done

    # Print first instance of eth_genesis_custom_contract_address if set
    if [[ ${#eth_genesis_custom_contract_address[@]} -gt 0 ]]; then
        echo "eth_genesis_custom_contract_address: ${eth_genesis_custom_contract_address[0]}"
    else
        echo "eth_genesis_custom_contract_address: (unset)"
    fi
    # TESTING
    # echo "eth_genesis_custom_contract_nonce: ${eth_genesis_custom_contract_nonce[0]}"
    # echo "eth_genesis_custom_contract_code: ${eth_genesis_custom_contract_code[0]}"
    # echo "eth_genesis_custom_contract_balance: ${eth_genesis_custom_contract_balance[0]}"
    # echo "eth_genesis_custom_contract_storage: ${eth_genesis_custom_contract_storage[0]}"
    # exit 1

    # Check for required arguments
    if [[ -z "$genesis_file_path" ]]; then
        log_error "Missing required flag: --genesis-file-path"
        return 1
    fi

    # Build the berachain section
    _eth_genesis_build_berachain_section() {
        local sections=()

        # Iterate over prague_times array (should be indexed by prague number)
        for i in "${!prague_times[@]}"; do
            # Only build for pragueN where time is set and non-empty
            if [[ -n "${prague_times[$i]}" ]]; then
                local section_lines=()
                local indent='            '

                # time
                if [[ -n "${prague_times[$i]}" ]]; then
                    section_lines+=("${indent}\"time\": ${prague_times[$i]}")
                fi

                # baseFeeChangeDenominator
                if [[ -n "${prague_base_fee_change_denominator[$i]:-}" ]]; then
                    section_lines+=("${indent}\"baseFeeChangeDenominator\": ${prague_base_fee_change_denominator[$i]}")
                fi

                # minimumBaseFeeWei
                if [[ -n "${prague_min_base_fee[$i]:-}" ]]; then
                    section_lines+=("${indent}\"minimumBaseFeeWei\": ${prague_min_base_fee[$i]}")
                fi

                # polDistributorAddress
                if [[ -n "${prague_pol_distributor[$i]:-}" ]]; then
                    section_lines+=("${indent}\"polDistributorAddress\": \"${prague_pol_distributor[$i]}\"")
                fi

                # bexVaultAddress
                if [[ -n "${prague_bex_vault[$i]:-}" ]]; then
                    section_lines+=("${indent}\"bexVaultAddress\": \"${prague_bex_vault[$i]}\"")
                fi

                # rescueAddress
                if [[ -n "${prague_rescue_address[$i]:-}" ]]; then
                    section_lines+=("${indent}\"rescueAddress\": \"${prague_rescue_address[$i]}\"")
                fi

                # blockedAddresses
                if [[ -n "${prague_blocked_addresses[$i]+set}" && -n "${prague_blocked_addresses[$i]}" ]]; then
                    IFS=',' read -ra addresses <<< "${prague_blocked_addresses[$i]}"
                    local formatted="[\n"
                    local num_addresses=0
                    for j in "${!addresses[@]}"; do
                        local addr_trimmed="$(echo -n "${addresses[j]}" | xargs)"
                        if [[ -n "$addr_trimmed" ]]; then
                            (( num_addresses > 0 )) && formatted+=",\n"
                            formatted+="                \"$addr_trimmed\""
                            ((num_addresses++))
                        fi
                    done
                    formatted+="\n            ]"
                    section_lines+=("${indent}\"blockedAddresses\": ${formatted}")
                fi

                # Build the section json with correct indentation (12 spaces for level 2, 8 for berachain line)
                local section="        \"prague${i}\": {\n"
                for j in "${!section_lines[@]}"; do
                    section+="${section_lines[$j]}"
                    [[ $j -lt $((${#section_lines[@]}-1)) ]] && section+=",\n" || section+="\n"
                done
                section+="        }"
                sections+=("$section")
            fi
        done

        # Output all sections, comma-separated (with no trailing comma), add appropriate tabs
        local output=""
        for idx in "${!sections[@]}"; do
            [[ $idx -gt 0 ]] && output+=",\n"
            output+="${sections[$idx]}"
        done
        echo -e "$output"
    }

    # Build the contracts alloc section
    _build_contracts_alloc() {
      local contract_alloc_lines=()
      local indent='    '

      # beacon roots
      if [[ -n "${eth_genesis_beacon_roots_address}" ]]; then
        contract_alloc_lines+=("${indent}\"${eth_genesis_beacon_roots_address}\": {")
        contract_alloc_lines+=("${indent}  \"balance\": \"${eth_genesis_beacon_roots_balance}\",")
        contract_alloc_lines+=("${indent}  \"nonce\": \"${eth_genesis_beacon_roots_nonce}\",")
        contract_alloc_lines+=("${indent}  \"code\": \"${eth_genesis_beacon_roots_code}\"")
        if [[ -n "${eth_genesis_create2_deployer_address}" ]]; then
          contract_alloc_lines+=("${indent}},")
        else
          contract_alloc_lines+=("${indent}}")
        fi
      fi

      # create2 deployer
      if [[ -n "${eth_genesis_create2_deployer_address}" ]]; then
        contract_alloc_lines+=("${indent}\"${eth_genesis_create2_deployer_address}\": {")
        contract_alloc_lines+=("${indent}  \"balance\": \"${eth_genesis_create2_deployer_balance}\",")
        contract_alloc_lines+=("${indent}  \"nonce\": \"${eth_genesis_create2_deployer_nonce}\",")
        contract_alloc_lines+=("${indent}  \"code\": \"${eth_genesis_create2_deployer_code}\"")
        if [[ -n "${eth_genesis_multicall3_address}" ]]; then
          contract_alloc_lines+=("${indent}},")
        else
          contract_alloc_lines+=("${indent}}")
        fi
      fi

      # multicall3
      if [[ -n "${eth_genesis_multicall3_address}" ]]; then
        contract_alloc_lines+=("${indent}\"${eth_genesis_multicall3_address}\": {")
        contract_alloc_lines+=("${indent}  \"balance\": \"${eth_genesis_multicall3_balance}\",")
        contract_alloc_lines+=("${indent}  \"nonce\": \"${eth_genesis_multicall3_nonce}\",")
        contract_alloc_lines+=("${indent}  \"code\": \"${eth_genesis_multicall3_code}\"")
        if [[ -n "${eth_genesis_wbera_address}" ]]; then
          contract_alloc_lines+=("${indent}},")
        else
          contract_alloc_lines+=("${indent}}")
        fi
      fi

      # wbera
      if [[ -n "${eth_genesis_wbera_address}" ]]; then
        contract_alloc_lines+=("${indent}\"${eth_genesis_wbera_address}\": {")
        contract_alloc_lines+=("${indent}  \"balance\": \"${eth_genesis_wbera_balance}\",")
        contract_alloc_lines+=("${indent}  \"nonce\": \"${eth_genesis_wbera_nonce}\",")
        contract_alloc_lines+=("${indent}  \"code\": \"${eth_genesis_wbera_code}\"")
        if [[ -n "${eth_genesis_permit2_address}" ]]; then
          contract_alloc_lines+=("${indent}},")
        else
          contract_alloc_lines+=("${indent}}")
        fi
      fi

      # permit2
      if [[ -n "${eth_genesis_permit2_address}" ]]; then
        contract_alloc_lines+=("${indent}\"${eth_genesis_permit2_address}\": {")
        contract_alloc_lines+=("${indent}  \"balance\": \"${eth_genesis_permit2_balance}\",")
        contract_alloc_lines+=("${indent}  \"nonce\": \"${eth_genesis_permit2_nonce}\",")
        contract_alloc_lines+=("${indent}  \"code\": \"${eth_genesis_permit2_code}\"")
        if [[ -n "${eth_genesis_beacon_deposit_address}" ]]; then
          contract_alloc_lines+=("${indent}},")
        else
          contract_alloc_lines+=("${indent}}")
        fi
      fi

      # beacon deposit
      if [[ -n "${eth_genesis_beacon_deposit_address}" ]]; then
        contract_alloc_lines+=("${indent}\"${eth_genesis_beacon_deposit_address}\": {")
        contract_alloc_lines+=("${indent}  \"balance\": \"${eth_genesis_beacon_deposit_balance}\",")
        contract_alloc_lines+=("${indent}  \"nonce\": \"${eth_genesis_beacon_deposit_nonce}\",")
        if [[ -n "${eth_genesis_beacon_deposit_storage_key}" ]]; then
          contract_alloc_lines+=("${indent}  \"code\": \"${eth_genesis_beacon_deposit_code}\",")
          contract_alloc_lines+=("${indent}  \"storage\": {")
          # Split storage keys/values on comma if string contains ',' (to support "0x1,0x2" format)
          storage_keys=()
          storage_values=()
          if [[ "${#eth_genesis_beacon_deposit_storage_key[@]}" -eq 1 && "${eth_genesis_beacon_deposit_storage_key[0]}" == *,* ]]; then
            IFS=',' read -ra storage_keys <<< "${eth_genesis_beacon_deposit_storage_key[0]}"
          else
            storage_keys=("${eth_genesis_beacon_deposit_storage_key[@]}")
          fi
          if [[ "${#eth_genesis_beacon_deposit_storage_value[@]}" -eq 1 && "${eth_genesis_beacon_deposit_storage_value[0]}" == *,* ]]; then
            IFS=',' read -ra storage_values <<< "${eth_genesis_beacon_deposit_storage_value[0]}"
          else
            storage_values=("${eth_genesis_beacon_deposit_storage_value[@]}")
          fi

          storage_len=${#storage_keys[@]}
          for i in "${!storage_keys[@]}"; do
            if [[ $i -lt $((storage_len-1)) ]]; then
              contract_alloc_lines+=("${indent}    \"${storage_keys[$i]}\": \"${storage_values[$i]}\",")
            else
              contract_alloc_lines+=("${indent}    \"${storage_keys[$i]}\": \"${storage_values[$i]}\"")
            fi
          done
          contract_alloc_lines+=("${indent}  }")
        else
          contract_alloc_lines+=("${indent}  \"code\": \"${eth_genesis_beacon_deposit_code}\"")
        fi
        contract_alloc_lines+=("${indent}}")
      fi

      # Output all contract allocations, comma-separated (with no trailing comma), add appropriate tabs
      local output=""
      for idx in "${!contract_alloc_lines[@]}"; do
          [[ $idx -gt 0 ]] && output+="\n"
          output+="${contract_alloc_lines[$idx]}"
      done
      echo -e "$output"
    }

    # Build the custom contracts alloc section
    _build_custom_alloc() {
      local contract_custom_alloc_lines=()
      local indent='    '
      local contract_custom_alloc_count=${#eth_genesis_custom_contract_address[@]}

      for index in "${!eth_genesis_custom_contract_address[@]}"; do
        # Only proceed if the contract address is set (required for a valid allocation)
        if [[ -n "${eth_genesis_custom_contract_address[$index]:-}" ]]; then
          contract_custom_alloc_lines+=("${indent}\"${eth_genesis_custom_contract_address[$index]}\": {")
          # Only include balance if set
          if [[ -n "${eth_genesis_custom_contract_balance[$index]:-}" ]]; then
            local line="${indent}  \"balance\": \"${eth_genesis_custom_contract_balance[$index]}\""
            if [[ -n "${eth_genesis_custom_contract_nonce[$index]:-}" || -n "${eth_genesis_custom_contract_code[$index]:-}" || -n "${eth_genesis_custom_contract_storage[$index]:-}" ]]; then
              line+=","
            fi
            contract_custom_alloc_lines+=("${line}")
          fi
          # Only include nonce if set
          if [[ -n "${eth_genesis_custom_contract_nonce[$index]:-}" ]]; then
            local line="${indent}  \"nonce\": \"${eth_genesis_custom_contract_nonce[$index]}\""
            if [[ -n "${eth_genesis_custom_contract_code[$index]:-}" || -n "${eth_genesis_custom_contract_storage[$index]:-}" ]]; then
              line+=","
            fi
            contract_custom_alloc_lines+=("${line}")
          fi
          # Only include code if set
          if [[ -n "${eth_genesis_custom_contract_code[$index]:-}" ]]; then
            local line="${indent}  \"code\": \"${eth_genesis_custom_contract_code[$index]}\""
            if [[ -n "${eth_genesis_custom_contract_storage[$index]:-}" ]]; then
              line+=","
            fi
            contract_custom_alloc_lines+=("${line}")
          fi
          # Only include storage if set
          if [[ -n "${eth_genesis_custom_contract_storage[$index]:-}" ]]; then
            local line="${indent}  \"storage\": {\n"

            # Process comma-separated storage entries for the current custom contract
            # eth_genesis_custom_contract_storage[$index] will look like: "0x01=0x01,0x02=0x02,0x03=0x05"
            if [[ -n "${eth_genesis_custom_contract_storage[$index]}" ]]; then
              IFS=',' read -ra storage_entries <<< "${eth_genesis_custom_contract_storage[$index]}"
              for entry_idx in "${!storage_entries[@]}"; do
                entry="${storage_entries[$entry_idx]}"
                storage_key="${entry%%=*}"
                storage_value="${entry#*=}"
                line+="${indent}    \"${storage_key}\": \"${storage_value}\""
                # If not the last entry, add a comma
                if [[ $entry_idx -lt $(( ${#storage_entries[@]} - 1 )) ]]; then
                  line+=",\n"
                else
                  line+="\n"
                fi
              done
            fi

            line+="${indent}  }"
            contract_custom_alloc_lines+=("${line}")
          fi

          # Remove trailing comma if present before closing } (optional for improved JSON validity)
          if [[ "${contract_custom_alloc_lines[-1]}" =~ ,$ ]]; then
            contract_custom_alloc_lines[-1]="${contract_custom_alloc_lines[-1]%,}"
          fi
          if [[ $index -lt $((contract_custom_alloc_count-1)) ]]; then
            contract_custom_alloc_lines+=("${indent}},")
          else
            contract_custom_alloc_lines+=("${indent}}")
          fi
        fi
      done

      # Output all custom contract allocations, comma-separated (with no trailing comma), add appropriate tabs
      local output=""
      if [[ ${#contract_custom_alloc_lines[@]} -gt 0 ]]; then
        output+=",\n"
      fi
      for idx in "${!contract_custom_alloc_lines[@]}"; do
          [[ $idx -gt 0 ]] && output+="\n"
          output+="${contract_custom_alloc_lines[$idx]}"
      done
      echo -e "$output"
    }

    cat > "$genesis_file_path" <<EOF
{
  "config": {
    "chainId": ${chain_id},
    "homesteadBlock": ${eth_genesis_homestead_block},
    "daoForkBlock": ${eth_genesis_dao_fork_block},
    "daoForkSupport": ${eth_genesis_dao_fork_support},
    "eip150Block": ${eth_genesis_eip150_block},
    "eip155Block": ${eth_genesis_eip155_block},
    "eip158Block": ${eth_genesis_eip158_block},
    "byzantiumBlock": ${eth_genesis_byzantium_block},
    "constantinopleBlock": ${eth_genesis_constantinople_block},
    "petersburgBlock": ${eth_genesis_petersburg_block},
    "istanbulBlock": ${eth_genesis_istanbul_block},
    "muirGlacierBlock": ${eth_genesis_muir_glacier_block},
    "berlinBlock": ${eth_genesis_berlin_block},
    "londonBlock": ${eth_genesis_london_block},
    "arrowGlacierBlock": ${eth_genesis_arrow_glacier_block},
    "grayGlacierBlock": ${eth_genesis_gray_glacier_block},
    "mergeNetsplitBlock": ${eth_genesis_merge_netsplit_block},
    "shanghaiTime": ${eth_genesis_shanghai_time},
    "cancunTime": ${eth_genesis_cancun_time},
    "pragueTime": ${eth_genesis_prague_time},
    "terminalTotalDifficulty": ${eth_genesis_terminal_total_difficulty},
    "terminalTotalDifficultyPassed": ${eth_genesis_terminal_total_difficulty_passed},
    "blobSchedule": {
      "cancun": {
        "target": ${eth_genesis_blob_target},
        "max": ${eth_genesis_blob_max},
        "baseFeeUpdateFraction": ${eth_genesis_blob_base_fee_update_fraction}
      },
      "prague": {
        "target": ${eth_genesis_blob_target},
        "max": ${eth_genesis_blob_max},
        "baseFeeUpdateFraction": ${eth_genesis_blob_base_fee_update_fraction}
      }
    },
    "berachain": {
$(_eth_genesis_build_berachain_section)
    },
    "ethash": {}
  },
  "coinbase": "${genesis_coinbase_address}",
  "difficulty": "${genesis_difficulty}",
  "extraData": "${genesis_extra_data}",
  "gasLimit": "${genesis_gas_limit}",
  "nonce": "${genesis_nonce}",
  "mixhash": "${genesis_mix_hash}",
  "parentHash": "${genesis_parent_hash}",
  "timestamp": "${genesis_timestamp}",
  "alloc": {
$(_build_contracts_alloc)$(_build_custom_alloc)
  }
}
EOF

  # Validate and pretty-print the eth-genesis.json file with jq to ensure correct and pretty formatting
  if [[ -f "${genesis_file_path}" ]]; then
    if jq . "${genesis_file_path}" > "${genesis_file_path}.formatted" 2>/dev/null; then
      mv "${genesis_file_path}.formatted" "${genesis_file_path}"
      log_success "eth-genesis.json at ${genesis_file_path} is valid JSON and has been formatted with jq."
    else
      log_error "eth-genesis.json at ${genesis_file_path} is not valid JSON or is corrupted."
      rm -f "${genesis_file_path}.formatted"
      return 1
    fi
  else
    log_error "eth-genesis.json does not exist at ${genesis_file_path}."
    return 1
  fi

}

# Helper function to generate beacond keys
generate_beacond_keys() {
  [[ "$DEBUG_MODE" == "true" ]] && echo "[DEBUG] Function: generate_beacond_keys" >&2
  local config_dir="$1"
  local chain_spec="$2"
  local chain_id="$3"

  # Parse flags
  while [[ $# -gt 0 ]]; do
      key="$1"
      case $key in
          --config-dir)
              config_dir="$2"
              shift 2
              ;;
          --chain-spec)
              chain_spec="$2"
              if [[ "$chain_spec" == "${CHAIN_NAME_DEVNET}" ]]; then
                  chain_id="${CHAIN_ID_DEVNET}"
              elif [[ "$chain_spec" == "${CHAIN_NAME_TESTNET}" ]]; then
                  chain_id="${CHAIN_ID_TESTNET}"
              elif [[ "$chain_spec" == "${CHAIN_NAME_MAINNET}" ]]; then
                  chain_id="${CHAIN_ID_MAINNET}"
              else
                  echo "Unknown chain spec: ${chain_spec}"
                  return 1
              fi
              shift 2
              ;;
          *)
              echo "Unknown flag: $1"
              shift
              ;;
      esac
  done

  # Check if bin/beacond exists in ${config_dir}/bin and is executable
  local beacond_binary="${config_dir}/bin/beacond"
  if [[ ! -x "${beacond_binary}" ]]; then
      log_error "beacond binary not found or not executable at: ${beacond_binary}"
      return 1
  fi

  # Clean up any existing beacond directory
  if [[ -d "${config_dir}/tmp/beacond" ]]; then
    log_info "Removing existing beacond directory at ${config_dir}/tmp/beacond"
    rm -rf "${config_dir}/tmp/beacond";
    if [[ $? -ne 0 ]]; then
      log_error "Failed to remove existing beacond directory at ${config_dir}/tmp/beacond"
      return 1
    fi
    log_success "Removed existing beacond directory at ${config_dir}/tmp/beacond"
  fi

  beranode_config_file="${config_dir}/beranodes.config.json"
  if [[ ! -f "${beranode_config_file}" ]]; then
    log_error "Beranode configuration file not found at ${beranode_config_file}"
    return 1
  fi
  # Retrieve all the .nodes from the beranodes.config.json file
  nodes_json=$(jq -c '.nodes' "${beranode_config_file}")
  if [[ $? -ne 0 ]] || [[ -z "$nodes_json" ]]; then
    log_error "Failed to read or parse .nodes from ${beranode_config_file}"
    return 1
  fi
  nodes_count=$(echo "$nodes_json" | jq 'length')
  echo "Number of nodes: $nodes_count"
  
  # Retrieve withdraw address from beranodes.config.json
  withdraw_address="$(jq -r '.wallet_address' "${beranode_config_file}")"
  if [[ $? -ne 0 ]] || [[ -z "$withdraw_address" ]]; then
    log_error "Failed to read or parse .wallet_address from ${beranode_config_file}"
    return 1
  fi

  echo "Initializing beacond nodes..."
  for i in $(seq 1 ${nodes_count}); do
    node_json=$(echo "$nodes_json" | jq ".[$i-1]")
    local moniker=$(echo "$node_json" | jq -r '.moniker')
    local role=$(echo "$node_json" | jq -r '.role')

    mkdir -p "${config_dir}/tmp/beacond"
    ${beacond_binary} init ${moniker} --chain-id ${chain_id} --beacon-kit.chain-spec ${chain_spec} --home ${config_dir}/tmp/beacond >/dev/null 2>&1;
    if [[ $? -ne 0 ]]; then
      log_error "Failed to initialize beacond node at ${config_dir}/tmp/beacond"
      return 1
    fi
    log_success "Initialized beacond node ${i} - ${moniker} at ${config_dir}/tmp/beacond"

    # Read node_key.json
    node_key_file="${config_dir}/tmp/beacond/config/node_key.json"
    if [[ ! -f "${node_key_file}" ]]; then
      log_error "node_key.json not found at ${node_key_file}"
      return 1
    fi
    node_key_json=$(jq -c '.' "${node_key_file}")
    if [[ $? -ne 0 ]] || [[ -z "$node_key_json" ]]; then
      log_error "Failed to read or parse node_key.json from ${node_key_file}"
      return 1
    fi

    # Read priv_validator_key.json
    priv_validator_key_file="${config_dir}/tmp/beacond/config/priv_validator_key.json"
    if [[ ! -f "${priv_validator_key_file}" ]]; then
      log_error "priv_validator_key.json not found at ${priv_validator_key_file}"
      return 1
    fi
    priv_validator_key_json=$(jq -c '.' "${priv_validator_key_file}")
    if [[ $? -ne 0 ]] || [[ -z "$priv_validator_key_json" ]]; then
      log_error "Failed to read or parse priv_validator_key.json from ${priv_validator_key_file}"
      return 1
    fi

    # Read validator keys
    validator_keys=""
    validator_keys="$(${beacond_binary} deposit validator-keys --home ${config_dir}/tmp/beacond)"
    if [[ $? -ne 0 ]]; then
      log_error "Failed to read validator keys at ${config_dir}/tmp/beacond"
      return 1
    fi
   
    premined_deposit_json="null"
    if [[ "$role" == "validator" ]]; then
      # Add premined deposit
      ${beacond_binary} genesis add-premined-deposit ${GENESIS_DEPOSIT_AMOUNT} "${withdraw_address}" --beacon-kit.chain-spec ${chain_spec} --home ${config_dir}/tmp/beacond
      if [[ $? -ne 0 ]]; then
        log_error "Failed to add premined deposit at ${config_dir}/tmp/beacond"
        return 1
      fi

      # Get the contents from the premined-deposit-*.json file
      premined_deposit_file=$(ls ${config_dir}/tmp/beacond/config/premined-deposits/premined-deposit-*.json 2>/dev/null | head -n 1)

      if [[ -n "${premined_deposit_file}" && -f "${premined_deposit_file}" ]]; then
        # Ensure the file contains valid JSON, and get as raw object for jq
        premined_deposit_json=$(jq -c '.' "${premined_deposit_file}")
        if [[ $? -ne 0 ]] || [[ -z "$premined_deposit_json" ]]; then
          log_error "Failed to read or parse premined deposit json from ${premined_deposit_file}"
          return 1
        fi
      else
        log_error "premined deposit json file not found for node ${moniker} at ${config_dir}/tmp/beacond/premined-deposits/"
        return 1
      fi
    fi

    # Extract Comet Address
    comet_address=$(echo "$validator_keys" | sed -n '2p' | xargs | tr -d '[:space:]')
    comet_pubkey=$(echo "$validator_keys" | sed -n '5p' | xargs | tr -d '[:space:]')
    eth_beacon_pubkey=$(echo "$validator_keys" | sed -n '8p' | xargs | tr -d '[:space:]')

    # Get deposit amount
    deposit_amount=$GENESIS_DEPOSIT_AMOUNT

    # Generate JWT file
    ${beacond_binary} >/dev/null 2>&1 jwt generate -o ${config_dir}/tmp/beacond/jwt.hex;
    if [[ $? -ne 0 ]]; then
        log_error "Failed to generate JWT file at ${jwt_file}"
        return 1
    fi
    # Add JWT value to beranodes.config.json
    jwt_value=$(cat ${config_dir}/tmp/beacond/jwt.hex)
    if [[ $? -ne 0 ]] || [[ -z "$jwt_value" ]]; then
      log_error "Failed to read JWT value from ${config_dir}/tmp/beacond/jwt.hex"
      return 1
    fi
    
    # Build json object with the validator keys
    tmp_beranode_config="${beranode_config_file}.tmp"
    jq --arg idx "$((i-1))" \
       --argjson node_key "$node_key_json" \
       --argjson priv_validator_key "$priv_validator_key_json" \
       --arg comet_address "$comet_address" \
       --arg comet_pubkey "$comet_pubkey" \
       --arg eth_beacon_pubkey "$eth_beacon_pubkey" \
       --argjson premined_deposit "$premined_deposit_json" \
       --arg deposit_amount "$deposit_amount" \
       --arg jwt "$jwt_value" \
       '
         .nodes |=
           (.[($idx|tonumber)] += {
              node_key: $node_key,
              priv_validator_key: $priv_validator_key,
              comet_address: $comet_address,
              comet_pubkey: $comet_pubkey,
              eth_beacon_pubkey: $eth_beacon_pubkey,
              premined_deposit: $premined_deposit,
              deposit_amount: $deposit_amount,
              jwt: $jwt
           })
       ' "${beranode_config_file}" > "${tmp_beranode_config}"
    if [[ $? -ne 0 ]]; then
      log_error "Failed to add node_key to node $((i-1)) in ${beranode_config_file}"
      rm -f "${tmp_beranode_config}"
      return 1
    fi
    mv "${tmp_beranode_config}" "${beranode_config_file}"

    # Clean up the tmp/beacond folder for each iteration
    if [[ -d "${config_dir}/tmp/beacond" ]]; then
      rm -rf "${config_dir}/tmp/beacond"
      if [[ $? -ne 0 ]]; then
        log_error "Failed to clean up ${config_dir}/tmp/beacond before initializing node ${moniker}"
        return 1
      fi
        log_info "Cleaned up ${config_dir}/tmp/beacond before initializing node ${moniker}"
    fi

    log_success "Added node_key to node $((i-1)) in ${beranode_config_file}"
  done

  # mkdir -p "${config_dir}/tmp/beacond"
  # cp ${config_dir}/tmp/beacond/config/genesis.json ${config_dir}/tmp/genesis.json
  # if [[ $? -ne 0 ]]; then
  #   log_error "Failed to copy genesis file to ${config_dir}/tmp/genesis.json"
  #   return 1
  # fi
  # log_success "Copied genesis file to ${config_dir}/tmp/genesis.json"

  #   # Generate jwt
  #   echo "Generating JWT file..."
  #   local jwt_file="${config_dir}/tmp/jwt.hex"
  #   if [ -f "${jwt_file}" ]; then
  #     log_info "JWT file already exists at ${jwt_file}"
  #   else
  #     ${beacond_binary} >/dev/null 2>&1 jwt generate -o ${jwt_file}
  #     if [[ $? -ne 0 ]]; then
  #         log_error "Failed to generate JWT file at ${jwt_file}"
  #         return 1
  #     fi
  #   fi

}

# Helper function to generate a genesis.json file
generate_genesis_file() {
  [[ "$DEBUG_MODE" == "true" ]] && echo "[DEBUG] Function: generate_genesis_file" >&2
  local config_dir="$1"
  local chain_spec="$2"
  local chain_id="$3"
  local moniker="TEMP-MONIKER"

  # Parse flags
  while [[ $# -gt 0 ]]; do
      key="$1"
      case $key in
          --config-dir)
              config_dir="$2"
              shift 2
              ;;
          --chain-spec)
              chain_spec="$2"
              if [[ "$chain_spec" == "${CHAIN_NAME_DEVNET}" ]]; then
                  chain_id="${CHAIN_ID_DEVNET}"
              elif [[ "$chain_spec" == "${CHAIN_NAME_TESTNET}" ]]; then
                  chain_id="${CHAIN_ID_TESTNET}"
              elif [[ "$chain_spec" == "${CHAIN_NAME_MAINNET}" ]]; then
                  chain_id="${CHAIN_ID_MAINNET}"
              else
                  echo "Unknown chain spec: ${chain_spec}"
                  shift 2
                  return 1
              fi
              shift 2
              ;;
          *)
              echo "Unknown flag: $1"
              shift
              ;;
      esac
  done

  # Check if bin/beacond exists in ${config_dir}/bin and is executable
  local beacond_binary="${config_dir}/bin/beacond"
  if [[ ! -x "${beacond_binary}" ]]; then
      log_error "beacond binary not found or not executable at: ${beacond_binary}"
      return 1
  fi

  # Clean up any existing genesis file
  if [ -d "${config_dir}/tmp/beacond" ]; then
    log_info "Removing existing beacond directory at ${config_dir}/tmp/beacond"
    rm -rf "${config_dir}/tmp/beacond";
    if [[ $? -ne 0 ]]; then
      log_error "Failed to remove existing beacond directory at ${config_dir}/tmp/beacond"
      return 1
    fi
    log_success "Removed existing beacond directory at ${config_dir}/tmp/beacond"
  fi

    # # Check if beacond is working correctly by running `beacond version`
    # local genesis_file="${config_dir}/tmp/genesis.json"
    # if [ -f "${genesis_file}" ]; then
    #   log_info "Genesis file already exists at ${genesis_file}"
    # else
    #   ${beacond_binary} >/dev/null 2>&1 init ${moniker} --chain-id ${chain_id} --beacon-kit.chain-spec ${chain_spec} --home ${config_dir}/tmp/beacond;
    #   if [[ $? -ne 0 ]]; then
    #     log_error "Failed to generate Genesis file at ${genesis_file}"
    #     return 1
    #   fi
    #   # TEST
    #   # cp ${config_dir}/tmp/beacond/config/genesis.json ${config_dir}/tmp/beacond/config/genesis.bk.json
    # fi

    # # Set deposit storage - eth-genesis.json (execution client - bera-reth)
    # ${beacond_binary} >/dev/null 2>&1 genesis set-deposit-storage ${config_dir}/tmp/eth-genesis.json --beacon-kit.chain-spec ${chain_spec} --home ${config_dir}/tmp/beacond;
    # if [[ $? -ne 0 ]]; then
    #   log_error "Failed to set deposit storage at ${config_dir}/tmp/eth-genesis.json"
    #   return 1
    # fi
    # log_success "Set deposit storage at ${config_dir}/tmp/eth-genesis.json"

    # # Execution payload - genesis.json (consensus client - beacond)
    # ${beacond_binary} >/dev/null 2>&1 genesis execution-payload ${config_dir}/tmp/eth-genesis.json --beacon-kit.chain-spec ${chain_spec} --home ${config_dir}/tmp/beacond;
    # if [[ $? -ne 0 ]]; then
    #   log_error "Failed to set execution payload at ${config_dir}/tmp/eth-genesis.json"
    #   return 1
    # fi
    # log_success "Set execution payload at ${config_dir}/tmp/eth-genesis.json"

    # Generate jwt
    echo "Generating JWT file..."
    local jwt_file="${config_dir}/tmp/jwt.hex"
    if [ -f "${jwt_file}" ]; then
      log_info "JWT file already exists at ${jwt_file}"
    else
      ${beacond_binary} >/dev/null 2>&1 jwt generate -o ${jwt_file}
      if [[ $? -ne 0 ]]; then
          log_error "Failed to generate JWT file at ${jwt_file}"
          return 1
      fi
    fi

    echo "Initializing beacond node..."
    local genesis_file="${config_dir}/tmp/genesis.json"
    if [ -f "${genesis_file}" ]; then
      log_info "Genesis file already exists at ${genesis_file}"
    else
      mkdir -p "${config_dir}/tmp/beacond"
      ${beacond_binary} init ${moniker} --chain-id ${chain_id} --beacon-kit.chain-spec ${chain_spec} --home ${config_dir}/tmp/beacond >/dev/null 2>&1;
      if [[ $? -ne 0 ]]; then
        log_error "Failed to initialize beacond node at ${config_dir}/tmp/beacond"
        return 1
      fi
      cp ${config_dir}/tmp/beacond/config/genesis.json ${config_dir}/tmp/genesis.json
      if [[ $? -ne 0 ]]; then
        log_error "Failed to copy genesis file to ${config_dir}/tmp/genesis.json"
        return 1
      fi
      log_success "Copied genesis file to ${config_dir}/tmp/genesis.json"
    fi
    log_success "Genesis file created at ${config_dir}/tmp/genesis.json"

    rm -rf "${config_dir}/tmp/beacond"
    log_success "Removed beacond directory at ${config_dir}/tmp/beacond"

    log_success "Genesis file created at ${config_dir}/tmp/genesis.json"
}

# Helper function to generate the beacon chain genesis file
generate_beacond_genesis() {
  [[ "$DEBUG_MODE" == "true" ]] && echo "[DEBUG] Function: generate_beacond_genesis" >&2
  local config_dir="$1"
  local chain_spec="$2"
  local chain_id=""
  local beranode_config_file=""

  # Parse flags
  while [[ $# -gt 0 ]]; do
    key="$1"
    case $key in
      --config-dir)
        config_dir="$2"
        beranode_config_file="${config_dir}/beranodes.config.json"
        shift 2
        ;;
      --chain-spec)
        chain_spec="$2"
        if [[ "$chain_spec" == "${CHAIN_NAME_DEVNET}" ]]; then
          chain_id="${CHAIN_ID_DEVNET}"
        elif [[ "$chain_spec" == "${CHAIN_NAME_TESTNET}" ]]; then
          chain_id="${CHAIN_ID_TESTNET}"
        elif [[ "$chain_spec" == "${CHAIN_NAME_MAINNET}" ]]; then
          chain_id="${CHAIN_ID_MAINNET}"
        else
          echo "Unknown chain spec: ${chain_spec}"
          shift 2
          return 1
        fi
        shift 2
        ;;
      --chain-id)
        chain_id="$2"
        shift 2
        ;;
      *)
        echo "Unknown flag: $1"
        shift
        ;;
    esac
  done

  # Check if existing genesis.json file exists in ${config_dir}/tmp/genesis.json
  local genesis_file="${config_dir}/tmp/genesis.json"
  if [ -f "${genesis_file}" ]; then
    log_info "Genesis file already exists at ${genesis_file}"
  fi

  # Check if bin/beacond exists in ${config_dir}/bin and is executable
  local beacond_binary="${config_dir}/bin/beacond"
  if [[ ! -x "${beacond_binary}" ]]; then
    log_error "beacond binary not found or not executable at: ${beacond_binary}"
    return 1
  fi

  # Check if beranodes.config.json file exists in ${config_dir}/tmp/beranodes.config.json
  if [[ ! -f "${beranode_config_file}" ]]; then
    log_error "Beranode configuration file not found at ${beranode_config_file}"
    return 1
  fi

  # Retrieve all the .nodes from the beranodes.config.json file
  nodes_json=$(jq -c '.nodes' "${beranode_config_file}")
  if [[ $? -ne 0 ]] || [[ -z "$nodes_json" ]]; then
    log_error "Failed to read or parse .nodes from ${beranode_config_file}"
    return 1
  fi
  nodes_count=$(echo "$nodes_json" | jq 'length')
  echo "Number of nodes: $nodes_count";
  echo "--------------------------------";
  if [[ "$nodes_count" -eq 0 ]]; then
    log_error "No nodes found in ${beranode_config_file}, cannot generate beacond genesis file."
    return 1
  fi

  # Iterate through all the nodes to find role == validator
  for i in $(seq 1 ${nodes_count}); do
    role=$(echo "$node_json" | jq -r '.role')
    if [[ "$role" == "validator" ]]; then
      node_json=$(echo "$nodes_json" | jq ".[$i-1]")
      moniker=$(echo "$node_json" | jq -r '.moniker')
      role=$(echo "$node_json" | jq -r '.role')
      jwt=$(echo "$node_json" | jq -r '.jwt // empty')
      echo "Validator found: $i - $moniker";
    fi
  done

  if [[ -z "$node_json" ]]; then
    log_error "No validator found in ${beranode_config_file}, cannot generate beacond genesis file."
    return 1
  fi
    
  # node key
  node_key_type=$(echo "$node_json" | jq -r '.node_key.type // empty')
  node_key_value=$(echo "$node_json" | jq -r '.node_key.value // empty')

  # priv validator key
  priv_validator_key_address=$(echo "$node_json" | jq -r '.priv_validator_key.address // empty')
  priv_validator_key_pubkey_type=$(echo "$node_json" | jq -r '.priv_validator_key.pub_key.type // empty')
  priv_validator_key_pubkey_value=$(echo "$node_json" | jq -r '.priv_validator_key.pub_key.value // empty')
  priv_validator_key_privkey_type=$(echo "$node_json" | jq -r '.priv_validator_key.priv_key.type // empty')
  priv_validator_key_privkey_value=$(echo "$node_json" | jq -r '.priv_validator_key.priv_key.value // empty')

  # comet address
  comet_address=$(echo "$node_json" | jq -r '.comet_address // empty')
  comet_pubkey=$(echo "$node_json" | jq -r '.comet_pubkey // empty')
  eth_beacon_pubkey=$(echo "$node_json" | jq -r '.eth_beacon_pubkey // empty')

  # deposit amount
  deposit_amount=$(echo "$node_json" | jq -r '.deposit_amount // empty')

  # make tmp/beacond directory
  mkdir -p "${config_dir}/tmp/beacond"
  if [[ $? -ne 0 ]]; then
    log_error "Failed to create tmp/beacond directory at ${config_dir}/tmp/beacond"
    return 1
  fi

  # beacond init
  ${beacond_binary} init ${moniker} --chain-id ${chain_id} --beacon-kit.chain-spec ${chain_spec} --home ${config_dir}/tmp/beacond >/dev/null 2>&1;
  if [[ $? -ne 0 ]]; then
    log_error "Failed to initialize beacond node at ${config_dir}/tmp/beacond"
    return 1
  fi
  log_success "Initialized beacond node ${i} - ${moniker} at ${config_dir}/tmp/beacond"

  # replace existing node key in the required format
  node_key_file="${config_dir}/tmp/beacond/config/node_key.json"
  cat > "${node_key_file}" <<EOF
{
"priv_key": {
  "type": "${node_key_type}",
  "value": "${node_key_value}"
}
}
EOF
  if [[ $? -ne 0 ]]; then
    log_error "Failed to write new node key format to ${node_key_file}"
    return 1
  fi
  log_success "Replaced existing node key at ${node_key_file} in new format"

  # replace priv_validator_key.json in the required format
  priv_validator_key_file="${config_dir}/tmp/beacond/config/priv_validator_key.json"
  cat > "${priv_validator_key_file}" <<EOF
{
"address": "${priv_validator_key_address}",
"pub_key": {
  "type": "${priv_validator_key_pubkey_type}",
  "value": "${priv_validator_key_pubkey_value}"
},
"priv_key": {
  "type": "${priv_validator_key_privkey_type}",
  "value": "${priv_validator_key_privkey_value}"
}
}
EOF
  if [[ $? -ne 0 ]]; then
    log_error "Failed to write new priv_validator_key format to ${priv_validator_key_file}"
    return 1
  fi
  log_success "Replaced existing priv_validator_key at ${priv_validator_key_file} in new format"

  # add jwt
  jwt_file="${config_dir}/tmp/beacond/config/jwt.hex"
  cat > "${jwt_file}" <<EOF
${jwt}
EOF
  if [[ $? -ne 0 ]]; then
    log_error "Failed to write new jwt format to ${jwt_file}"
    return 1
  fi
  log_success "Added jwt at ${jwt_file}"

  # Modify app.toml for jwt-secret-path = ${jwt_file}
  app_toml_file="${config_dir}/tmp/beacond/config/app.toml"
  sed "${SED_OPT[@]}" "s|^jwt-secret-path = \".*\"|jwt-secret-path = \"${jwt_file}\"|" "${app_toml_file}"
  if [[ $? -ne 0 ]]; then
    log_error "Failed to modify app.toml for jwt-secret-path at ${app_toml_file}"
    return 1
  fi
  log_success "Modified app.toml for jwt-secret-path at ${app_toml_file}"

  # add kzg-trusted-setup.json config to app.toml
  kzg_file="${config_dir}/tmp/kzg-trusted-setup.json"
  sed "${SED_OPT[@]}" "s|^trusted-setup-path = \".*\"|trusted-setup-path = \"${kzg_file}\"|" "${app_toml_file}"
  if [[ $? -ne 0 ]]; then
    log_error "Failed to add kzg-trusted-setup.json config to app.toml at ${app_toml_file}"
    return 1
  fi
  log_success "Added kzg-trusted-setup.json config to app.toml at ${app_toml_file}"

  # add premined deposits
  mkdir -p "${config_dir}/tmp/beacond/config/premined-deposits";
  # Check if beranodes.config.json has a key called "genesis_deposits" which is an array
  beranode_config_file="${config_dir}/beranodes.config.json"
  has_genesis_deposits=$(jq 'has("genesis_deposits") and (.genesis_deposits|type == "array")' "${beranode_config_file}" 2>/dev/null)
  if [[ "${has_genesis_deposits}" == "true" ]]; then
    log_info "\"genesis_deposits\" key exists and is an array in ${beranode_config_file}"
  else
    log_warn "\"genesis_deposits\" key not present or not an array in ${beranode_config_file} creating..."

    # Iterate through the "nodes" array in beranodes.config.json and process each node
    nodes_length=$(jq '.nodes | length' "${beranode_config_file}")
    for (( node_idx=0; node_idx<nodes_length; node_idx++ )); do
      # if .node role == validator then add premined deposit
      node_role=$(jq -r ".nodes[${node_idx}].role" "${beranode_config_file}")
      if [[ "$node_role" == "validator" ]]; then
        node=$(jq -c ".nodes[${node_idx}]" "${beranode_config_file}")
        node_moniker=$(jq -r ".nodes[${node_idx}].moniker" "${beranode_config_file}")

        # premined deposit
        preminded_deposit_pubkey=$(echo "$node" | jq -r '.premined_deposit.pubkey // empty')
        preminded_deposit_credentials=$(echo "$node" | jq -r '.premined_deposit.credentials // empty')
        preminded_deposit_amount=$(echo "$node" | jq -r '.premined_deposit.amount // empty')
        preminded_deposit_signature=$(echo "$node" | jq -r '.premined_deposit.signature // empty')
        preminded_deposit_index=$(echo "$node" | jq -r '.premined_deposit.index // empty')
        
        # create a deposit file in "beranodes/tmp/beacond/config/premined-deposits"
        deposit_file="${config_dir}/tmp/beacond/config/premined-deposits/premined-deposit-${preminded_deposit_pubkey}.json"
        cat > "${deposit_file}" <<EOF
{
"pubkey": "${preminded_deposit_pubkey}",
"credentials": "${preminded_deposit_credentials}",
"amount": "${preminded_deposit_amount}",
"signature": "${preminded_deposit_signature}",
"index": ${preminded_deposit_index}
}
EOF
      fi
    done

    ${beacond_binary} genesis collect-premined-deposits --beacon-kit.chain-spec ${chain_spec} --home ${config_dir}/tmp/beacond;
    if [[ $? -ne 0 ]]; then
      log_error "Failed to collect premined deposits at ${config_dir}/tmp/beacond"
      return 1
    fi
    log_success "Collected premined deposits at ${config_dir}/tmp/beacond"

    # validate if genesis.json has an key called .app_state.beacon.deposits which is an array and it matches the number of premined deposits
    genesis_file="${config_dir}/tmp/beacond/config/genesis.json"
    deposits_count=$(jq '.app_state.beacon.deposits | length' "${genesis_file}")
    if [[ $? -ne 0 ]] || [[ -z "$deposits_count" ]]; then
      log_error "Failed to read or parse .app_state.beacon.deposits from ${genesis_file}"
      return 1
    fi
    # get .validators value beranodes.config.json
    validators_count=$(jq '.validators | length' "${beranode_config_file}")
    if [[ $? -ne 0 ]] || [[ -z "$validators_count" ]]; then
      log_error "Failed to read or parse .validators from ${beranode_config_file}"
      return 1
    fi
    if [[ "$deposits_count" -ne "$validators_count" ]]; then
      log_error "Number of premined deposits does not match the number of nodes in ${genesis_file}"
      return 1
    fi
    log_success "Number of premined deposits matches the number of nodes in ${genesis_file}"

    # copy .app_state.beacon.deposits from ${config_dir}/tmp/beacond/config/genesis.json to beranodes.config.json
    deposits_json=$(jq -c '.app_state.beacon.deposits' "${genesis_file}")
    if [[ $? -ne 0 ]] || [[ -z "$deposits_json" ]]; then
      log_error "Failed to read or parse .app_state.beacon.deposits from ${genesis_file}"
      return 1
    fi
    jq --argjson deposits "$deposits_json" '
      .genesis_deposits = $deposits
    ' "${beranode_config_file}" > "${beranode_config_file}.tmp"
    mv "${beranode_config_file}.tmp" "${beranode_config_file}"
    log_success "Copied .app_state.beacon.deposits from ${config_dir}/tmp/beacond/config/genesis.json to beranodes.config.json"

    # generate validator root
    validator_root=$(${beacond_binary} genesis validator-root ${config_dir}/tmp/beacond/config/genesis.json --beacon-kit.chain-spec ${chain_spec} --home ${config_dir}/tmp/beacond);
    if [[ $? -ne 0 ]] || [[ -z "$validator_root" ]]; then
      log_error "Failed to generate validator root at ${config_dir}/tmp/beacond/config/genesis.json"
      return 1
    fi
    log_success "Generated validator root at ${config_dir}/tmp/beacond/config/genesis.json"
    echo "Validator root: $validator_root"

    # validator_root to beranodes.config.json
    jq --arg validator_root "$validator_root" '
      .validator_root = $validator_root
    ' "${beranode_config_file}" > "${beranode_config_file}.tmp"
    mv "${beranode_config_file}.tmp" "${beranode_config_file}"
    log_success "Replaced validator root in beranodes.config.json"

    # Modifies eth-genesis.json file to set deposit storage
    # set deposit storage - makes a copy of the eth-genesis.json file to ${config_dir}/tmp/beacond/eth-genesis.json and modifies the 0x4242... storage slots
    ${beacond_binary} genesis set-deposit-storage ${config_dir}/tmp/eth-genesis.json --beacon-kit.chain-spec ${chain_spec} --home ${config_dir}/tmp/beacond;
    if [[ $? -ne 0 ]] || [[ ! -f "${config_dir}/tmp/beacond/eth-genesis.json" ]]; then
      log_error "Failed to set deposit storage at ${config_dir}/tmp/eth-genesis.json"
      return 1
    fi
    # cp the json object .alloc.0x4242424242424242424242424242424242424242.storage and replace it with the json object from ${config_dir}/tmp/beacond/eth-genesis.json 
    storage_json=$(jq -c '.alloc."0x4242424242424242424242424242424242424242".storage' "${config_dir}/tmp/beacond/eth-genesis.json")
    if [[ $? -ne 0 ]] || [[ -z "$storage_json" ]]; then
      log_error "Failed to read or parse .alloc.\"0x4242424242424242424242424242424242424242\".storage from ${config_dir}/tmp/beacond/eth-genesis.json"
      return 1
    fi
    jq --argjson storage "$storage_json" '
      .alloc."0x4242424242424242424242424242424242424242".storage = $storage
    ' "${config_dir}/tmp/eth-genesis.json" > "${config_dir}/tmp/eth-genesis.json.tmp"
    mv "${config_dir}/tmp/eth-genesis.json.tmp" "${config_dir}/tmp/eth-genesis.json"
    log_success "Replaced .alloc.\"0x4242424242424242424242424242424242424242\".storage in ${config_dir}/tmp/eth-genesis.json"

    # Modifies genesis.json file to set execution payload
    # execution payload
    ${beacond_binary} genesis execution-payload ${config_dir}/tmp/eth-genesis.json --beacon-kit.chain-spec ${chain_spec} --home ${config_dir}/tmp/beacond;
    if [[ $? -ne 0 ]]; then
      log_error "Failed to set execution payload at ${config_dir}/tmp/eth-genesis.json"
      return 1
    fi
    log_success "Set execution payload at ${config_dir}/tmp/eth-genesis.json"

    # Copy genesis.json to beranodes/tmp/genesis.json
    cp ${config_dir}/tmp/beacond/config/genesis.json ${config_dir}/tmp/genesis.json
    if [[ $? -ne 0 ]]; then
      log_error "Failed to copy genesis.json to tmp/genesis.json"
      return 1
    fi
    log_success "Copied genesis.json to tmp/genesis.json"

    # Modify beranodes/tmp/genesis.json to add key values of genesis_file and genesis_eth_file
    jq --arg genesis_file "${config_dir}/tmp/beacond/config/genesis.json" \
        --arg genesis_eth_file "${config_dir}/tmp/eth-genesis.json" '
      .genesis_file = $genesis_file
      | .genesis_eth_file = $genesis_eth_file
    ' "${config_dir}/beranodes.config.json" > "${config_dir}/beranodes.config.json.tmp"
    mv "${config_dir}/beranodes.config.json.tmp" "${config_dir}/beranodes.config.json"
    log_success "Modified beranodes.config.json to add key values of genesis_file and genesis_eth_file"
  fi

  # Ensure the beacond directory is removed, regardless of its existence
  rm -rf "${config_dir}/tmp/beacond"
  if [[ -d "${config_dir}/tmp/beacond" ]]; then
    log_error "Failed to remove beacond directory at ${config_dir}/tmp/beacond"
    return 1
  else
    log_success "Ensured removal of beacond directory at ${config_dir}/tmp/beacond"
  fi
}

# Helper function create a validator node
create_validator_node() {
  [[ "$DEBUG_MODE" == "true" ]] && echo "[DEBUG] Function: create_validator_node" >&2
  local beranodes_dir="$1"
    local local_dir="$2"
    local moniker="$3"
    local network="$4"
    local wallet_address="$5"
    local wallet_balance="$6"
    local bin_beacond="$7"
    local bin_bera_reth="$8"
    local kzg_file="$9"
    local ethrpc_port="$10"
    local ethp2p_port="$11"
    local ethproxy_port="$12"
    local el_ethrpc_port="$14"
    local el_authrpc_port="$15"
    local el_eth_port="$16"
    local el_prometheus_port="$17"
    local cl_prometheus_port="$18"
    local sed_opt=(-i)

    # Ensure the tmp directory exists
    mkdir -p "${local_dir}/beacond"
    mkdir -p "${local_dir}/beacond/config"
    mkdir -p "${local_dir}/bera-reth"

    # Copy the kzg-trusted-setup.json file to the beacond config directory
    cp ${kzg_file} ${local_dir}/beacond/config/kzg-trusted-setup.json
    if [[ $? -ne 0 ]]; then
        log_error "Failed to copy kzg-trusted-setup.json to ${local_dir}/beacond/config/kzg-trusted-setup.json"
        return 1
    fi
    log_success "Copied kzg-trusted-setup.json to ${local_dir}/beacond/config/kzg-trusted-setup.json"

    # # Generate eth-genesis.json file
    # if [[ -f "${beranodes_dir}/tmp/eth-genesis.json" ]]; then
    #     log_success "Found eth-genesis.json at ${beranodes_dir}/tmp/eth-genesis.json"
    # else
    #     log_warn "eth-genesis.json not found at ${beranodes_dir}/tmp/eth-genesis.json creating it..."

    #     # Generates a eth-genesis.json file that is shared with all nodes
    #     generate_eth_genesis_file \
    #       --genesis-file-path "${beranodes_dir}/tmp/eth-genesis.json" \
    #       --local-dir "${local_dir}" \
    #       --chain-id "${CHAIN_ID_DEVNET}" \
    #       --prague1-time ${ETH_GENESIS_PRAGUE1_TIME} \
    #       --prague1-base-fee-change-denominator ${ETH_GENESIS_PRAGUE1_BASE_FEE_CHANGE_DENOMINATOR} \
    #       --prague1-min-base-fee ${ETH_GENESIS_PRAGUE1_MIN_BASE_FEE} \
    #       --prague1-pol-distributor ${ETH_GENESIS_PRAGUE1_POL_DISTRIBUTOR} \
    #       --prague2-time ${ETH_GENESIS_PRAGUE2_TIME} \
    #       --prague2-min-base-fee ${ETH_GENESIS_PRAGUE2_MIN_BASE_FEE} \
    #       --prague3-time ${ETH_GENESIS_PRAGUE3_TIME} \
    #       --prague3-bex-vault ${ETH_GENESIS_PRAGUE3_BEX_VAULT} \
    #       --prague3-rescue-address ${ETH_GENESIS_PRAGUE3_RESCUE_ADDRESS} \
    #       --prague3-blocked-addresses ${ETH_GENESIS_PRAGUE3_BLOCKED_ADDRESSES} \
    #       --prague4-time ${ETH_GENESIS_PRAGUE4_TIME} \
    #       --eth-genesis-custom0-contract-address ${wallet_address} \
    #       --eth-genesis-custom0-contract-balance ${wallet_balance}
    # fi

    # # Initialize the beacond node
    # ${bin_beacond} init --chain-id ${CHAIN_ID_DEVNET} --beacon-kit.chain-spec $CHAIN_NAME_DEVNET --moniker ${moniker} --home ${local_dir}/beacond
    # if [[ $? -ne 0 ]]; then
    #     log_error "Failed to initialize beacond node"
    #     return 1
    # fi
    # log_success "Initialized beacond node"

    # # Check if the validator key file exists
    # CHECK_FILE_VALIDATOR_KEY=${local_dir}/beacond/config/priv_validator_key.json
    # if [ ! -f "$CHECK_FILE_VALIDATOR_KEY" ]; then
    #     log_error "Error: Private validator key was not created at $CHECK_FILE_VALIDATOR_KEY"
    #     return 1
    # fi
    # log_success "Private validator key generated in $CHECK_FILE_VALIDATOR_KEY"

    # ${bin_beacond} jwt generate -o ${local_dir}/beacond/config/jwt.hex
    # CHECK_FILE_JWT_SECRET=${local_dir}/beacond/config/jwt.hex
    # if [ ! -f "$CHECK_FILE_JWT_SECRET" ]; then
    #     log_error "Error: JWT file was not created at $CHECK_FILE_JWT_SECRET"
    #     return 1
    # fi
    # log_success "JWT secret generated in $CHECK_FILE_JWT_SECRET"

    # ${bin_beacond} genesis add-premined-deposit $GENESIS_DEPOSIT_AMOUNT $wallet_address --beacon-kit.chain-spec $network --home ${local_dir}/beacond
    # ${bin_beacond} genesis collect-premined-deposits --beacon-kit.chain-spec $network --home ${local_dir}/beacond

    # if [[ $(uname) == "Darwin" ]]; then
    #     sed_opt=(-i '');
    # fi

    # sed "${SED_OPT[@]}" 's|chain-spec = ".*"|chain-spec = "'$network'"|' "${local_dir}/beacond/config/app.toml"
    # sed "${SED_OPT[@]}" 's|^rpc-dial-url = ".*"|rpc-dial-url = "http://localhost:'$EL_AUTHRPC_PORT'"|' "${local_dir}/beacond/config/app.toml"
    # sed "${SED_OPT[@]}" 's|^jwt-secret-path = ".*"|jwt-secret-path = "'$CHECK_FILE_JWT_SECRET'"|' "${local_dir}/beacond/config/app.toml"
    # sed "${SED_OPT[@]}" 's|^trusted-setup-path = ".*"|trusted-setup-path = "'$local_dir/beacond/config/kzg-trusted-setup.json'"|' "${local_dir}/beacond/config/app.toml"
    # sed "${SED_OPT[@]}" 's|^suggested-fee-recipient = ".*"|suggested-fee-recipient = "'$wallet_address'"|' "${local_dir}/beacond/config/app.toml"
    # sed "${SED_OPT[@]}" 's|^moniker = ".*"|moniker = "'$moniker'"|' "${local_dir}/beacond/config/config.toml"
    # sed "${SED_OPT[@]}" 's|^laddr = ".*26657"|laddr = "tcp://127.0.0.1:'$ethrpc_port'"|' "${local_dir}/beacond/config/config.toml"
    # sed "${SED_OPT[@]}" 's|^laddr = ".*26656"|laddr = "tcp://0.0.0.0:'$ethp2p_port'"|' "${local_dir}/beacond/config/config.toml"
    # sed "${SED_OPT[@]}" 's|^external_address = ".*"|external_address = "'$MY_IP:$ethp2p_port'"|' "$BEACOND_CONFIG/config.toml"
    # sed "${SED_OPT[@]}" 's|^proxy_app = ".*26658"|proxy_app = "tcp://127.0.0.1:'$ethproxy_port'"|' "${local_dir}/beacond/config/config.toml"
    # sed "${SED_OPT[@]}" 's|^prometheus_listen_addr = ".*"|prometheus_listen_addr = "':$cl_prometheus_port'"|' "${local_dir}/beacond/config/config.toml"
    # sed "${SED_OPT[@]}" 's|^prometheus_listen_addr = ".*"|prometheus_listen_addr = "':$el_prometheus_port'"|' "${local_dir}/beacond/config/config.toml"
    # log_success "Config files in ${local_dir}/beacond/config updated"
}


# =============================================================================
# node
# Source: lib/node.sh
# =============================================================================



# =============================================================================
# common
# Source: commands/common.sh
# =============================================================================



# =============================================================================
# init
# Source: commands/init.sh
# =============================================================================

cmd_init() {
    [[ "$DEBUG_MODE" == "true" ]] && echo "[DEBUG] Function: cmd_init" >&2
    print_header "Checking Dependencies"
    check_cast_version
    if [[ $? -ne 0 ]]; then
        log_error "Cast version is not supported. Please upgrade to version $SUPPORTED_CAST_VERSION or higher."
        return 1
    fi
    log_success "Cast version is supported."

    print_header "Initializing Berachain Node"

    local moniker="$(generate_random_name)"
    local network=$CHAIN_NAME_DEVNET
    local chain_id=$CHAIN_ID_DEVNET
    local force=false
    local skip_genesis=false
    local total_nodes=0
    local validators=1
    local full_nodes=0
    local pruned_nodes=0
    local docker_mode=false
    local mode="local"
    local wallet_private_key=""
    local wallet_address=""
    local wallet_balance=${DEFAULT_WALLET_BALANCE}

    # client.toml configuration variables
    local clienttoml_chain_id="${CLIENTTOML_CHAIN_ID}"
    local clienttoml_keyring_backend="${CLIENTTOML_KEYRING_BACKEND}"
    local clienttoml_keyring_default_keyname="${CLIENTTOML_KEYRING_DEFAULT_KEYNAME}"
    local clienttoml_output="${CLIENTTOML_OUTPUT}"
    local clienttoml_node="${CLIENTTOML_NODE}"
    local clienttoml_broadcast_mode="${CLIENTTOML_BROADCAST_MODE}"
    local clienttoml_grpc_address="${CLIENTTOML_GRPC_ADDRESS}"
    local clienttoml_grpc_insecure="${CLIENTTOML_GRPC_INSECURE}"

    # app.toml configuration variables
    local apptoml_pruning="${APPTOML_PRUNING}"
    local apptoml_pruning_keep_recent="${APPTOML_PRUNING_KEEP_RECENT}"
    local apptoml_pruning_interval="${APPTOML_PRUNING_INTERVAL}"
    local apptoml_halt_height="${APPTOML_HALT_HEIGHT}"
    local apptoml_halt_time="${APPTOML_HALT_TIME}"
    local apptoml_min_retain_blocks="${APPTOML_MIN_RETAIN_BLOCKS}"
    local apptoml_inter_block_cache="${APPTOML_INTER_BLOCK_CACHE}"
    local apptoml_iavl_cache_size="${APPTOML_IAVL_CACHE_SIZE}"
    local apptoml_iavl_disable_fastnode="${APPTOML_IAVL_DISABLE_FASTNODE}"
    local apptoml_app_db_backend="${APPTOML_APP_DB_BACKEND}"
    
    # - Telemetry Configuration
    local apptoml_telemetry_service_name="${APPTOML_TELEMETRY_SERVICE_NAME}"
    local apptoml_telemetry_enabled="${APPTOML_TELEMETRY_ENABLED}"
    local apptoml_telemetry_enable_hostname="${APPTOML_TELEMETRY_ENABLE_HOSTNAME}"
    local apptoml_telemetry_enable_hostname_label="${APPTOML_TELEMETRY_ENABLE_HOSTNAME_LABEL}"
    local apptoml_telemetry_enable_service_label="${APPTOML_TELEMETRY_ENABLE_SERVICE_LABEL}"
    local apptoml_telemetry_prometheus_retention_time="${APPTOML_TELEMETRY_PROMETHEUS_RETENTION_TIME}"
    local apptoml_telemetry_global_labels="${APPTOML_TELEMETRY_GLOBAL_LABELS}"
    local apptoml_telemetry_metrics_sink="${APPTOML_TELEMETRY_METRICS_SINK}"
    local apptoml_telemetry_statsd_addr="${APPTOML_TELEMETRY_STATSD_ADDR}"
    local apptoml_telemetry_datadog_hostname="${APPTOML_TELEMETRY_DATADOG_HOSTNAME}"

    # - BeacondKit Configuration
    local apptoml_beacon_kit_chain_spec="${APPTOML_BEACON_KIT_CHAIN_SPEC}"
    local apptoml_beacon_kit_chain_spec_file="${APPTOML_BEACON_KIT_CHAIN_SPEC_FILE}"
    local apptoml_beacon_kit_shutdown_timeout="${APPTOML_BEACON_KIT_SHUTDOWN_TIMEOUT}"
    
    # - BeaconKit Engine Configuration
    local apptoml_beacon_kit_engine_rpc_dial_url="${APPTOML_BEACON_KIT_ENGINE_RPC_DIAL_URL}"
    local apptoml_beacon_kit_engine_rpc_timeout="${APPTOML_BEACON_KIT_ENGINE_RPC_TIMEOUT}"
    local apptoml_beacon_kit_engine_rpc_retry_interval="${APPTOML_BEACON_KIT_ENGINE_RPC_RETRY_INTERVAL}"
    local apptoml_beacon_kit_engine_rpc_max_retry_interval="${APPTOML_BEACON_KIT_ENGINE_RPC_MAX_RETRY_INTERVAL}"
    local apptoml_beacon_kit_engine_rpc_startup_check_interval="${APPTOML_BEACON_KIT_ENGINE_RPC_STARTUP_CHECK_INTERVAL}"
    local apptoml_beacon_kit_engine_rpc_jwt_refresh_interval="${APPTOML_BEACON_KIT_ENGINE_RPC_JWT_REFRESH_INTERVAL}"
    local apptoml_beacon_kit_engine_jwt_secret_path="${APPTOML_BEACON_KIT_ENGINE_JWT_SECRET_PATH}"

    # - BeaconKit Logger Configuration
    local apptoml_beacon_kit_logger_time_format="${APPTOML_BEACON_KIT_LOGGER_TIME_FORMAT}"
    local apptoml_beacon_kit_logger_log_level="${APPTOML_BEACON_KIT_LOGGER_LOG_LEVEL}"
    local apptoml_beacon_kit_logger_style="${APPTOML_BEACON_KIT_LOGGER_STYLE}"
    
    # - BeaconKit KZG Configuration
    local apptoml_beacon_kit_kzg_trusted_setup_path="${APPTOML_BEACON_KIT_KZG_TRUSTED_SETUP_PATH}"
    local apptoml_beacon_kit_kzg_implementation="${APPTOML_BEACON_KIT_KZG_IMPLEMENTATION}"

    # - BeaconKit Payload Builder Configuration
    local apptoml_beacon_kit_payload_builder_enabled="${APPTOML_BEACON_KIT_PAYLOAD_BUILDER_ENABLED}"
    local apptoml_beacon_kit_payload_builder_suggested_fee_recipient="${APPTOML_BEACON_KIT_PAYLOAD_BUILDER_SUGGESTED_FEE_RECIPIENT}"
    local apptoml_beacon_kit_payload_builder_payload_timeout="${APPTOML_BEACON_KIT_PAYLOAD_BUILDER_PAYLOAD_TIMEOUT}"

    # - BeaconKit Validator Configuration
    local apptoml_beacon_kit_validator_graffiti="${APPTOML_BEACON_KIT_VALIDATOR_GRAFFITI}"
    local apptoml_beacon_kit_validator_availability_window="${APPTOML_BEACON_KIT_VALIDATOR_AVAILABILITY_WINDOW}"

    # - BeaconKit Node API Configuration
    local apptoml_beacon_kit_node_api_enabled="${APPTOML_BEACON_KIT_NODE_API_ENABLED}"
    local apptoml_beacon_kit_node_api_address="${APPTOML_BEACON_KIT_NODE_API_ADDRESS}"
    local apptoml_beacon_kit_node_api_logging="${APPTOML_BEACON_KIT_NODE_API_LOGGING}"

    # config.toml configuration variables
    local configtoml_version="${CONFIGTOML_VERSION}"
    local configtoml_proxy_app="${CONFIGTOML_PROXY_APP}"
    local configtoml_moniker="${CONFIGTOML_MONIKER}"
    local configtoml_db_backend="${CONFIGTOML_DB_BACKEND}"
    local configtoml_db_dir="${CONFIGTOML_DB_DIR}"
    local configtoml_log_level="${CONFIGTOML_LOG_LEVEL}"
    local configtoml_log_format="${CONFIGTOML_LOG_FORMAT}"
    local configtoml_genesis_file="${CONFIGTOML_GENESIS_FILE}"
    local configtoml_priv_validator_key_file="${CONFIGTOML_PRIV_VALIDATOR_KEY_FILE}"
    local configtoml_priv_validator_state_file="${CONFIGTOML_PRIV_VALIDATOR_STATE_FILE}"
    local configtoml_priv_validator_laddr="${CONFIGTOML_PRIV_VALIDATOR_LADDR}"
    local configtoml_node_key_file="${CONFIGTOML_NODE_KEY_FILE}"
    local configtoml_abci="${CONFIGTOML_ABCI}"
    local configtoml_filter_peers="${CONFIGTOML_FILTER_PEERS}"

    # - RPC Server Configuration
    local configtoml_rpc_laddr="${CONFIGTOML_RPC_LADDR}"
    local configtoml_rpc_unsafe="${CONFIGTOML_RPC_UNSAFE}"
    local configtoml_rpc_cors_allowed_origins="${CONFIGTOML_RPC_CORS_ALLOWED_ORIGINS}"
    local configtoml_rpc_cors_allowed_methods="${CONFIGTOML_RPC_CORS_ALLOWED_METHODS}"
    local configtoml_rpc_cors_allowed_headers="${CONFIGTOML_RPC_CORS_ALLOWED_HEADERS}"
    local configtoml_rpc_max_open_connections="${CONFIGTOML_RPC_MAX_OPEN_CONNECTIONS}"
    local configtoml_rpc_max_subscription_clients="${CONFIGTOML_RPC_MAX_SUBSCRIPTION_CLIENTS}"
    local configtoml_rpc_max_subscriptions_per_client="${CONFIGTOML_RPC_MAX_SUBSCRIPTIONS_PER_CLIENT}"
    local configtoml_rpc_experimental_subscription_buffer_size="${CONFIGTOML_RPC_EXPERIMENTAL_SUBSCRIPTION_BUFFER_SIZE}"
    local configtoml_rpc_experimental_websocket_write_buffer_size="${CONFIGTOML_RPC_EXPERIMENTAL_WEBSOCKET_WRITE_BUFFER_SIZE}"
    local configtoml_rpc_experimental_close_on_slow_client="${CONFIGTOML_RPC_EXPERIMENTAL_CLOSE_ON_SLOW_CLIENT}"
    local configtoml_rpc_timeout_broadcast_tx_commit="${CONFIGTOML_RPC_TIMEOUT_BROADCAST_TX_COMMIT}"
    local configtoml_rpc_max_request_batch_size="${CONFIGTOML_RPC_MAX_REQUEST_BATCH_SIZE}"
    local configtoml_rpc_max_body_bytes="${CONFIGTOML_RPC_MAX_BODY_BYTES}"
    local configtoml_rpc_max_header_bytes="${CONFIGTOML_RPC_MAX_HEADER_BYTES}"
    local configtoml_rpc_tls_cert_file="${CONFIGTOML_RPC_TLS_CERT_FILE}"
    local configtoml_rpc_tls_key_file="${CONFIGTOML_RPC_TLS_KEY_FILE}"
    local configtoml_rpc_pprof_laddr="${CONFIGTOML_RPC_PPROF_LADDR}"

    # - gRPC Server Configuration
    local configtoml_grpc_laddr="${CONFIGTOML_GRPC_LADDR}"
    local configtoml_grpc_version_service_enabled="${CONFIGTOML_GRPC_VERSION_SERVICE_ENABLED}"
    local configtoml_grpc_block_service_enabled="${CONFIGTOML_GRPC_BLOCK_SERVICE_ENABLED}"
    local configtoml_grpc_block_results_service_enabled="${CONFIGTOML_GRPC_BLOCK_RESULTS_SERVICE_ENABLED}"
    local configtoml_grpc_privileged_laddr="${CONFIGTOML_GRPC_PRIVILEGED_LADDR}"
    local configtoml_grpc_privileged_pruning_service_enabled="${CONFIGTOML_GRPC_PRIVILEGED_PRUNING_SERVICE_ENABLED}"
    
    # - P2P Configuration
    local configtoml_p2p_laddr="${CONFIGTOML_P2P_LADDR}"
    local configtoml_p2p_external_address="${CONFIGTOML_P2P_EXTERNAL_ADDRESS}"
    local configtoml_p2p_seeds="${CONFIGTOML_P2P_SEEDS}"
    local configtoml_p2p_persistent_peers="${CONFIGTOML_P2P_PERSISTENT_PEERS}"
    local configtoml_p2p_addr_book_file="${CONFIGTOML_P2P_ADDR_BOOK_FILE}"
    local configtoml_p2p_addr_book_strict="${CONFIGTOML_P2P_ADDR_BOOK_STRICT}"
    local configtoml_p2p_max_num_inbound_peers="${CONFIGTOML_P2P_MAX_NUM_INBOUND_PEERS}"
    local configtoml_p2p_max_num_outbound_peers="${CONFIGTOML_P2P_MAX_NUM_OUTBOUND_PEERS}"
    local configtoml_p2p_unconditional_peer_ids="${CONFIGTOML_P2P_UNCONDITIONAL_PEER_IDS}"
    local configtoml_p2p_persistent_peers_max_dial_period="${CONFIGTOML_P2P_PERSISTENT_PEERS_MAX_DIAL_PERIOD}"
    local configtoml_p2p_flush_throttle_timeout="${CONFIGTOML_P2P_FLUSH_THROTTLE_TIMEOUT}"
    local configtoml_p2p_max_packet_msg_payload_size="${CONFIGTOML_P2P_MAX_PACKET_MSG_PAYLOAD_SIZE}"
    local configtoml_p2p_send_rate="${CONFIGTOML_P2P_SEND_RATE}"
    local configtoml_p2p_recv_rate="${CONFIGTOML_P2P_RECV_RATE}"
    local configtoml_p2p_pex="${CONFIGTOML_P2P_PEX}"
    local configtoml_p2p_seed_mode="${CONFIGTOML_P2P_SEED_MODE}"
    local configtoml_p2p_private_peer_ids="${CONFIGTOML_P2P_PRIVATE_PEER_IDS}"
    local configtoml_p2p_allow_duplicate_ip="${CONFIGTOML_P2P_ALLOW_DUPLICATE_IP}"
    local configtoml_p2p_handshake_timeout="${CONFIGTOML_P2P_HANDSHAKE_TIMEOUT}"
    local configtoml_p2p_dial_timeout="${CONFIGTOML_P2P_DIAL_TIMEOUT}"

    # - Mempool Configuration
    local configtoml_mempool_type="${CONFIGTOML_MEMPOOL_TYPE}"
    local configtoml_mempool_recheck="${CONFIGTOML_MEMPOOL_RECHECK}"
    local configtoml_mempool_recheck_timeout="${CONFIGTOML_MEMPOOL_RECHECK_TIMEOUT}"
    local configtoml_mempool_broadcast="${CONFIGTOML_MEMPOOL_BROADCAST}"
    local configtoml_mempool_wal_dir="${CONFIGTOML_MEMPOOL_WAL_DIR}"
    local configtoml_mempool_size="${CONFIGTOML_MEMPOOL_SIZE}"
    local configtoml_mempool_max_tx_bytes="${CONFIGTOML_MEMPOOL_MAX_TX_BYTES}"
    local configtoml_mempool_max_txs_bytes="${CONFIGTOML_MEMPOOL_MAX_TXS_BYTES}"
    local configtoml_mempool_cache_size="${CONFIGTOML_MEMPOOL_CACHE_SIZE}"
    local configtoml_mempool_keep_invalid_txs_in_cache="${CONFIGTOML_MEMPOOL_KEEP_INVALID_TXS_IN_CACHE}"
    local configtoml_mempool_experimental_max_gossip_connections_to_persistent_peers="${CONFIGTOML_MEMPOOL_EXPERIMENTAL_MAX_GOSSIP_CONNECTIONS_TO_PERSISTENT_PEERS}"
    local configtoml_mempool_experimental_max_gossip_connections_to_non_persistent_peers="${CONFIGTOML_MEMPOOL_EXPERIMENTAL_MAX_GOSSIP_CONNECTIONS_TO_NON_PERSISTENT_PEERS}"

    # - State Sync Configuration
    local configtoml_statesync_enable="${CONFIGTOML_STATESYNC_ENABLE}"
    local configtoml_statesync_rpc_servers="${CONFIGTOML_STATESYNC_RPC_SERVERS}"
    local configtoml_statesync_trust_height="${CONFIGTOML_STATESYNC_TRUST_HEIGHT}"
    local configtoml_statesync_trust_hash="${CONFIGTOML_STATESYNC_TRUST_HASH}"
    local configtoml_statesync_trust_period="${CONFIGTOML_STATESYNC_TRUST_PERIOD}"
    local configtoml_statesync_discovery_time="${CONFIGTOML_STATESYNC_DISCOVERY_TIME}"
    local configtoml_statesync_temp_dir="${CONFIGTOML_STATESYNC_TEMP_DIR}"
    local configtoml_statesync_chunk_request_timeout="${CONFIGTOML_STATESYNC_CHUNK_REQUEST_TIMEOUT}"
    local configtoml_statesync_chunk_fetchers="${CONFIGTOML_STATESYNC_CHUNK_FETCHERS}"

    # - Block Sync Configuration
    local configtoml_blocksync_version="${CONFIGTOML_BLOCKSYNC_VERSION}"

    # - Consensus Configuration
    local configtoml_consensus_wal_file="${CONFIGTOML_CONSENSUS_WAL_FILE}"
    local configtoml_consensus_timeout_propose="${CONFIGTOML_CONSENSUS_TIMEOUT_PROPOSE}"
    local configtoml_consensus_timeout_propose_delta="${CONFIGTOML_CONSENSUS_TIMEOUT_PROPOSE_DELTA}"
    local configtoml_consensus_timeout_prevote="${CONFIGTOML_CONSENSUS_TIMEOUT_PREVOTE}"
    local configtoml_consensus_timeout_prevote_delta="${CONFIGTOML_CONSENSUS_TIMEOUT_PREVOTE_DELTA}"
    local configtoml_consensus_timeout_precommit="${CONFIGTOML_CONSENSUS_TIMEOUT_PRECOMMIT}"
    local configtoml_consensus_timeout_precommit_delta="${CONFIGTOML_CONSENSUS_TIMEOUT_PRECOMMIT_DELTA}"
    local configtoml_consensus_timeout_commit="${CONFIGTOML_CONSENSUS_TIMEOUT_COMMIT}"
    local configtoml_consensus_skip_timeout_commit="${CONFIGTOML_CONSENSUS_SKIP_TIMEOUT_COMMIT}"
    local configtoml_consensus_double_sign_check_height="${CONFIGTOML_CONSENSUS_DOUBLE_SIGN_CHECK_HEIGHT}"
    local configtoml_consensus_create_empty_blocks="${CONFIGTOML_CONSENSUS_CREATE_EMPTY_BLOCKS}"
    local configtoml_consensus_create_empty_blocks_interval="${CONFIGTOML_CONSENSUS_CREATE_EMPTY_BLOCKS_INTERVAL}"
    local configtoml_consensus_peer_gossip_sleep_duration="${CONFIGTOML_CONSENSUS_PEER_GOSSIP_SLEEP_DURATION}"
    local configtoml_consensus_peer_gossip_intraloop_sleep_duration="${CONFIGTOML_CONSENSUS_PEER_GOSSIP_INTRALOOP_SLEEP_DURATION}"
    local configtoml_consensus_peer_query_maj23_sleep_duration="${CONFIGTOML_CONSENSUS_PEER_QUERY_MAJ23_SLEEP_DURATION}"

    # - Storage Configuration
    local configtoml_storage_discard_abci_responses="${CONFIGTOML_STORAGE_DISCARD_ABCI_RESPONSES}"
    local configtoml_storage_experimental_db_key_layout="${CONFIGTOML_STORAGE_EXPERIMENTAL_DB_KEY_LAYOUT}"
    local configtoml_storage_compact="${CONFIGTOML_STORAGE_COMPACT}"
    local configtoml_storage_compaction_interval="${CONFIGTOML_STORAGE_COMPACTION_INTERVAL}"
    local configtoml_storage_pruning_interval="${CONFIGTOML_STORAGE_PRUNING_INTERVAL}"
    local configtoml_storage_pruning_data_companion_enabled="${CONFIGTOML_STORAGE_PRUNING_DATA_COMPANION_ENABLED}"
    local configtoml_storage_pruning_data_companion_initial_block_retain_height="${CONFIGTOML_STORAGE_PRUNING_DATA_COMPANION_INITIAL_BLOCK_RETAIN_HEIGHT}"
    local configtoml_storage_pruning_data_companion_initial_block_results_retain_height="${CONFIGTOML_STORAGE_PRUNING_DATA_COMPANION_INITIAL_BLOCK_RESULTS_RETAIN_HEIGHT}"

    # - Transaction Indexer Configuration
    local configtoml_tx_index_indexer="${CONFIGTOML_TX_INDEX_INDEXER}"
    local configtoml_tx_index_psql_conn="${CONFIGTOML_TX_INDEX_PSQL_CONN}"

    # - Instrumentation Configuration
    local configtoml_instrumentation_prometheus="${CONFIGTOML_INSTRUMENTATION_PROMETHEUS}"
    local configtoml_instrumentation_prometheus_listen_addr="${CONFIGTOML_INSTRUMENTATION_PROMETHEUS_LISTEN_ADDR}"
    local configtoml_instrumentation_max_open_connections="${CONFIGTOML_INSTRUMENTATION_MAX_OPEN_CONNECTIONS}"
    local configtoml_instrumentation_namespace="${CONFIGTOML_INSTRUMENTATION_NAMESPACE}"

    # Parse arguments
    while [[ $# -gt 0 ]]; do
        case "$1" in
            --beranode-dir)
                if [[ -n "$2" ]]; then
                    BERANODES_PATH="$2"
                    shift 2
                else
                    log_warn "--beranode-dir is not set. defaulting to ${BERANODES_PATH:-$(pwd)/beranodes}"
                    shift
                fi
                ;;
            --docker-mode)
                docker_mode=true
                mode="docker"
                ;;
            --moniker)
                if [[ -n "$2" ]]; then
                    moniker="$2"
                    configtoml_moniker="$2"
                    shift 2
                else
                    log_warn "--moniker is not set. defaulting to a random name"
                    moniker="$(generate_random_name)"
                    configtoml_moniker="$moniker"
                    shift
                fi
                ;;
            --network)
                if [[ -n "$2" ]]; then
                    network="$2"
                    if [[ "$network" == "$CHAIN_NAME_DEVNET" ]]; then
                        chain_id=$CHAIN_ID_DEVNET
                        shift 2
                    elif [[ "$network" == "$CHAIN_NAME_TESTNET" ]]; then
                        chain_id=$CHAIN_ID_TESTNET
                        shift 2
                    elif [[ "$network" == "$CHAIN_NAME_MAINNET" ]]; then
                        chain_id=$CHAIN_ID_MAINNET
                        shift 2
                    else
                        log_warn "Unknown network: $network. Defaulting to $CHAIN_NAME_DEVNET"
                        network=$CHAIN_NAME_DEVNET
                        chain_id=$CHAIN_ID_DEVNET
                        shift 2
                    fi
                else 
                  shift
                fi
                ;;
            --validators)
                if [[ -n "$2" ]]; then
                  validators="$2"
                  shift 2
                else
                  shift
                fi
                ;;
            --full-nodes)
                if [[ -n "$2" ]]; then
                    full_nodes="$2"
                    shift 2
                else
                    log_warn "--full-nodes is not set. defaulting to 0"
                    full_nodes=0
                fi
                ;;
            --pruned-nodes)
                if [[ -n "$2" ]]; then
                    pruned_nodes="$2"
                    shift 2
                else
                    shift
                fi
                ;;
            --wallet-private-key)
                if [[ -n "$2" ]]; then
                    wallet_private_key="$2"
                    shift 2
                else
                    shift
                fi
                ;;
            --wallet-address)
                if [[ -n "$2" ]]; then
                    wallet_address="$2"
                    shift 2
                else
                    shift
                fi
                ;;
            --wallet-balance)
                if [[ -n "$2" ]]; then
                    wallet_balance="$2"
                    shift 2
                else
                    wallet_balance=${DEFAULT_WALLET_BALANCE}
                    shift 2
                fi
                ;;
            # client.toml configuration variables
            --clienttoml-chain-id)
                if [[ -n "$2" ]]; then clienttoml_chain_id="$2"; shift 2; else clienttoml_chain_id="${CLIENTTOML_CHAIN_ID}"; shift; fi ;;
            --clienttoml-keyring-backend)
                if [[ -n "$2" ]]; then clienttoml_keyring_backend="$2"; shift 2; else clienttoml_keyring_backend="${CLIENTTOML_KEYRING_BACKEND}"; shift; fi ;;
            --clienttoml-keyring-default-keyname)
                if [[ -n "$2" ]]; then clienttoml_keyring_default_keyname="$2"; shift 2; else clienttoml_keyring_default_keyname="${CLIENTTOML_KEYRING_DEFAULT_KEYNAME}"; shift; fi ;;
            --clienttoml-output)
                if [[ -n "$2" ]]; then clienttoml_output="$2"; shift 2; else clienttoml_output="${CLIENTTOML_OUTPUT}"; shift; fi ;;
            --clienttoml-node)
                if [[ -n "$2" ]]; then clienttoml_node="$2"; shift 2; else clienttoml_node="${CLIENTTOML_NODE}"; shift; fi ;;
            --clienttoml-broadcast-mode)
                if [[ -n "$2" ]]; then clienttoml_broadcast_mode="$2"; shift 2; else clienttoml_broadcast_mode="${CLIENTTOML_BROADCAST_MODE}"; shift; fi ;;
            --clienttoml-grpc-address)
                if [[ -n "$2" ]]; then clienttoml_grpc_address="$2"; shift 2; else clienttoml_grpc_address="${CLIENTTOML_GRPC_ADDRESS}"; shift; fi ;;
            --clienttoml-grpc-insecure)
                if [[ -n "$2" ]]; then clienttoml_grpc_insecure="$2"; shift 2; else clienttoml_grpc_insecure="${CLIENTTOML_GRPC_INSECURE}"; shift; fi ;;
            # app.toml configuration variables
            --apptoml-pruning)
                if [[ -n "$2" ]]; then apptoml_pruning="$2"; shift 2; else apptoml_pruning="${APPTOML_PRUNING}"; shift; fi ;;
            --apptoml-pruning-keep-recent)
                if [[ -n "$2" ]]; then apptoml_pruning_keep_recent="$2"; shift 2; else apptoml_pruning_keep_recent="${APPTOML_PRUNING_KEEP_RECENT}"; shift; fi ;;
            --apptoml-pruning-interval)
                if [[ -n "$2" ]]; then apptoml_pruning_interval="$2"; shift 2; else apptoml_pruning_interval="${APPTOML_PRUNING_INTERVAL}"; shift; fi ;;
            --apptoml-halt-height)
                if [[ -n "$2" ]]; then apptoml_halt_height="$2"; shift 2; else apptoml_halt_height="${APPTOML_HALT_HEIGHT}"; shift; fi ;;
            --apptoml-halt-time)
                if [[ -n "$2" ]]; then apptoml_halt_time="$2"; shift 2; else apptoml_halt_time="${APPTOML_HALT_TIME}"; shift; fi ;;
            --apptoml-min-retain-blocks)
                if [[ -n "$2" ]]; then apptoml_min_retain_blocks="$2"; shift 2; else apptoml_min_retain_blocks="${APPTOML_MIN_RETAIN_BLOCKS}"; shift; fi ;;
            --apptoml-inter-block-cache)
                if [[ -n "$2" ]]; then apptoml_inter_block_cache="$2"; shift 2; else apptoml_inter_block_cache="${APPTOML_INTER_BLOCK_CACHE}"; shift; fi ;;
            --apptoml-iavl-cache-size)
                if [[ -n "$2" ]]; then apptoml_iavl_cache_size="$2"; shift 2; else apptoml_iavl_cache_size="${APPTOML_IAVL_CACHE_SIZE}"; shift; fi ;;
            --apptoml-iavl-disable-fastnode)
                if [[ -n "$2" ]]; then apptoml_iavl_disable_fastnode="$2"; shift 2; else apptoml_iavl_disable_fastnode="${APPTOML_IAVL_DISABLE_FASTNODE}"; shift; fi ;;
            --apptoml-app-db-backend)
                if [[ -n "$2" ]]; then apptoml_app_db_backend="$2"; shift 2; else apptoml_app_db_backend="${APPTOML_APP_DB_BACKEND}"; shift; fi ;;
            # - Telemetry Configuration
            --apptoml-telemetry-service-name)
                if [[ -n "$2" ]]; then apptoml_telemetry_service_name="$2"; shift 2; else apptoml_telemetry_service_name="${APPTOML_TELEMETRY_SERVICE_NAME}"; shift; fi ;;
            --apptoml-telemetry-enabled)
                if [[ -n "$2" ]]; then apptoml_telemetry_enabled="$2"; shift 2; else apptoml_telemetry_enabled="${APPTOML_TELEMETRY_ENABLED}"; shift; fi ;;
            --apptoml-telemetry-enable-hostname)
                if [[ -n "$2" ]]; then apptoml_telemetry_enable_hostname="$2"; shift 2; else apptoml_telemetry_enable_hostname="${APPTOML_TELEMETRY_ENABLE_HOSTNAME}"; shift; fi ;;
            --apptoml-telemetry-enable-hostname-label)
                if [[ -n "$2" ]]; then apptoml_telemetry_enable_hostname_label="$2"; shift 2; else apptoml_telemetry_enable_hostname_label="${APPTOML_TELEMETRY_ENABLE_HOSTNAME_LABEL}"; shift; fi ;;
            --apptoml-telemetry-enable-service-label)
                if [[ -n "$2" ]]; then apptoml_telemetry_enable_service_label="$2"; shift 2; else apptoml_telemetry_enable_service_label="${APPTOML_TELEMETRY_ENABLE_SERVICE_LABEL}"; shift; fi ;;
            --apptoml-telemetry-prometheus-retention-time)
                if [[ -n "$2" ]]; then apptoml_telemetry_prometheus_retention_time="$2"; shift 2; else apptoml_telemetry_prometheus_retention_time="${APPTOML_TELEMETRY_PROMETHEUS_RETENTION_TIME}"; shift; fi ;;
            --apptoml-telemetry-metrics-sink)
                if [[ -n "$2" ]]; then apptoml_telemetry_metrics_sink="$2"; shift 2; else apptoml_telemetry_metrics_sink="${APPTOML_TELEMETRY_METRICS_SINK}"; shift; fi ;;
            --apptoml-telemetry-statsd-addr)
                if [[ -n "$2" ]]; then apptoml_telemetry_statsd_addr="$2"; shift 2; else apptoml_telemetry_statsd_addr="${APPTOML_TELEMETRY_STATSD_ADDR}"; shift; fi ;;
            --apptoml-telemetry-datadog-hostname)
                if [[ -n "$2" ]]; then apptoml_telemetry_datadog_hostname="$2"; shift 2; else apptoml_telemetry_datadog_hostname="${APPTOML_TELEMETRY_DATADOG_HOSTNAME}"; shift; fi ;;
            # - BeacondKit Configuration
            --apptoml-beacon-kit-chain-spec)
                if [[ -n "$2" ]]; then apptoml_beacon_kit_chain_spec="$2"; shift 2; else apptoml_beacon_kit_chain_spec="${APPTOML_BEACON_KIT_CHAIN_SPEC}"; shift; fi ;;
            --apptoml-beacon-kit-chain-spec-file)
                if [[ -n "$2" ]]; then apptoml_beacon_kit_chain_spec_file="$2"; shift 2; else apptoml_beacon_kit_chain_spec_file="${APPTOML_BEACON_KIT_CHAIN_SPEC_FILE}"; shift; fi ;;
            --apptoml-beacon-kit-shutdown-timeout)
                if [[ -n "$2" ]]; then apptoml_beacon_kit_shutdown_timeout="$2"; shift 2; else apptoml_beacon_kit_shutdown_timeout="${APPTOML_BEACON_KIT_SHUTDOWN_TIMEOUT}"; shift; fi ;;
            # - BeaconKit Engine Configuration
            --apptoml-beacon-kit-engine-rpc-dial-url)
                if [[ -n "$2" ]]; then apptoml_beacon_kit_engine_rpc_dial_url="$2"; shift 2; else apptoml_beacon_kit_engine_rpc_dial_url="${APPTOML_BEACON_KIT_ENGINE_RPC_DIAL_URL}"; shift; fi ;;
            --apptoml-beacon-kit-engine-rpc-timeout)
                if [[ -n "$2" ]]; then apptoml_beacon_kit_engine_rpc_timeout="$2"; shift 2; else apptoml_beacon_kit_engine_rpc_timeout="${APPTOML_BEACON_KIT_ENGINE_RPC_TIMEOUT}"; shift; fi ;;
            --apptoml-beacon-kit-engine-rpc-retry-interval)
                if [[ -n "$2" ]]; then apptoml_beacon_kit_engine_rpc_retry_interval="$2"; shift 2; else apptoml_beacon_kit_engine_rpc_retry_interval="${APPTOML_BEACON_KIT_ENGINE_RPC_RETRY_INTERVAL}"; shift; fi ;;
            --apptoml-beacon-kit-engine-rpc-max-retry-interval)
                if [[ -n "$2" ]]; then apptoml_beacon_kit_engine_rpc_max_retry_interval="$2"; shift 2; else apptoml_beacon_kit_engine_rpc_max_retry_interval="${APPTOML_BEACON_KIT_ENGINE_RPC_MAX_RETRY_INTERVAL}"; shift; fi ;;
            --apptoml-beacon-kit-engine-rpc-startup-check-interval)
                if [[ -n "$2" ]]; then apptoml_beacon_kit_engine_rpc_startup_check_interval="$2"; shift 2; else apptoml_beacon_kit_engine_rpc_startup_check_interval="${APPTOML_BEACON_KIT_ENGINE_RPC_STARTUP_CHECK_INTERVAL}"; shift; fi ;;
            --apptoml-beacon-kit-engine-rpc-jwt-refresh-interval)
                if [[ -n "$2" ]]; then apptoml_beacon_kit_engine_rpc_jwt_refresh_interval="$2"; shift 2; else apptoml_beacon_kit_engine_rpc_jwt_refresh_interval="${APPTOML_BEACON_KIT_ENGINE_RPC_JWT_REFRESH_INTERVAL}"; shift; fi ;;
            --apptoml-beacon-kit-engine-jwt-secret-path)
                if [[ -n "$2" ]]; then apptoml_beacon_kit_engine_jwt_secret_path="$2"; shift 2; else apptoml_beacon_kit_engine_jwt_secret_path="${APPTOML_BEACON_KIT_ENGINE_JWT_SECRET_PATH}"; shift; fi ;;
            # - BeaconKit Logger Configuration
            --apptoml-beacon-kit-logger-time-format)
                if [[ -n "$2" ]]; then apptoml_beacon_kit_logger_time_format="$2"; shift 2; else apptoml_beacon_kit_logger_time_format="${APPTOML_BEACON_KIT_LOGGER_TIME_FORMAT}"; shift; fi ;;
            --apptoml-beacon-kit-logger-log-level)
                if [[ -n "$2" ]]; then apptoml_beacon_kit_logger_log_level="$2"; shift 2; else apptoml_beacon_kit_logger_log_level="${APPTOML_BEACON_KIT_LOGGER_LOG_LEVEL}"; shift; fi ;;
            --apptoml-beacon-kit-logger-style)
                if [[ -n "$2" ]]; then apptoml_beacon_kit_logger_style="$2"; shift 2; else apptoml_beacon_kit_logger_style="${APPTOML_BEACON_KIT_LOGGER_STYLE}"; shift; fi ;;
            # - BeaconKit KZG Configuration
            --apptoml-beacon-kit-kzg-trusted-setup-path)
                if [[ -n "$2" ]]; then apptoml_beacon_kit_kzg_trusted_setup_path="$2"; shift 2; else apptoml_beacon_kit_kzg_trusted_setup_path="${APPTOML_BEACON_KIT_KZG_TRUSTED_SETUP_PATH}"; shift; fi ;;
            --apptoml-beacon-kit-kzg-implementation)
                if [[ -n "$2" ]]; then apptoml_beacon_kit_kzg_implementation="$2"; shift 2; else apptoml_beacon_kit_kzg_implementation="${APPTOML_BEACON_KIT_KZG_IMPLEMENTATION}"; shift; fi ;;
            # - BeaconKit Payload Builder Configuration
            --apptoml-beacon-kit-payload-builder-enabled)
                if [[ -n "$2" ]]; then apptoml_beacon_kit_payload_builder_enabled="$2"; shift 2; else apptoml_beacon_kit_payload_builder_enabled="${APPTOML_BEACON_KIT_PAYLOAD_BUILDER_ENABLED}"; shift; fi ;;
            --apptoml-beacon-kit-payload-builder-suggested-fee-recipient)
                if [[ -n "$2" ]]; then apptoml_beacon_kit_payload_builder_suggested_fee_recipient="$2"; shift 2; else apptoml_beacon_kit_payload_builder_suggested_fee_recipient="${APPTOML_BEACON_KIT_PAYLOAD_BUILDER_SUGGESTED_FEE_RECIPIENT}"; shift; fi ;;
            --apptoml-beacon-kit-payload-builder-payload-timeout)
                if [[ -n "$2" ]]; then apptoml_beacon_kit_payload_builder_payload_timeout="$2"; shift 2; else apptoml_beacon_kit_payload_builder_payload_timeout="${APPTOML_BEACON_KIT_PAYLOAD_BUILDER_PAYLOAD_TIMEOUT}"; shift; fi ;;
            --apptoml-beacon-kit-validator-graffiti)
                if [[ -n "$2" ]]; then apptoml_beacon_kit_validator_graffiti="$2"; shift 2; else apptoml_beacon_kit_validator_graffiti="${APPTOML_BEACON_KIT_VALIDATOR_GRAFFITI}"; shift; fi ;;
            --apptoml-beacon-kit-validator-availability-window)
                if [[ -n "$2" ]]; then apptoml_beacon_kit_validator_availability_window="$2"; shift 2; else apptoml_beacon_kit_validator_availability_window="${APPTOML_BEACON_KIT_VALIDATOR_AVAILABILITY_WINDOW}"; shift; fi ;;
            # - BeaconKit Validator Configuration
            --apptoml-beacon-kit-node-api-enabled)
                if [[ -n "$2" ]]; then apptoml_beacon_kit_node_api_enabled="$2"; shift 2; else apptoml_beacon_kit_node_api_enabled="${APPTOML_BEACON_KIT_NODE_API_ENABLED}"; shift; fi ;;
            --apptoml-beacon-kit-node-api-address)
                if [[ -n "$2" ]]; then apptoml_beacon_kit_node_api_address="$2"; shift 2; else apptoml_beacon_kit_node_api_address="${APPTOML_BEACON_KIT_NODE_API_ADDRESS}"; shift; fi ;;
            --apptoml-beacon-kit-node-api-logging)
                if [[ -n "$2" ]]; then apptoml_beacon_kit_node_api_logging="$2"; shift 2; else apptoml_beacon_kit_node_api_logging="${APPTOML_BEACON_KIT_NODE_API_LOGGING}"; shift; fi ;;
            # config.toml configuration variables
            --configtoml-version)
                if [[ -n "$2" ]]; then configtoml_version="$2"; shift 2; else configtoml_version="${CONFIGTOML_VERSION}"; shift; fi ;;
            --configtoml-proxy-app)
                if [[ -n "$2" ]]; then configtoml_proxy_app="$2"; shift 2; else configtoml_proxy_app="${CONFIGTOML_PROXY_APP}"; shift; fi ;;
            # --configtoml-moniker)
            #     if [[ -n "$2" ]]; then configtoml_moniker="$2"; shift 2; else configtoml_moniker="${CONFIGTOML_MONIKER}"; shift; fi ;;
            --configtoml-db-backend)
                if [[ -n "$2" ]]; then configtoml_db_backend="$2"; shift 2; else configtoml_db_backend="${CONFIGTOML_DB_BACKEND}"; shift; fi ;;
            --configtoml-db-dir)
                if [[ -n "$2" ]]; then configtoml_db_dir="$2"; shift 2; else configtoml_db_dir="${CONFIGTOML_DB_DIR}"; shift; fi ;;
            --configtoml-log-level)
                if [[ -n "$2" ]]; then configtoml_log_level="$2"; shift 2; else configtoml_log_level="${CONFIGTOML_LOG_LEVEL}"; shift; fi ;;
            --configtoml-log-format)
                if [[ -n "$2" ]]; then configtoml_log_format="$2"; shift 2; else configtoml_log_format="${CONFIGTOML_LOG_FORMAT}"; shift; fi ;;
            --configtoml-genesis-file)
                if [[ -n "$2" ]]; then configtoml_genesis_file="$2"; shift 2; else configtoml_genesis_file="${CONFIGTOML_GENESIS_FILE}"; shift; fi ;;
            --configtoml-priv-validator-key-file)
                if [[ -n "$2" ]]; then configtoml_priv_validator_key_file="$2"; shift 2; else configtoml_priv_validator_key_file="${CONFIGTOML_PRIV_VALIDATOR_KEY_FILE}"; shift; fi ;;
            --configtoml-priv-validator-state-file)
                if [[ -n "$2" ]]; then configtoml_priv_validator_state_file="$2"; shift 2; else configtoml_priv_validator_state_file="${CONFIGTOML_PRIV_VALIDATOR_STATE_FILE}"; shift; fi ;;
            --configtoml-priv-validator-laddr)
                if [[ -n "$2" ]]; then configtoml_priv_validator_laddr="$2"; shift 2; else configtoml_priv_validator_laddr="${CONFIGTOML_PRIV_VALIDATOR_LADDR}"; shift; fi ;;
            --configtoml-node-key-file)
                if [[ -n "$2" ]]; then configtoml_node_key_file="$2"; shift 2; else configtoml_node_key_file="${CONFIGTOML_NODE_KEY_FILE}"; shift; fi ;;
            --configtoml-abci)
                if [[ -n "$2" ]]; then configtoml_abci="$2"; shift 2; else configtoml_abci="${CONFIGTOML_ABCI}"; shift; fi ;;
            --configtoml-filter-peers)
                if [[ -n "$2" ]]; then configtoml_filter_peers="$2"; shift 2; else configtoml_filter_peers="${CONFIGTOML_FILTER_PEERS}"; shift; fi ;;
            # - RPC Server Configuration
            --configtoml-rpc-laddr)
                if [[ -n "$2" ]]; then configtoml_rpc_laddr="$2"; shift 2; else configtoml_rpc_laddr="${CONFIGTOML_RPC_LADDR}"; shift; fi ;;
            --configtoml-rpc-unsafe)
                if [[ -n "$2" ]]; then configtoml_rpc_unsafe="$2"; shift 2; else configtoml_rpc_unsafe="${CONFIGTOML_RPC_UNSAFE}"; shift; fi ;;
            --configtoml-rpc-cors-allowed-origins)
                if [[ -n "$2" ]]; then configtoml_rpc_cors_allowed_origins="$2"; shift 2; else configtoml_rpc_cors_allowed_origins="${CONFIGTOML_RPC_CORS_ALLOWED_ORIGINS}"; shift; fi ;;
            --configtoml-rpc-cors-allowed-methods)
                if [[ -n "$2" ]]; then configtoml_rpc_cors_allowed_methods="$2"; shift 2; else configtoml_rpc_cors_allowed_methods="${CONFIGTOML_RPC_CORS_ALLOWED_METHODS}"; shift; fi ;;
            --configtoml-rpc-cors-allowed-methods)
                if [[ -n "$2" ]]; then configtoml_rpc_cors_allowed_headers="$2"; shift 2; else configtoml_rpc_cors_allowed_headers="${CONFIGTOML_RPC_CORS_ALLOWED_HEADERS}"; shift; fi ;;
            --configtoml-rpc-max-open-connections)
                if [[ -n "$2" ]]; then configtoml_rpc_max_open_connections="$2"; shift 2; else configtoml_rpc_max_open_connections="${CONFIGTOML_RPC_MAX_OPEN_CONNECTIONS}"; shift; fi ;;
            --configtoml-rpc-max-subscription-clients)
                if [[ -n "$2" ]]; then configtoml_rpc_max_subscription_clients="$2"; shift 2; else configtoml_rpc_max_subscription_clients="${CONFIGTOML_RPC_MAX_SUBSCRIPTION_CLIENTS}"; shift; fi ;;
            --configtoml-rpc-max-subscriptions-per-client)
                if [[ -n "$2" ]]; then configtoml_rpc_max_subscriptions_per_client="$2"; shift 2; else configtoml_rpc_max_subscriptions_per_client="${CONFIGTOML_RPC_MAX_SUBSCRIPTIONS_PER_CLIENT}"; shift; fi ;;
            --configtoml-rpc-experimental-subscription-buffer-size)
                if [[ -n "$2" ]]; then configtoml_rpc_experimental_subscription_buffer_size="$2"; shift 2; else configtoml_rpc_experimental_subscription_buffer_size="${CONFIGTOML_RPC_EXPERIMENTAL_SUBSCRIPTION_BUFFER_SIZE}"; shift; fi ;;
            --configtoml-rpc-experimental-websocket-write-buffer-size)
                if [[ -n "$2" ]]; then configtoml_rpc_experimental_websocket_write_buffer_size="$2"; shift 2; else configtoml_rpc_experimental_websocket_write_buffer_size="${CONFIGTOML_RPC_EXPERIMENTAL_WEBSOCKET_WRITE_BUFFER_SIZE}"; shift; fi ;;
            --configtoml-rpc-experimental-close-on-slow-client)
                if [[ -n "$2" ]]; then configtoml_rpc_experimental_close_on_slow_client="$2"; shift 2; else configtoml_rpc_experimental_close_on_slow_client="${CONFIGTOML_RPC_EXPERIMENTAL_CLOSE_ON_SLOW_CLIENT}"; shift; fi ;;
            --configtoml-rpc-timeout-broadcast-tx-commit)
                if [[ -n "$2" ]]; then configtoml_rpc_timeout_broadcast_tx_commit="$2"; shift 2; else configtoml_rpc_timeout_broadcast_tx_commit="${CONFIGTOML_RPC_TIMEOUT_BROADCAST_TX_COMMIT}"; shift; fi ;;
            --configtoml-rpc-max-request-batch-size)
                if [[ -n "$2" ]]; then configtoml_rpc_max_request_batch_size="$2"; shift 2; else configtoml_rpc_max_request_batch_size="${CONFIGTOML_RPC_MAX_REQUEST_BATCH_SIZE}"; shift; fi ;;
            --configtoml-rpc-max-body-bytes)
                if [[ -n "$2" ]]; then configtoml_rpc_max_body_bytes="$2"; shift 2; else configtoml_rpc_max_body_bytes="${CONFIGTOML_RPC_MAX_BODY_BYTES}"; shift; fi ;;
            --configtoml-rpc-max-header-bytes)
                if [[ -n "$2" ]]; then configtoml_rpc_max_header_bytes="$2"; shift 2; else configtoml_rpc_max_header_bytes="${CONFIGTOML_RPC_MAX_HEADER_BYTES}"; shift; fi ;;
            --configtoml-rpc-tls-cert-file)
                if [[ -n "$2" ]]; then configtoml_rpc_tls_cert_file="$2"; shift 2; else configtoml_rpc_tls_cert_file="${CONFIGTOML_RPC_TLS_CERT_FILE}"; shift; fi ;;
            --configtoml-rpc-tls-key-file)
                if [[ -n "$2" ]]; then configtoml_rpc_tls_key_file="$2"; shift 2; else configtoml_rpc_tls_key_file="${CONFIGTOML_RPC_TLS_KEY_FILE}"; shift; fi ;;
            --configtoml-rpc-pprof-laddr)
                if [[ -n "$2" ]]; then configtoml_rpc_pprof_laddr="$2"; shift 2; else configtoml_rpc_pprof_laddr="${CONFIGTOML_RPC_PPROF_LADDR}"; shift; fi ;;
            # - gRPC Server Configuration
            --configtoml-grpc-laddr)
                if [[ -n "$2" ]]; then configtoml_grpc_laddr="$2"; shift 2; else configtoml_grpc_laddr="${CONFIGTOML_GRPC_LADDR}"; shift; fi ;;
            --configtoml-grpc-version-service-enabled)
                if [[ -n "$2" ]]; then configtoml_grpc_version_service_enabled="$2"; shift 2; else configtoml_grpc_version_service_enabled="${CONFIGTOML_GRPC_VERSION_SERVICE_ENABLED}"; shift; fi ;;
            --configtoml-grpc-block-service-enabled)
                if [[ -n "$2" ]]; then configtoml_grpc_block_service_enabled="$2"; shift 2; else configtoml_grpc_block_service_enabled="${CONFIGTOML_GRPC_BLOCK_SERVICE_ENABLED}"; shift; fi ;;
            --configtoml-grpc-block-results-service-enabled)
                if [[ -n "$2" ]]; then configtoml_grpc_block_results_service_enabled="$2"; shift 2; else configtoml_grpc_block_results_service_enabled="${CONFIGTOML_GRPC_BLOCK_RESULTS_SERVICE_ENABLED}"; shift; fi ;;
            --configtoml-grpc-privileged-laddr)
                if [[ -n "$2" ]]; then configtoml_grpc_privileged_laddr="$2"; shift 2; else configtoml_grpc_privileged_laddr="${CONFIGTOML_GRPC_PRIVILEGED_LADDR}"; shift; fi ;;
            --configtoml-grpc-privileged-pruning-service-enabled)
                if [[ -n "$2" ]]; then configtoml_grpc_privileged_pruning_service_enabled="$2"; shift 2; else configtoml_grpc_privileged_pruning_service_enabled="${CONFIGTOML_GRPC_PRIVILEGED_PRUNING_SERVICE_ENABLED}"; shift; fi ;;
            # - P2P Configuration
            --configtoml-p2p-laddr)
                if [[ -n "$2" ]]; then configtoml_p2p_laddr="$2"; shift 2; else configtoml_p2p_laddr="${CONFIGTOML_P2P_LADDR}"; shift; fi ;;
            --configtoml-p2p-external-address)
                if [[ -n "$2" ]]; then configtoml_p2p_external_address="$2"; shift 2; else configtoml_p2p_external_address="${CONFIGTOML_P2P_EXTERNAL_ADDRESS}"; shift; fi ;;
            --configtoml-p2p-seeds)
                if [[ -n "$2" ]]; then configtoml_p2p_seeds="$2"; shift 2; else configtoml_p2p_seeds="${CONFIGTOML_P2P_SEEDS}"; shift; fi ;;
            --configtoml-p2p-persistent-peers)
                if [[ -n "$2" ]]; then configtoml_p2p_persistent_peers="$2"; shift 2; else configtoml_p2p_persistent_peers="${CONFIGTOML_P2P_PERSISTENT_PEERS}"; shift; fi ;;
            --configtoml-p2p-addr-book-file)
                if [[ -n "$2" ]]; then configtoml_p2p_addr_book_file="$2"; shift 2; else configtoml_p2p_addr_book_file="${CONFIGTOML_P2P_ADDR_BOOK_FILE}"; shift; fi ;;
            --configtoml-p2p-addr-book-strict)
                if [[ -n "$2" ]]; then configtoml_p2p_addr_book_strict="$2"; shift 2; else configtoml_p2p_addr_book_strict="${CONFIGTOML_P2P_ADDR_BOOK_STRICT}"; shift; fi ;;
            --configtoml-p2p-max-num-inbound-peers)
                if [[ -n "$2" ]]; then configtoml_p2p_max_num_inbound_peers="$2"; shift 2; else configtoml_p2p_max_num_inbound_peers="${CONFIGTOML_P2P_MAX_NUM_INBOUND_PEERS}"; shift; fi ;;
            --configtoml-p2p-max-num-outbound-peers)
                if [[ -n "$2" ]]; then configtoml_p2p_max_num_outbound_peers="$2"; shift 2; else configtoml_p2p_max_num_outbound_peers="${CONFIGTOML_P2P_MAX_NUM_OUTBOUND_PEERS}"; shift; fi ;;
            --configtoml-p2p-unconditional-peer-ids)
                if [[ -n "$2" ]]; then configtoml_p2p_unconditional_peer_ids="$2"; shift 2; else configtoml_p2p_unconditional_peer_ids="${CONFIGTOML_P2P_UNCONDITIONAL_PEER_IDS}"; shift; fi ;;
            --configtoml-p2p-persistent-peers-max-dial-period)
                if [[ -n "$2" ]]; then configtoml_p2p_persistent_peers_max_dial_period="$2"; shift 2; else configtoml_p2p_persistent_peers_max_dial_period="${CONFIGTOML_P2P_PERSISTENT_PEERS_MAX_DIAL_PERIOD}"; shift; fi ;;
            --configtoml-p2p-flush-throttle-timeout)
                if [[ -n "$2" ]]; then configtoml_p2p_flush_throttle_timeout="$2"; shift 2; else configtoml_p2p_flush_throttle_timeout="${CONFIGTOML_P2P_FLUSH_THROTTLE_TIMEOUT}"; shift; fi ;;
            --configtoml-p2p-max-packet-msg-payload-size)
                if [[ -n "$2" ]]; then configtoml_p2p_max_packet_msg_payload_size="$2"; shift 2; else configtoml_p2p_max_packet_msg_payload_size="${CONFIGTOML_P2P_MAX_PACKET_MSG_PAYLOAD_SIZE}"; shift; fi ;;
            --configtoml-p2p-send-rate)
                if [[ -n "$2" ]]; then configtoml_p2p_send_rate="$2"; shift 2; else configtoml_p2p_send_rate="${CONFIGTOML_P2P_SEND_RATE}"; shift; fi ;;
            --configtoml-p2p-recv-rate)
                if [[ -n "$2" ]]; then configtoml_p2p_recv_rate="$2"; shift 2; else configtoml_p2p_recv_rate="${CONFIGTOML_P2P_RECV_RATE}"; shift; fi ;;
            --configtoml-p2p-pex)
                if [[ -n "$2" ]]; then configtoml_p2p_pex="$2"; shift 2; else configtoml_p2p_pex="${CONFIGTOML_P2P_PEX}"; shift; fi ;;
            --configtoml-p2p-seed-mode)
                if [[ -n "$2" ]]; then configtoml_p2p_seed_mode="$2"; shift 2; else configtoml_p2p_seed_mode="${CONFIGTOML_P2P_SEED_MODE}"; shift; fi ;;
            --configtoml-p2p-private-peer-ids)
                if [[ -n "$2" ]]; then configtoml_p2p_private_peer_ids="$2"; shift 2; else configtoml_p2p_private_peer_ids="${CONFIGTOML_P2P_PRIVATE_PEER_IDS}"; shift; fi ;;
            --configtoml-p2p-allow-duplicate-ip)
                if [[ -n "$2" ]]; then configtoml_p2p_allow_duplicate_ip="$2"; shift 2; else configtoml_p2p_allow_duplicate_ip="${CONFIGTOML_P2P_ALLOW_DUPLICATE_IP}"; shift; fi ;;
            --configtoml-p2p-handshake-timeout)
                if [[ -n "$2" ]]; then configtoml_p2p_handshake_timeout="$2"; shift 2; else configtoml_p2p_handshake_timeout="${CONFIGTOML_P2P_HANDSHAKE_TIMEOUT}"; shift; fi ;;
            --configtoml-p2p-dial-timeout)
                if [[ -n "$2" ]]; then configtoml_p2p_dial_timeout="$2"; shift 2; else configtoml_p2p_dial_timeout="${CONFIGTOML_P2P_DIAL_TIMEOUT}"; shift; fi ;;
            # - Mempool Configuration
            --configtoml-mempool-type)
                if [[ -n "$2" ]]; then configtoml_mempool_type="$2"; shift 2; else configtoml_mempool_type="${CONFIGTOML_MEMPOOL_TYPE}"; shift; fi ;;
            --configtoml-mempool-recheck)
                if [[ -n "$2" ]]; then configtoml_mempool_recheck="$2"; shift 2; else configtoml_mempool_recheck="${CONFIGTOML_MEMPOOL_RECHECK}"; shift; fi ;;
            --configtoml-mempool-recheck-timeout)
                if [[ -n "$2" ]]; then configtoml_mempool_recheck_timeout="$2"; shift 2; else configtoml_mempool_recheck_timeout="${CONFIGTOML_MEMPOOL_RECHECK_TIMEOUT}"; shift; fi ;;
            --configtoml-mempool-broadcast)
                if [[ -n "$2" ]]; then configtoml_mempool_broadcast="$2"; shift 2; else configtoml_mempool_broadcast="${CONFIGTOML_MEMPOOL_BROADCAST}"; shift; fi ;;
            --configtoml-mempool-wal-dir)
                if [[ -n "$2" ]]; then configtoml_mempool_wal_dir="$2"; shift 2; else configtoml_mempool_wal_dir="${CONFIGTOML_MEMPOOL_WAL_DIR}"; shift; fi ;;
            --configtoml-mempool-size)
                if [[ -n "$2" ]]; then configtoml_mempool_size="$2"; shift 2; else configtoml_mempool_size="${CONFIGTOML_MEMPOOL_SIZE}"; shift; fi ;;
            --configtoml-mempool-max-tx-bytes)
                if [[ -n "$2" ]]; then configtoml_mempool_max_tx_bytes="$2"; shift 2; else configtoml_mempool_max_tx_bytes="${CONFIGTOML_MEMPOOL_MAX_TX_BYTES}"; shift; fi ;;
            --configtoml-mempool-max-txs-bytes)
                if [[ -n "$2" ]]; then configtoml_mempool_max_txs_bytes="$2"; shift 2; else configtoml_mempool_max_txs_bytes="${CONFIGTOML_MEMPOOL_MAX_TXS_BYTES}"; shift; fi ;;
            --configtoml-mempool-cache-size)
                if [[ -n "$2" ]]; then configtoml_mempool_cache_size="$2"; shift 2; else configtoml_mempool_cache_size="${CONFIGTOML_MEMPOOL_CACHE_SIZE}"; shift; fi ;;
            --configtoml-mempool-keep-invalid-txs-in-cache)
                if [[ -n "$2" ]]; then configtoml_mempool_keep_invalid_txs_in_cache="$2"; shift 2; else configtoml_mempool_keep_invalid_txs_in_cache="${CONFIGTOML_MEMPOOL_KEEP_INVALID_TXS_IN_CACHE}"; shift; fi ;;
            --configtoml-mempool-experimental-max-gossip-connections-to-persistent-peers)
                if [[ -n "$2" ]]; then configtoml_mempool_experimental_max_gossip_connections_to_persistent_peers="$2"; shift 2; else configtoml_mempool_experimental_max_gossip_connections_to_persistent_peers="${CONFIGTOML_MEMPOOL_EXPERIMENTAL_MAX_GOSSIP_CONNECTIONS_TO_PERSISTENT_PEERS}"; shift; fi ;;
            --configtoml-mempool-experimental-max-gossip-connections-to-non-persistent-peers)
                if [[ -n "$2" ]]; then configtoml_mempool_experimental_max_gossip_connections_to_non_persistent_peers="$2"; shift 2; else configtoml_mempool_experimental_max_gossip_connections_to_non_persistent_peers="${CONFIGTOML_MEMPOOL_EXPERIMENTAL_MAX_GOSSIP_CONNECTIONS_TO_NON_PERSISTENT_PEERS}"; shift; fi ;;
            # - State Sync Configuration
            --configtoml-statesync-enable)
                if [[ -n "$2" ]]; then configtoml_statesync_enable="$2"; shift 2; else configtoml_statesync_enable="${CONFIGTOML_STATESYNC_ENABLE}"; shift; fi ;;
            --configtoml-statesync-rpc-servers)
                if [[ -n "$2" ]]; then configtoml_statesync_rpc_servers="$2"; shift 2; else configtoml_statesync_rpc_servers="${CONFIGTOML_STATESYNC_RPC_SERVERS}"; shift; fi ;;
            --configtoml-statesync-trust-height)
                if [[ -n "$2" ]]; then configtoml_statesync_trust_height="$2"; shift 2; else configtoml_statesync_trust_height="${CONFIGTOML_STATESYNC_TRUST_HEIGHT}"; shift; fi ;;
            --configtoml-statesync-trust-hash)
                if [[ -n "$2" ]]; then configtoml_statesync_trust_hash="$2"; shift 2; else configtoml_statesync_trust_hash="${CONFIGTOML_STATESYNC_TRUST_HASH}"; shift; fi ;;
            --configtoml-statesync-trust-period)
                if [[ -n "$2" ]]; then configtoml_statesync_trust_period="$2"; shift 2; else configtoml_statesync_trust_period="${CONFIGTOML_STATESYNC_TRUST_PERIOD}"; shift; fi ;;
            --configtoml-statesync-discovery-time)
                if [[ -n "$2" ]]; then configtoml_statesync_discovery_time="$2"; shift 2; else configtoml_statesync_discovery_time="${CONFIGTOML_STATESYNC_DISCOVERY_TIME}"; shift; fi ;;
            --configtoml-statesync-temp-dir)
                if [[ -n "$2" ]]; then configtoml_statesync_temp_dir="$2"; shift 2; else configtoml_statesync_temp_dir="${CONFIGTOML_STATESYNC_TEMP_DIR}"; shift; fi ;;
            --configtoml-statesync-chunk-request-timeout)
                if [[ -n "$2" ]]; then configtoml_statesync_chunk_request_timeout="$2"; shift 2; else configtoml_statesync_chunk_request_timeout="${CONFIGTOML_STATESYNC_CHUNK_REQUEST_TIMEOUT}"; shift; fi ;;
            --configtoml-statesync-chunk-fetchers)
                if [[ -n "$2" ]]; then configtoml_statesync_chunk_fetchers="$2"; shift 2; else configtoml_statesync_chunk_fetchers="${CONFIGTOML_STATESYNC_CHUNK_FETCHERS}"; shift; fi ;;
            # - Block Sync Configuration
            --configtoml-blocksync-version)
                if [[ -n "$2" ]]; then configtoml_blocksync_version="$2"; shift 2; else configtoml_blocksync_version="${CONFIGTOML_BLOCKSYNC_VERSION}"; shift; fi ;;
            # - Consensus Configuration
            --configtoml-consensus-wal-file)
                if [[ -n "$2" ]]; then configtoml_consensus_wal_file="$2"; shift 2; else configtoml_consensus_wal_file="${CONFIGTOML_CONSENSUS_WAL_FILE}"; shift; fi ;;
            --configtoml-consensus-timeout-propose)
                if [[ -n "$2" ]]; then configtoml_consensus_timeout_propose="$2"; shift 2; else configtoml_consensus_timeout_propose="${CONFIGTOML_CONSENSUS_TIMEOUT_PROPOSE}"; shift; fi ;;
            --configtoml-consensus-timeout-propose-delta)
                if [[ -n "$2" ]]; then configtoml_consensus_timeout_propose_delta="$2"; shift 2; else configtoml_consensus_timeout_propose_delta="${CONFIGTOML_CONSENSUS_TIMEOUT_PROPOSE_DELTA}"; shift; fi ;;
            --configtoml-consensus-timeout-prevote)
                if [[ -n "$2" ]]; then configtoml_consensus_timeout_prevote="$2"; shift 2; else configtoml_consensus_timeout_prevote="${CONFIGTOML_CONSENSUS_TIMEOUT_PREVOTE}"; shift; fi ;;
            --configtoml-consensus-timeout-prevote-delta)
                if [[ -n "$2" ]]; then configtoml_consensus_timeout_prevote_delta="$2"; shift 2; else configtoml_consensus_timeout_prevote_delta="${CONFIGTOML_CONSENSUS_TIMEOUT_PREVOTE_DELTA}"; shift; fi ;;
            --configtoml-consensus-timeout-precommit)
                if [[ -n "$2" ]]; then configtoml_consensus_timeout_precommit="$2"; shift 2; else configtoml_consensus_timeout_precommit="${CONFIGTOML_CONSENSUS_TIMEOUT_PRECOMMIT}"; shift; fi ;;
            --configtoml-consensus-timeout-precommit-delta)
                if [[ -n "$2" ]]; then configtoml_consensus_timeout_precommit_delta="$2"; shift 2; else configtoml_consensus_timeout_precommit_delta="${CONFIGTOML_CONSENSUS_TIMEOUT_PRECOMMIT_DELTA}"; shift; fi ;;
            --configtoml-consensus-timeout-commit)
                if [[ -n "$2" ]]; then configtoml_consensus_timeout_commit="$2"; shift 2; else configtoml_consensus_timeout_commit="${CONFIGTOML_CONSENSUS_TIMEOUT_COMMIT}"; shift; fi ;;
            --configtoml-consensus-skip-timeout-commit)
                if [[ -n "$2" ]]; then configtoml_consensus_skip_timeout_commit="$2"; shift 2; else configtoml_consensus_skip_timeout_commit="${CONFIGTOML_CONSENSUS_SKIP_TIMEOUT_COMMIT}"; shift; fi ;;
            --configtoml-consensus-double-sign-check-height)
                if [[ -n "$2" ]]; then configtoml_consensus_double_sign_check_height="$2"; shift 2; else configtoml_consensus_double_sign_check_height="${CONFIGTOML_CONSENSUS_DOUBLE_SIGN_CHECK_HEIGHT}"; shift; fi ;;
            --configtoml-consensus-create-empty-blocks)
                if [[ -n "$2" ]]; then configtoml_consensus_create_empty_blocks="$2"; shift 2; else configtoml_consensus_create_empty_blocks="${CONFIGTOML_CONSENSUS_CREATE_EMPTY_BLOCKS}"; shift; fi ;;
            --configtoml-consensus-create-empty-blocks-interval)
                if [[ -n "$2" ]]; then configtoml_consensus_create_empty_blocks_interval="$2"; shift 2; else configtoml_consensus_create_empty_blocks_interval="${CONFIGTOML_CONSENSUS_CREATE_EMPTY_BLOCKS_INTERVAL}"; shift; fi ;;
            --configtoml-consensus-peer-gossip-sleep-duration)
                if [[ -n "$2" ]]; then configtoml_consensus_peer_gossip_sleep_duration="$2"; shift 2; else configtoml_consensus_peer_gossip_sleep_duration="${CONFIGTOML_CONSENSUS_PEER_GOSSIP_SLEEP_DURATION}"; shift; fi ;;
            --configtoml-consensus-peer-gossip-intraloop-sleep-duration)
                if [[ -n "$2" ]]; then configtoml_consensus_peer_gossip_intraloop_sleep_duration="$2"; shift 2; else configtoml_consensus_peer_gossip_intraloop_sleep_duration="${CONFIGTOML_CONSENSUS_PEER_GOSSIP_INTRALOOP_SLEEP_DURATION}"; shift; fi ;;
            --configtoml-consensus-peer-query-maj23-sleep-duration)
                if [[ -n "$2" ]]; then configtoml_consensus_peer_query_maj23_sleep_duration="$2"; shift 2; else configtoml_consensus_peer_query_maj23_sleep_duration="${CONFIGTOML_CONSENSUS_PEER_QUERY_MAJ23_SLEEP_DURATION}"; shift; fi ;;
            # - Storage Configuration
            --configtoml-storage-discard-abci-responses)
                if [[ -n "$2" ]]; then configtoml_storage_discard_abci_responses="$2"; shift 2; else configtoml_storage_discard_abci_responses="${CONFIGTOML_STORAGE_DISCARD_ABCI_RESPONSES}"; shift; fi ;;
            --configtoml-storage-experimental-db-key-layout)
                if [[ -n "$2" ]]; then configtoml_storage_experimental_db_key_layout="$2"; shift 2; else configtoml_storage_experimental_db_key_layout="${CONFIGTOML_STORAGE_EXPERIMENTAL_DB_KEY_LAYOUT}"; shift; fi ;;
            --configtoml-storage-compact)
                if [[ -n "$2" ]]; then configtoml_storage_compact="$2"; shift 2; else configtoml_storage_compact="${CONFIGTOML_STORAGE_COMPACT}"; shift; fi ;;
            --configtoml-storage-compaction-interval)
                if [[ -n "$2" ]]; then configtoml_storage_compaction_interval="$2"; shift 2; else configtoml_storage_compaction_interval="${CONFIGTOML_STORAGE_COMPACTION_INTERVAL}"; shift; fi ;;
            --configtoml-storage-pruning-interval)
                if [[ -n "$2" ]]; then configtoml_storage_pruning_interval="$2"; shift 2; else configtoml_storage_pruning_interval="${CONFIGTOML_STORAGE_PRUNING_INTERVAL}"; shift; fi ;;
            --configtoml-storage-pruning-data-companion-enabled)
                if [[ -n "$2" ]]; then configtoml_storage_pruning_data_companion_enabled="$2"; shift 2; else configtoml_storage_pruning_data_companion_enabled="${CONFIGTOML_STORAGE_PRUNING_DATA_COMPANION_ENABLED}"; shift; fi ;;
            --configtoml-storage-pruning-data-companion-initial-block-retain-height)
                if [[ -n "$2" ]]; then configtoml_storage_pruning_data_companion_initial_block_retain_height="$2"; shift 2; else configtoml_storage_pruning_data_companion_initial_block_retain_height="${CONFIGTOML_STORAGE_PRUNING_DATA_COMPANION_INITIAL_BLOCK_RETAIN_HEIGHT}"; shift; fi ;;
            --configtoml-storage-pruning-data-companion-initial-block-results-retain-height)
                if [[ -n "$2" ]]; then configtoml_storage_pruning_data_companion_initial_block_results_retain_height="$2"; shift 2; else configtoml_storage_pruning_data_companion_initial_block_results_retain_height="${CONFIGTOML_STORAGE_PRUNING_DATA_COMPANION_INITIAL_BLOCK_RESULTS_RETAIN_HEIGHT}"; shift; fi ;;
            # - Transaction Indexer Configuration
            --configtoml-tx-index-indexer)
                if [[ -n "$2" ]]; then configtoml_tx_index_indexer="$2"; shift 2; else configtoml_tx_index_indexer="${CONFIGTOML_TX_INDEX_INDEXER}"; shift; fi ;;
            --configtoml-tx-index-psql-conn)
                if [[ -n "$2" ]]; then configtoml_tx_index_psql_conn="$2"; shift 2; else configtoml_tx_index_psql_conn="${CONFIGTOML_TX_INDEX_PSQL_CONN}"; shift; fi ;;
            # - Instrumentation Configuration
            --configtoml-instrumentation-prometheus)
                if [[ -n "$2" ]]; then configtoml_instrumentation_prometheus="$2"; shift 2; else configtoml_instrumentation_prometheus="${CONFIGTOML_INSTRUMENTATION_PROMETHEUS}"; shift; fi ;;
            --configtoml-instrumentation-prometheus-listen-addr)
                if [[ -n "$2" ]]; then configtoml_instrumentation_prometheus_listen_addr="$2"; shift 2; else configtoml_instrumentation_prometheus_listen_addr="${CONFIGTOML_INSTRUMENTATION_PROMETHEUS_LISTEN_ADDR}"; shift; fi ;;
            --configtoml-instrumentation-max-open-connections)
                if [[ -n "$2" ]]; then configtoml_instrumentation_max_open_connections="$2"; shift 2; else configtoml_instrumentation_max_open_connections="${CONFIGTOML_INSTRUMENTATION_MAX_OPEN_CONNECTIONS}"; shift; fi ;;
            --configtoml-instrumentation-namespace)
                if [[ -n "$2" ]]; then configtoml_instrumentation_namespace="$2"; shift 2; else configtoml_instrumentation_namespace="${CONFIGTOML_INSTRUMENTATION_NAMESPACE}"; shift; fi ;;
            *)
                log_error "Unknown option: $1"
                show_init_help
                return 1
                ;;
        esac
    done

    # Overrides
    PORT_DEFINED_BY_NODE="<PORT_DEFINED_BY_NODE>"
    clienttoml_chain_id="${network}-beacon-${chain_id}"
    clienttoml_node="tcp://localhost:$PORT_DEFINED_BY_NODE"
    apptoml_beacon_kit_engine_rpc_dial_url="http://localhost:$PORT_DEFINED_BY_NODE"
    apptoml_beacon_kit_node_api_address="0.0.0.0:$PORT_DEFINED_BY_NODE"
    configtoml_proxy_app="tcp://127.0.0.1:$PORT_DEFINED_BY_NODE"
    configtoml_rpc_laddr="tcp://127.0.0.1:$PORT_DEFINED_BY_NODE"
    configtoml_p2p_laddr="tcp://0.0.0.0:$PORT_DEFINED_BY_NODE"
    configtoml_instrumentation_prometheus_listen_addr="$PORT_DEFINED_BY_NODE"
    configtoml_moniker="$moniker"

    # Check if validators is an integer > 0, else default to 1
    if ! [[ "$validators" =~ ^[0-9]+$ ]] || [[ "$validators" -le 0 ]]; then
        log_warn "validators is not a valid positive integer. defaulting to 1"
        validators=1
    fi

    total_nodes=$(( (${validators:-1} + ${full_nodes:-0} + ${pruned_nodes:-0}) ))
    # devnet defaults
    if [[ "${network}" == "${CHAIN_NAME_DEVNET}" ]]; then
        if [[ ${total_nodes} -eq 0 ]]; then
            total_nodes=$(( (${validators} + ${full_nodes} + ${pruned_nodes}) ))
            log_warn "total nodes is 0. defaulting to ${validators} validator, ${full_nodes} rpc full node, and ${pruned_nodes} rpc pruned node"
        fi
    fi
    # testnet defaults
    # TODO
    # mainnet defaults
    # TODO

    # Output configuration settings
    echo "========= Configuration Settings ========="
    echo "Moniker:         ${moniker:-<unset>}"
    echo "Network:         ${network:-<unset>}"
    echo "Validators:      ${validators}"
    echo "Full Nodes:      ${full_nodes}"
    echo "Pruned Nodes:    ${pruned_nodes}"
    echo "Total Nodes:     $total_nodes"
    echo "Beranode Dir:    ${BERANODES_PATH:-<unset>}"
    echo "Skip Genesis:    ${skip_genesis:-false}"
    echo "Force:           ${force:-false}"
    echo "Mode:            ${mode}"
    echo ""
    echo "========= Client Configuration =========="
    echo "Chain ID:                ${clienttoml_chain_id:-<unset>}"
    echo "Keyring Backend:         ${clienttoml_keyring_backend:-<unset>}"
    echo "Keyring Default Keyname: ${clienttoml_keyring_default_keyname:-<unset>}"
    echo "Output:                  ${clienttoml_output:-<unset>}"
    echo "Node:                    ${clienttoml_node:-<unset>}"
    echo "Broadcast Mode:          ${clienttoml_broadcast_mode:-<unset>}"
    echo "gRPC Address:            ${clienttoml_grpc_address:-<unset>}"
    echo "gRPC Insecure:           ${clienttoml_grpc_insecure:-<unset>}"
    echo "=========================================="
    echo ""
    echo "========= App.toml Configuration ========"
    echo "Pruning:                 ${apptoml_pruning:-<unset>}"
    echo "IAVL Cache Size:         ${apptoml_iavl_cache_size:-<unset>}"
    echo "App DB Backend:          ${apptoml_app_db_backend:-<unset>}"
    echo "Telemetry Enabled:       ${apptoml_telemetry_enabled:-<unset>}"
    echo "Chain Spec:              ${apptoml_beacon_kit_chain_spec:-<unset>}"
    echo "Engine RPC Dial URL:     ${apptoml_beacon_kit_engine_rpc_dial_url:-<unset>}"
    echo "JWT Secret Path:         ${apptoml_beacon_kit_engine_jwt_secret_path:-<unset>}"
    echo "Logger Level:            ${apptoml_beacon_kit_logger_log_level:-<unset>}"
    echo "Payload Builder Enabled: ${apptoml_beacon_kit_payload_builder_enabled:-<unset>}"
    echo "Node API Enabled:        ${apptoml_beacon_kit_node_api_enabled:-<unset>}"
    echo "=========================================="
    echo ""
    echo "========= Config.toml Configuration ====="
    echo "Moniker:                 ${configtoml_moniker:-<unset>}"
    echo "DB Backend:              ${configtoml_db_backend:-<unset>}"
    echo "Log Level:               ${configtoml_log_level:-<unset>}"
    echo "RPC Laddr:               ${configtoml_rpc_laddr:-<unset>}"
    echo "P2P Laddr:               ${configtoml_p2p_laddr:-<unset>}"
    echo "Mempool Type:            ${configtoml_mempool_type:-<unset>}"
    echo "Consensus Timeout:       ${configtoml_consensus_timeout_propose:-<unset>}"
    echo "Prometheus:              ${configtoml_instrumentation_prometheus:-<unset>}"
    echo "=========================================="

    # Ensure all required directories exist
    ensure_dir_exists "${BERANODES_PATH}"                          "beranode directory"              || return 1
    ensure_dir_exists "${BERANODES_PATH}${BERANODES_PATH_BIN}"     "beranode binary directory"       || return 1
    ensure_dir_exists "${BERANODES_PATH}${BERANODES_PATH_TMP}"     "beranode temporary directory"    || return 1
    ensure_dir_exists "${BERANODES_PATH}${BERANODES_PATH_LOG}"     "beranode log directory"          || return 1
    ensure_dir_exists "${BERANODES_PATH}${BERANODES_PATH_NODES}"   "beranode nodes directory"        || return 1

    # Check if the required binaries exist in the bin directory
    missing_binaries=0
    # - beacond
    if [[ ! -x "${BERANODES_PATH}${BERANODES_PATH_BIN}/${BIN_BEACONKIT}" ]]; then
        log_error "Binary '${BIN_BEACONKIT}' not found or not executable: ${BERANODES_PATH}${BERANODES_PATH_BIN}/${BIN_BEACONKIT}"
        missing_binaries=1
    else
      # Check if 'beacond version' command executes successfully
      beacon_version="$("${BERANODES_PATH}${BERANODES_PATH_BIN}/${BIN_BEACONKIT}" version 2>/dev/null)"
      if [[ $? -eq 0 ]]; then
          log_success "'${BIN_BEACONKIT} version' works as expected."
          log_info "${BIN_BEACONKIT} version:\n${beacon_version}\n"
      else
          log_error "'${BIN_BEACONKIT} version' did not work as expected."
      fi
    fi

    # - berareth
    if [[ ! -x "${BERANODES_PATH}${BERANODES_PATH_BIN}/${BIN_BERARETH}" ]]; then
        log_error "Binary '${BIN_BERARETH}' not found or not executable: ${BERANODES_PATH}${BERANODES_PATH_BIN}/${BIN_BERARETH}"
        missing_binaries=1
    else
      # Check if 'berareth version' command executes successfully
      bera_reth_version="$("${BERANODES_PATH}${BERANODES_PATH_BIN}/${BIN_BERARETH}" --version 2>/dev/null)"
      if [[ $? -eq 0 ]]; then
          log_success "'${BIN_BERARETH} --version' works as expected."
          log_info "${BIN_BERARETH} version:\n${bera_reth_version}\n"
      else
          log_error "'${BIN_BERARETH} --version' did not work as expected."
      fi
    fi
    if [[ $missing_binaries -ge 1 ]]; then
        log_error "Some required binaries are missing.\nPlease install them manually and place them in the 'beranodes/bin' directory.\n(Auto-installing coming soon!)"
        return 1
    fi

    wallet_private_key=$(generate_evm_private_key)
    if [[ $? -eq 0 ]]; then
        log_success "Wallet private key generated:\n${wallet_private_key}"
      else
        log_error "Failed to generate wallet private key."
        return 1
    fi
    wallet_address=$(get_evm_address_from_private_key "${wallet_private_key}")
    if [[ $? -eq 0 ]]; then
        log_success "Wallet address generated:\n${wallet_address}"
    else
        log_error "Failed to generate wallet address."
        return 1
    fi

    print_header "Creating Beranode Configuration"

    # Create beranodes.config.json with settings as JSON
    config_json_path="${BERANODES_PATH}/beranodes.config.json"
    # Check if the configuration file already exists, and don't overwrite it
    local_config_exists=false
    if [[ -f "${config_json_path}" ]]; then
        log_warn "Configuration already exists at ${config_json_path}. Will not overwrite."
        local_config_exists=true
        # Prompt the user to overwrite or use the existing config
        while true; do
            echo -e "${YELLOW}A configuration file already exists at ${config_json_path}.${RESET}"
            read -p "Do you want to overwrite it? [y/n]: " yn
            case "$yn" in
                [Yy]* )
                    log_warn "Overwriting existing configuration file at ${config_json_path}."
                    rm -f "${config_json_path}"
                    log_info "Previous configuration file removed."
                    local_config_exists=false
                    break
                    ;;
                [Nn]* | "" )
                    log_success "Using existing configuration file at ${config_json_path}."
                    break
                    ;;
                * )
                    echo "Please answer yes (y) or no (n)."
                    ;;
            esac
        done
    fi

    if [[ "${local_config_exists}" = false ]]; then
        log_info "Creating new configuration file: ${config_json_path}"

        nodes_validators=""
        node_ethrpc_port=${DEFAULT_CL_ETHRPC_PORT}
        node_ethp2p_port=${DEFAULT_CL_ETHP2P_PORT}
        node_ethproxy_port=${DEFAULT_CL_ETHPROXY_PORT}
        node_el_ethrpc_port=${DEFAULT_EL_ETHRPC_PORT}
        node_el_authrpc_port=${DEFAULT_EL_AUTHRPC_PORT}
        node_el_eth_port=${DEFAULT_DEFAULT_EL_ETH_PORT}
        node_el_prometheus_port=${DEFAULT_EL_PROMETHEUS_PORT}
        node_cl_prometheus_port=${DEFAULT_CL_PROMETHEUS_PORT}
        node_port_increment=${DEFAULT_PORT_INCREMENT}

        current_node_ethrpc_port=${node_ethrpc_port}
        current_node_ethp2p_port=${node_ethp2p_port}
        current_node_ethproxy_port=${node_ethproxy_port}
        current_node_el_ethrpc_port=${node_el_ethrpc_port}
        current_node_el_authrpc_port=${node_el_authrpc_port}
        current_node_el_eth_port=${node_el_eth_port}
        current_node_el_prometheus_port=${node_el_prometheus_port}
        current_node_cl_prometheus_port=${node_cl_prometheus_port}

        if [[ ${validators} -gt 0 ]]; then
          for i in $(seq 1 ${validators}); do
              if [[ $i -eq ${validators} ]]; then
                  nodes_validators="${nodes_validators}{\"role\": \"validator\", \"moniker\": \"${moniker}-val-$(($i-1))\", \"network\": \"${network}\", \"wallet_address\": \"${evm_address}\", \"ethrpc_port\": ${current_node_ethrpc_port}, \"ethp2p_port\": ${current_node_ethp2p_port}, \"ethproxy_port\": ${current_node_ethproxy_port}, \"el_ethrpc_port\": ${current_node_el_ethrpc_port}, \"el_authrpc_port\": ${current_node_el_authrpc_port}, \"el_eth_port\": ${current_node_el_eth_port}, \"el_prometheus_port\": ${current_node_el_prometheus_port}, \"cl_prometheus_port\": ${current_node_cl_prometheus_port}}"
              else
                  nodes_validators="${nodes_validators}{\"role\": \"validator\", \"moniker\": \"${moniker}-val-$(($i-1))\", \"network\": \"${network}\", \"wallet_address\": \"${evm_address}\", \"ethrpc_port\": ${current_node_ethrpc_port}, \"ethp2p_port\": ${current_node_ethp2p_port}, \"ethproxy_port\": ${current_node_ethproxy_port}, \"el_ethrpc_port\": ${current_node_el_ethrpc_port}, \"el_authrpc_port\": ${current_node_el_authrpc_port}, \"el_eth_port\": ${current_node_el_eth_port}, \"el_prometheus_port\": ${current_node_el_prometheus_port}, \"cl_prometheus_port\": ${current_node_cl_prometheus_port}},"
              fi

              current_node_ethrpc_port=$((current_node_ethrpc_port + node_port_increment))
              current_node_ethp2p_port=$((current_node_ethp2p_port + node_port_increment))
              current_node_ethproxy_port=$((current_node_ethproxy_port + node_port_increment))
              current_node_el_ethrpc_port=$((current_node_el_ethrpc_port + node_port_increment))
              current_node_el_authrpc_port=$((current_node_el_authrpc_port + node_port_increment))
              current_node_el_eth_port=$((current_node_el_eth_port + node_port_increment))
              current_node_el_prometheus_port=$((current_node_el_prometheus_port + node_port_increment))
              current_node_cl_prometheus_port=$((current_node_cl_prometheus_port + node_port_increment))
          done
        fi

        nodes_full_nodes=""
        if [[ ${full_nodes} -gt 0 ]]; then
          for i in $(seq 1 ${full_nodes}); do
              if [[ $i -eq ${full_nodes} ]]; then
                  nodes_full_nodes="${nodes_full_nodes}{\"role\": \"rpc_full\", \"moniker\": \"${moniker}-rpc-full-$(($i-1))\", \"network\": \"${network}\", \"wallet_address\": \"${evm_address}\", \"ethrpc_port\": ${current_node_ethrpc_port}, \"ethp2p_port\": ${current_node_ethp2p_port}, \"ethproxy_port\": ${current_node_ethproxy_port}, \"el_ethrpc_port\": ${current_node_el_ethrpc_port}, \"el_authrpc_port\": ${current_node_el_authrpc_port}, \"el_eth_port\": ${current_node_el_eth_port}, \"el_prometheus_port\": ${current_node_el_prometheus_port}, \"cl_prometheus_port\": ${current_node_cl_prometheus_port}}"
              else
                  nodes_full_nodes="${nodes_full_nodes}{\"role\": \"rpc_full\", \"moniker\": \"${moniker}-rpc-full-$(($i-1))\", \"network\": \"${network}\", \"wallet_address\": \"${evm_address}\", \"ethrpc_port\": ${current_node_ethrpc_port}, \"ethp2p_port\": ${current_node_ethp2p_port}, \"ethproxy_port\": ${current_node_ethproxy_port}, \"el_ethrpc_port\": ${current_node_el_ethrpc_port}, \"el_authrpc_port\": ${current_node_el_authrpc_port}, \"el_eth_port\": ${current_node_el_eth_port}, \"el_prometheus_port\": ${current_node_el_prometheus_port}, \"cl_prometheus_port\": ${current_node_cl_prometheus_port}},"
              fi
              current_node_ethrpc_port=$((current_node_ethrpc_port + node_port_increment))
              current_node_ethp2p_port=$((current_node_ethp2p_port + node_port_increment))
              current_node_ethproxy_port=$((current_node_ethproxy_port + node_port_increment))
              current_node_el_ethrpc_port=$((current_node_el_ethrpc_port + node_port_increment))
              current_node_el_authrpc_port=$((current_node_el_authrpc_port + node_port_increment))
              current_node_el_eth_port=$((current_node_el_eth_port + node_port_increment))
              current_node_el_prometheus_port=$((current_node_el_prometheus_port + node_port_increment))
              current_node_cl_prometheus_port=$((current_node_cl_prometheus_port + node_port_increment))
          done
        fi

        nodes_pruned_nodes=""
        if [[ ${pruned_nodes} -gt 0 ]]; then
          for i in $(seq 1 ${pruned_nodes}); do
              if [[ $i -eq ${pruned_nodes} ]]; then
                  nodes_pruned_nodes="${nodes_pruned_nodes}{\"role\": \"rpc-pruned\", \"moniker\": \"${moniker}-rpc-pruned-$(($i-1))\", \"network\": \"${network}\", \"wallet_address\": \"${evm_address}\", \"ethrpc_port\": ${current_node_ethrpc_port}, \"ethp2p_port\": ${current_node_ethp2p_port}, \"ethproxy_port\": ${current_node_ethproxy_port}, \"el_ethrpc_port\": ${current_node_el_ethrpc_port}, \"el_authrpc_port\": ${current_node_el_authrpc_port}, \"el_eth_port\": ${current_node_el_eth_port}, \"el_prometheus_port\": ${current_node_el_prometheus_port}, \"cl_prometheus_port\": ${current_node_cl_prometheus_port}}"
              else
                  nodes_pruned_nodes="${nodes_pruned_nodes}{\"role\": \"rpc-pruned\", \"moniker\": \"${moniker}-rpc-pruned-$(($i-1))\", \"network\": \"${network}\", \"wallet_address\": \"${evm_address}\", \"ethrpc_port\": ${current_node_ethrpc_port}, \"ethp2p_port\": ${current_node_ethp2p_port}, \"ethproxy_port\": ${current_node_ethproxy_port}, \"el_ethrpc_port\": ${current_node_el_ethrpc_port}, \"el_authrpc_port\": ${current_node_el_authrpc_port}, \"el_eth_port\": ${current_node_el_eth_port}, \"el_prometheus_port\": ${current_node_el_prometheus_port}, \"cl_prometheus_port\": ${current_node_cl_prometheus_port}},"
              fi
              current_node_ethrpc_port=$((current_node_ethrpc_port + node_port_increment))
              current_node_ethp2p_port=$((current_node_ethp2p_port + node_port_increment))
              current_node_ethproxy_port=$((current_node_ethproxy_port + node_port_increment))
              current_node_el_ethrpc_port=$((current_node_el_ethrpc_port + node_port_increment))
              current_node_el_authrpc_port=$((current_node_el_authrpc_port + node_port_increment))
              current_node_el_eth_port=$((current_node_el_eth_port + node_port_increment))
              current_node_el_prometheus_port=$((current_node_el_prometheus_port + node_port_increment))
              current_node_cl_prometheus_port=$((current_node_cl_prometheus_port + node_port_increment))
          done
        fi

        # Combine all defined node groups into a properly formatted JSON nodes array.
        nodes_combined=""

        # Prepare a list of all potential node groups. Add new ones here if needed.
        all_groups=( "$nodes_validators" "$nodes_full_nodes" "$nodes_pruned_nodes" )
        for group in "${all_groups[@]}"; do
            if [[ -n "$group" ]]; then
                if [[ -z "$nodes_combined" ]]; then
                    nodes_combined="$group"
                else
                    nodes_combined="${nodes_combined},${group}"
                fi
            fi
        done

        # jq -n \
        #   --arg moniker "$moniker" \
        #   --arg network "$network" \
        #   --argjson validators "$validators" \
        #   --argjson full_nodes "$full_nodes" \
        #   --argjson pruned_nodes "$pruned_nodes" \
        #   --argjson total_nodes "$total_nodes" \
        #   --arg beranode_dir "$BERANODES_PATH" \
        #   --argjson skip_genesis "$skip_genesis" \
        #   --argjson force "$force" \
        #   --arg mode "$mode" \
        #   --arg wallet_private_key "$wallet_private_key" \
        #   --arg wallet_address "$wallet_address" \
        #   --arg wallet_balance "$wallet_balance" \
        #   --argjson nodes "$(echo "[${nodes_combined}]" | jq .)" \
        #   --arg clienttoml_chain_id "$clienttoml_chain_id" \
        #   --arg clienttoml_keyring_backend "$clienttoml_keyring_backend" \
        #   --arg clienttoml_keyring_default_keyname "$clienttoml_keyring_default_keyname" \
        #   --arg clienttoml_output "$clienttoml_output" \
        #   --arg clienttoml_node "$clienttoml_node" \
        #   --arg clienttoml_broadcast_mode "$clienttoml_broadcast_mode" \
        #   --arg clienttoml_grpc_address "$clienttoml_grpc_address" \
        #   --arg clienttoml_grpc_insecure "$clienttoml_grpc_insecure" \
        #   '{
        #     moniker: $moniker,
        #     network: $network,
        #     validators: $validators,
        #     full_nodes: $full_nodes,
        #     pruned_nodes: $pruned_nodes,
        #     total_nodes: $total_nodes,
        #     beranode_dir: $beranode_dir,
        #     skip_genesis: $skip_genesis,
        #     force: $force,
        #     mode: $mode,
        #     wallet_private_key: $wallet_private_key,
        #     wallet_address: $wallet_address,
        #     wallet_balance: $wallet_balance,
        #     nodes: $nodes,
        #     clienttoml_chain_id: $clienttoml_chain_id,
        #     clienttoml_keyring_backend: $clienttoml_keyring_backend,
        #     clienttoml_keyring_default_keyname: $clienttoml_keyring_default_keyname,
        #     clienttoml_output: $clienttoml_output,
        #     clienttoml_node: $clienttoml_node,
        #     clienttoml_broadcast_mode: $clienttoml_broadcast_mode,
        #     clienttoml_grpc_address: $clienttoml_grpc_address,
        #     clienttoml_grpc_insecure: $clienttoml_grpc_insecure
        #   }' > "${config_json_path}"

        jq -n \
          --arg moniker "$moniker" \
          --arg network "$network" \
          --argjson validators "$validators" \
          --argjson full_nodes "$full_nodes" \
          --argjson pruned_nodes "$pruned_nodes" \
          --argjson total_nodes "$total_nodes" \
          --arg beranode_dir "$BERANODES_PATH" \
          --argjson skip_genesis "$skip_genesis" \
          --argjson force "$force" \
          --arg mode "$mode" \
          --arg wallet_private_key "$wallet_private_key" \
          --arg wallet_address "$wallet_address" \
          --arg wallet_balance "$wallet_balance" \
          --argjson nodes "$(echo "[${nodes_combined}]" | jq .)" \
          --arg clienttoml_chain_id "$clienttoml_chain_id" \
          --arg clienttoml_keyring_backend "$clienttoml_keyring_backend" \
          --arg clienttoml_keyring_default_keyname "$clienttoml_keyring_default_keyname" \
          --arg clienttoml_output "$clienttoml_output" \
          --arg clienttoml_node "$clienttoml_node" \
          --arg clienttoml_broadcast_mode "$clienttoml_broadcast_mode" \
          --arg clienttoml_grpc_address "$clienttoml_grpc_address" \
          --arg clienttoml_grpc_insecure "$clienttoml_grpc_insecure" \
          --arg apptoml_pruning "$apptoml_pruning" \
          --arg apptoml_pruning_keep_recent "$apptoml_pruning_keep_recent" \
          --arg apptoml_pruning_interval "$apptoml_pruning_interval" \
          --arg apptoml_halt_height "$apptoml_halt_height" \
          --arg apptoml_halt_time "$apptoml_halt_time" \
          --arg apptoml_min_retain_blocks "$apptoml_min_retain_blocks" \
          --arg apptoml_inter_block_cache "$apptoml_inter_block_cache" \
          --arg apptoml_iavl_cache_size "$apptoml_iavl_cache_size" \
          --arg apptoml_iavl_disable_fastnode "$apptoml_iavl_disable_fastnode" \
          --arg apptoml_app_db_backend "$apptoml_app_db_backend" \
          --arg apptoml_telemetry_service_name "$apptoml_telemetry_service_name" \
          --arg apptoml_telemetry_enabled "$apptoml_telemetry_enabled" \
          --arg apptoml_telemetry_enable_hostname "$apptoml_telemetry_enable_hostname" \
          --arg apptoml_telemetry_enable_hostname_label "$apptoml_telemetry_enable_hostname_label" \
          --arg apptoml_telemetry_enable_service_label "$apptoml_telemetry_enable_service_label" \
          --arg apptoml_telemetry_prometheus_retention_time "$apptoml_telemetry_prometheus_retention_time" \
          --arg apptoml_telemetry_global_labels "$apptoml_telemetry_global_labels" \
          --arg apptoml_telemetry_metrics_sink "$apptoml_telemetry_metrics_sink" \
          --arg apptoml_telemetry_statsd_addr "$apptoml_telemetry_statsd_addr" \
          --arg apptoml_telemetry_datadog_hostname "$apptoml_telemetry_datadog_hostname" \
          --arg apptoml_beacon_kit_chain_spec "$apptoml_beacon_kit_chain_spec" \
          --arg apptoml_beacon_kit_chain_spec_file "$apptoml_beacon_kit_chain_spec_file" \
          --arg apptoml_beacon_kit_shutdown_timeout "$apptoml_beacon_kit_shutdown_timeout" \
          --arg apptoml_beacon_kit_engine_rpc_dial_url "$apptoml_beacon_kit_engine_rpc_dial_url" \
          --arg apptoml_beacon_kit_engine_rpc_timeout "$apptoml_beacon_kit_engine_rpc_timeout" \
          --arg apptoml_beacon_kit_engine_rpc_retry_interval "$apptoml_beacon_kit_engine_rpc_retry_interval" \
          --arg apptoml_beacon_kit_engine_rpc_max_retry_interval "$apptoml_beacon_kit_engine_rpc_max_retry_interval" \
          --arg apptoml_beacon_kit_engine_rpc_startup_check_interval "$apptoml_beacon_kit_engine_rpc_startup_check_interval" \
          --arg apptoml_beacon_kit_engine_rpc_jwt_refresh_interval "$apptoml_beacon_kit_engine_rpc_jwt_refresh_interval" \
          --arg apptoml_beacon_kit_engine_jwt_secret_path "$apptoml_beacon_kit_engine_jwt_secret_path" \
          --arg apptoml_beacon_kit_logger_time_format "$apptoml_beacon_kit_logger_time_format" \
          --arg apptoml_beacon_kit_logger_log_level "$apptoml_beacon_kit_logger_log_level" \
          --arg apptoml_beacon_kit_logger_style "$apptoml_beacon_kit_logger_style" \
          --arg apptoml_beacon_kit_kzg_trusted_setup_path "$apptoml_beacon_kit_kzg_trusted_setup_path" \
          --arg apptoml_beacon_kit_kzg_implementation "$apptoml_beacon_kit_kzg_implementation" \
          --arg apptoml_beacon_kit_payload_builder_enabled "$apptoml_beacon_kit_payload_builder_enabled" \
          --arg apptoml_beacon_kit_payload_builder_suggested_fee_recipient "$apptoml_beacon_kit_payload_builder_suggested_fee_recipient" \
          --arg apptoml_beacon_kit_payload_builder_payload_timeout "$apptoml_beacon_kit_payload_builder_payload_timeout" \
          --arg apptoml_beacon_kit_validator_graffiti "$apptoml_beacon_kit_validator_graffiti" \
          --arg apptoml_beacon_kit_validator_availability_window "$apptoml_beacon_kit_validator_availability_window" \
          --arg apptoml_beacon_kit_node_api_enabled "$apptoml_beacon_kit_node_api_enabled" \
          --arg apptoml_beacon_kit_node_api_address "$apptoml_beacon_kit_node_api_address" \
          --arg apptoml_beacon_kit_node_api_logging "$apptoml_beacon_kit_node_api_logging" \
          --arg configtoml_version "$configtoml_version" \
          --arg configtoml_proxy_app "$configtoml_proxy_app" \
          --arg configtoml_moniker "$configtoml_moniker" \
          --arg configtoml_db_backend "$configtoml_db_backend" \
          --arg configtoml_db_dir "$configtoml_db_dir" \
          --arg configtoml_log_level "$configtoml_log_level" \
          --arg configtoml_log_format "$configtoml_log_format" \
          --arg configtoml_genesis_file "$configtoml_genesis_file" \
          --arg configtoml_priv_validator_key_file "$configtoml_priv_validator_key_file" \
          --arg configtoml_priv_validator_state_file "$configtoml_priv_validator_state_file" \
          --arg configtoml_priv_validator_laddr "$configtoml_priv_validator_laddr" \
          --arg configtoml_node_key_file "$configtoml_node_key_file" \
          --arg configtoml_abci "$configtoml_abci" \
          --arg configtoml_filter_peers "$configtoml_filter_peers" \
          --arg configtoml_rpc_laddr "$configtoml_rpc_laddr" \
          --arg configtoml_rpc_unsafe "$configtoml_rpc_unsafe" \
          --arg configtoml_rpc_cors_allowed_origins "$configtoml_rpc_cors_allowed_origins" \
          --arg configtoml_rpc_cors_allowed_methods "$configtoml_rpc_cors_allowed_methods" \
          --arg configtoml_rpc_cors_allowed_headers "$configtoml_rpc_cors_allowed_headers" \
          --arg configtoml_rpc_max_open_connections "$configtoml_rpc_max_open_connections" \
          --arg configtoml_rpc_max_subscription_clients "$configtoml_rpc_max_subscription_clients" \
          --arg configtoml_rpc_max_subscriptions_per_client "$configtoml_rpc_max_subscriptions_per_client" \
          --arg configtoml_rpc_experimental_subscription_buffer_size "$configtoml_rpc_experimental_subscription_buffer_size" \
          --arg configtoml_rpc_experimental_websocket_write_buffer_size "$configtoml_rpc_experimental_websocket_write_buffer_size" \
          --arg configtoml_rpc_experimental_close_on_slow_client "$configtoml_rpc_experimental_close_on_slow_client" \
          --arg configtoml_rpc_timeout_broadcast_tx_commit "$configtoml_rpc_timeout_broadcast_tx_commit" \
          --arg configtoml_rpc_max_request_batch_size "$configtoml_rpc_max_request_batch_size" \
          --arg configtoml_rpc_max_body_bytes "$configtoml_rpc_max_body_bytes" \
          --arg configtoml_rpc_max_header_bytes "$configtoml_rpc_max_header_bytes" \
          --arg configtoml_rpc_tls_cert_file "$configtoml_rpc_tls_cert_file" \
          --arg configtoml_rpc_tls_key_file "$configtoml_rpc_tls_key_file" \
          --arg configtoml_rpc_pprof_laddr "$configtoml_rpc_pprof_laddr" \
          --arg configtoml_grpc_laddr "$configtoml_grpc_laddr" \
          --arg configtoml_grpc_version_service_enabled "$configtoml_grpc_version_service_enabled" \
          --arg configtoml_grpc_block_service_enabled "$configtoml_grpc_block_service_enabled" \
          --arg configtoml_grpc_block_results_service_enabled "$configtoml_grpc_block_results_service_enabled" \
          --arg configtoml_grpc_privileged_laddr "$configtoml_grpc_privileged_laddr" \
          --arg configtoml_grpc_privileged_pruning_service_enabled "$configtoml_grpc_privileged_pruning_service_enabled" \
          --arg configtoml_p2p_laddr "$configtoml_p2p_laddr" \
          --arg configtoml_p2p_external_address "$configtoml_p2p_external_address" \
          --arg configtoml_p2p_seeds "$configtoml_p2p_seeds" \
          --arg configtoml_p2p_persistent_peers "$configtoml_p2p_persistent_peers" \
          --arg configtoml_p2p_addr_book_file "$configtoml_p2p_addr_book_file" \
          --arg configtoml_p2p_addr_book_strict "$configtoml_p2p_addr_book_strict" \
          --arg configtoml_p2p_max_num_inbound_peers "$configtoml_p2p_max_num_inbound_peers" \
          --arg configtoml_p2p_max_num_outbound_peers "$configtoml_p2p_max_num_outbound_peers" \
          --arg configtoml_p2p_unconditional_peer_ids "$configtoml_p2p_unconditional_peer_ids" \
          --arg configtoml_p2p_persistent_peers_max_dial_period "$configtoml_p2p_persistent_peers_max_dial_period" \
          --arg configtoml_p2p_flush_throttle_timeout "$configtoml_p2p_flush_throttle_timeout" \
          --arg configtoml_p2p_max_packet_msg_payload_size "$configtoml_p2p_max_packet_msg_payload_size" \
          --arg configtoml_p2p_send_rate "$configtoml_p2p_send_rate" \
          --arg configtoml_p2p_recv_rate "$configtoml_p2p_recv_rate" \
          --arg configtoml_p2p_pex "$configtoml_p2p_pex" \
          --arg configtoml_p2p_seed_mode "$configtoml_p2p_seed_mode" \
          --arg configtoml_p2p_private_peer_ids "$configtoml_p2p_private_peer_ids" \
          --arg configtoml_p2p_allow_duplicate_ip "$configtoml_p2p_allow_duplicate_ip" \
          --arg configtoml_p2p_handshake_timeout "$configtoml_p2p_handshake_timeout" \
          --arg configtoml_p2p_dial_timeout "$configtoml_p2p_dial_timeout" \
          --arg configtoml_mempool_type "$configtoml_mempool_type" \
          --arg configtoml_mempool_recheck "$configtoml_mempool_recheck" \
          --arg configtoml_mempool_recheck_timeout "$configtoml_mempool_recheck_timeout" \
          --arg configtoml_mempool_broadcast "$configtoml_mempool_broadcast" \
          --arg configtoml_mempool_wal_dir "$configtoml_mempool_wal_dir" \
          --arg configtoml_mempool_size "$configtoml_mempool_size" \
          --arg configtoml_mempool_max_tx_bytes "$configtoml_mempool_max_tx_bytes" \
          --arg configtoml_mempool_max_txs_bytes "$configtoml_mempool_max_txs_bytes" \
          --arg configtoml_mempool_cache_size "$configtoml_mempool_cache_size" \
          --arg configtoml_mempool_keep_invalid_txs_in_cache "$configtoml_mempool_keep_invalid_txs_in_cache" \
          --arg configtoml_mempool_experimental_max_gossip_connections_to_persistent_peers "$configtoml_mempool_experimental_max_gossip_connections_to_persistent_peers" \
          --arg configtoml_mempool_experimental_max_gossip_connections_to_non_persistent_peers "$configtoml_mempool_experimental_max_gossip_connections_to_non_persistent_peers" \
          --arg configtoml_statesync_enable "$configtoml_statesync_enable" \
          --arg configtoml_statesync_rpc_servers "$configtoml_statesync_rpc_servers" \
          --arg configtoml_statesync_trust_height "$configtoml_statesync_trust_height" \
          --arg configtoml_statesync_trust_hash "$configtoml_statesync_trust_hash" \
          --arg configtoml_statesync_trust_period "$configtoml_statesync_trust_period" \
          --arg configtoml_statesync_discovery_time "$configtoml_statesync_discovery_time" \
          --arg configtoml_statesync_temp_dir "$configtoml_statesync_temp_dir" \
          --arg configtoml_statesync_chunk_request_timeout "$configtoml_statesync_chunk_request_timeout" \
          --arg configtoml_statesync_chunk_fetchers "$configtoml_statesync_chunk_fetchers" \
          --arg configtoml_blocksync_version "$configtoml_blocksync_version" \
          --arg configtoml_consensus_wal_file "$configtoml_consensus_wal_file" \
          --arg configtoml_consensus_timeout_propose "$configtoml_consensus_timeout_propose" \
          --arg configtoml_consensus_timeout_propose_delta "$configtoml_consensus_timeout_propose_delta" \
          --arg configtoml_consensus_timeout_prevote "$configtoml_consensus_timeout_prevote" \
          --arg configtoml_consensus_timeout_prevote_delta "$configtoml_consensus_timeout_prevote_delta" \
          --arg configtoml_consensus_timeout_precommit "$configtoml_consensus_timeout_precommit" \
          --arg configtoml_consensus_timeout_precommit_delta "$configtoml_consensus_timeout_precommit_delta" \
          --arg configtoml_consensus_timeout_commit "$configtoml_consensus_timeout_commit" \
          --arg configtoml_consensus_skip_timeout_commit "$configtoml_consensus_skip_timeout_commit" \
          --arg configtoml_consensus_double_sign_check_height "$configtoml_consensus_double_sign_check_height" \
          --arg configtoml_consensus_create_empty_blocks "$configtoml_consensus_create_empty_blocks" \
          --arg configtoml_consensus_create_empty_blocks_interval "$configtoml_consensus_create_empty_blocks_interval" \
          --arg configtoml_consensus_peer_gossip_sleep_duration "$configtoml_consensus_peer_gossip_sleep_duration" \
          --arg configtoml_consensus_peer_gossip_intraloop_sleep_duration "$configtoml_consensus_peer_gossip_intraloop_sleep_duration" \
          --arg configtoml_consensus_peer_query_maj23_sleep_duration "$configtoml_consensus_peer_query_maj23_sleep_duration" \
          --arg configtoml_storage_discard_abci_responses "$configtoml_storage_discard_abci_responses" \
          --arg configtoml_storage_experimental_db_key_layout "$configtoml_storage_experimental_db_key_layout" \
          --arg configtoml_storage_compact "$configtoml_storage_compact" \
          --arg configtoml_storage_compaction_interval "$configtoml_storage_compaction_interval" \
          --arg configtoml_storage_pruning_interval "$configtoml_storage_pruning_interval" \
          --arg configtoml_storage_pruning_data_companion_enabled "$configtoml_storage_pruning_data_companion_enabled" \
          --arg configtoml_storage_pruning_data_companion_initial_block_retain_height "$configtoml_storage_pruning_data_companion_initial_block_retain_height" \
          --arg configtoml_storage_pruning_data_companion_initial_block_results_retain_height "$configtoml_storage_pruning_data_companion_initial_block_results_retain_height" \
          --arg configtoml_tx_index_indexer "$configtoml_tx_index_indexer" \
          --arg configtoml_tx_index_psql_conn "$configtoml_tx_index_psql_conn" \
          --arg configtoml_instrumentation_prometheus "$configtoml_instrumentation_prometheus" \
          --arg configtoml_instrumentation_prometheus_listen_addr "$configtoml_instrumentation_prometheus_listen_addr" \
          --arg configtoml_instrumentation_max_open_connections "$configtoml_instrumentation_max_open_connections" \
          --arg configtoml_instrumentation_namespace "$configtoml_instrumentation_namespace" \
          '{
            moniker: $moniker,
            network: $network,
            validators: $validators,
            full_nodes: $full_nodes,
            pruned_nodes: $pruned_nodes,
            total_nodes: $total_nodes,
            beranode_dir: $beranode_dir,
            skip_genesis: $skip_genesis,
            force: $force,
            mode: $mode,
            wallet_private_key: $wallet_private_key,
            wallet_address: $wallet_address,
            wallet_balance: $wallet_balance,
            nodes: $nodes,
            clienttoml_chain_id: $clienttoml_chain_id,
            clienttoml_keyring_backend: $clienttoml_keyring_backend,
            clienttoml_keyring_default_keyname: $clienttoml_keyring_default_keyname,
            clienttoml_output: $clienttoml_output,
            clienttoml_node: $clienttoml_node,
            clienttoml_broadcast_mode: $clienttoml_broadcast_mode,
            clienttoml_grpc_address: $clienttoml_grpc_address,
            clienttoml_grpc_insecure: $clienttoml_grpc_insecure,
            apptoml_pruning: $apptoml_pruning,
            apptoml_pruning_keep_recent: $apptoml_pruning_keep_recent,
            apptoml_pruning_interval: $apptoml_pruning_interval,
            apptoml_halt_height: $apptoml_halt_height,
            apptoml_halt_time: $apptoml_halt_time,
            apptoml_min_retain_blocks: $apptoml_min_retain_blocks,
            apptoml_inter_block_cache: $apptoml_inter_block_cache,
            apptoml_iavl_cache_size: $apptoml_iavl_cache_size,
            apptoml_iavl_disable_fastnode: $apptoml_iavl_disable_fastnode,
            apptoml_app_db_backend: $apptoml_app_db_backend,
            apptoml_telemetry_service_name: $apptoml_telemetry_service_name,
            apptoml_telemetry_enabled: $apptoml_telemetry_enabled,
            apptoml_telemetry_enable_hostname: $apptoml_telemetry_enable_hostname,
            apptoml_telemetry_enable_hostname_label: $apptoml_telemetry_enable_hostname_label,
            apptoml_telemetry_enable_service_label: $apptoml_telemetry_enable_service_label,
            apptoml_telemetry_prometheus_retention_time: $apptoml_telemetry_prometheus_retention_time,
            apptoml_telemetry_global_labels: $apptoml_telemetry_global_labels,
            apptoml_telemetry_metrics_sink: $apptoml_telemetry_metrics_sink,
            apptoml_telemetry_statsd_addr: $apptoml_telemetry_statsd_addr,
            apptoml_telemetry_datadog_hostname: $apptoml_telemetry_datadog_hostname,
            apptoml_beacon_kit_chain_spec: $apptoml_beacon_kit_chain_spec,
            apptoml_beacon_kit_chain_spec_file: $apptoml_beacon_kit_chain_spec_file,
            apptoml_beacon_kit_shutdown_timeout: $apptoml_beacon_kit_shutdown_timeout,
            apptoml_beacon_kit_engine_rpc_dial_url: $apptoml_beacon_kit_engine_rpc_dial_url,
            apptoml_beacon_kit_engine_rpc_timeout: $apptoml_beacon_kit_engine_rpc_timeout,
            apptoml_beacon_kit_engine_rpc_retry_interval: $apptoml_beacon_kit_engine_rpc_retry_interval,
            apptoml_beacon_kit_engine_rpc_max_retry_interval: $apptoml_beacon_kit_engine_rpc_max_retry_interval,
            apptoml_beacon_kit_engine_rpc_startup_check_interval: $apptoml_beacon_kit_engine_rpc_startup_check_interval,
            apptoml_beacon_kit_engine_rpc_jwt_refresh_interval: $apptoml_beacon_kit_engine_rpc_jwt_refresh_interval,
            apptoml_beacon_kit_engine_jwt_secret_path: $apptoml_beacon_kit_engine_jwt_secret_path,
            apptoml_beacon_kit_logger_time_format: $apptoml_beacon_kit_logger_time_format,
            apptoml_beacon_kit_logger_log_level: $apptoml_beacon_kit_logger_log_level,
            apptoml_beacon_kit_logger_style: $apptoml_beacon_kit_logger_style,
            apptoml_beacon_kit_kzg_trusted_setup_path: $apptoml_beacon_kit_kzg_trusted_setup_path,
            apptoml_beacon_kit_kzg_implementation: $apptoml_beacon_kit_kzg_implementation,
            apptoml_beacon_kit_payload_builder_enabled: $apptoml_beacon_kit_payload_builder_enabled,
            apptoml_beacon_kit_payload_builder_suggested_fee_recipient: $apptoml_beacon_kit_payload_builder_suggested_fee_recipient,
            apptoml_beacon_kit_payload_builder_payload_timeout: $apptoml_beacon_kit_payload_builder_payload_timeout,
            apptoml_beacon_kit_validator_graffiti: $apptoml_beacon_kit_validator_graffiti,
            apptoml_beacon_kit_validator_availability_window: $apptoml_beacon_kit_validator_availability_window,
            apptoml_beacon_kit_node_api_enabled: $apptoml_beacon_kit_node_api_enabled,
            apptoml_beacon_kit_node_api_address: $apptoml_beacon_kit_node_api_address,
            apptoml_beacon_kit_node_api_logging: $apptoml_beacon_kit_node_api_logging,
            configtoml_version: $configtoml_version,
            configtoml_proxy_app: $configtoml_proxy_app,
            configtoml_moniker: $configtoml_moniker,
            configtoml_db_backend: $configtoml_db_backend,
            configtoml_db_dir: $configtoml_db_dir,
            configtoml_log_level: $configtoml_log_level,
            configtoml_log_format: $configtoml_log_format,
            configtoml_genesis_file: $configtoml_genesis_file,
            configtoml_priv_validator_key_file: $configtoml_priv_validator_key_file,
            configtoml_priv_validator_state_file: $configtoml_priv_validator_state_file,
            configtoml_priv_validator_laddr: $configtoml_priv_validator_laddr,
            configtoml_node_key_file: $configtoml_node_key_file,
            configtoml_abci: $configtoml_abci,
            configtoml_filter_peers: $configtoml_filter_peers,
            configtoml_rpc_laddr: $configtoml_rpc_laddr,
            configtoml_rpc_unsafe: $configtoml_rpc_unsafe,
            configtoml_rpc_cors_allowed_origins: $configtoml_rpc_cors_allowed_origins,
            configtoml_rpc_cors_allowed_methods: $configtoml_rpc_cors_allowed_methods,
            configtoml_rpc_cors_allowed_headers: $configtoml_rpc_cors_allowed_headers,
            configtoml_rpc_max_open_connections: $configtoml_rpc_max_open_connections,
            configtoml_rpc_max_subscription_clients: $configtoml_rpc_max_subscription_clients,
            configtoml_rpc_max_subscriptions_per_client: $configtoml_rpc_max_subscriptions_per_client,
            configtoml_rpc_experimental_subscription_buffer_size: $configtoml_rpc_experimental_subscription_buffer_size,
            configtoml_rpc_experimental_websocket_write_buffer_size: $configtoml_rpc_experimental_websocket_write_buffer_size,
            configtoml_rpc_experimental_close_on_slow_client: $configtoml_rpc_experimental_close_on_slow_client,
            configtoml_rpc_timeout_broadcast_tx_commit: $configtoml_rpc_timeout_broadcast_tx_commit,
            configtoml_rpc_max_request_batch_size: $configtoml_rpc_max_request_batch_size,
            configtoml_rpc_max_body_bytes: $configtoml_rpc_max_body_bytes,
            configtoml_rpc_max_header_bytes: $configtoml_rpc_max_header_bytes,
            configtoml_rpc_tls_cert_file: $configtoml_rpc_tls_cert_file,
            configtoml_rpc_tls_key_file: $configtoml_rpc_tls_key_file,
            configtoml_rpc_pprof_laddr: $configtoml_rpc_pprof_laddr,
            configtoml_grpc_laddr: $configtoml_grpc_laddr,
            configtoml_grpc_version_service_enabled: $configtoml_grpc_version_service_enabled,
            configtoml_grpc_block_service_enabled: $configtoml_grpc_block_service_enabled,
            configtoml_grpc_block_results_service_enabled: $configtoml_grpc_block_results_service_enabled,
            configtoml_grpc_privileged_laddr: $configtoml_grpc_privileged_laddr,
            configtoml_grpc_privileged_pruning_service_enabled: $configtoml_grpc_privileged_pruning_service_enabled,
            configtoml_p2p_laddr: $configtoml_p2p_laddr,
            configtoml_p2p_external_address: $configtoml_p2p_external_address,
            configtoml_p2p_seeds: $configtoml_p2p_seeds,
            configtoml_p2p_persistent_peers: $configtoml_p2p_persistent_peers,
            configtoml_p2p_addr_book_file: $configtoml_p2p_addr_book_file,
            configtoml_p2p_addr_book_strict: $configtoml_p2p_addr_book_strict,
            configtoml_p2p_max_num_inbound_peers: $configtoml_p2p_max_num_inbound_peers,
            configtoml_p2p_max_num_outbound_peers: $configtoml_p2p_max_num_outbound_peers,
            configtoml_p2p_unconditional_peer_ids: $configtoml_p2p_unconditional_peer_ids,
            configtoml_p2p_persistent_peers_max_dial_period: $configtoml_p2p_persistent_peers_max_dial_period,
            configtoml_p2p_flush_throttle_timeout: $configtoml_p2p_flush_throttle_timeout,
            configtoml_p2p_max_packet_msg_payload_size: $configtoml_p2p_max_packet_msg_payload_size,
            configtoml_p2p_send_rate: $configtoml_p2p_send_rate,
            configtoml_p2p_recv_rate: $configtoml_p2p_recv_rate,
            configtoml_p2p_pex: $configtoml_p2p_pex,
            configtoml_p2p_seed_mode: $configtoml_p2p_seed_mode,
            configtoml_p2p_private_peer_ids: $configtoml_p2p_private_peer_ids,
            configtoml_p2p_allow_duplicate_ip: $configtoml_p2p_allow_duplicate_ip,
            configtoml_p2p_handshake_timeout: $configtoml_p2p_handshake_timeout,
            configtoml_p2p_dial_timeout: $configtoml_p2p_dial_timeout,
            configtoml_mempool_type: $configtoml_mempool_type,
            configtoml_mempool_recheck: $configtoml_mempool_recheck,
            configtoml_mempool_recheck_timeout: $configtoml_mempool_recheck_timeout,
            configtoml_mempool_broadcast: $configtoml_mempool_broadcast,
            configtoml_mempool_wal_dir: $configtoml_mempool_wal_dir,
            configtoml_mempool_size: $configtoml_mempool_size,
            configtoml_mempool_max_tx_bytes: $configtoml_mempool_max_tx_bytes,
            configtoml_mempool_max_txs_bytes: $configtoml_mempool_max_txs_bytes,
            configtoml_mempool_cache_size: $configtoml_mempool_cache_size,
            configtoml_mempool_keep_invalid_txs_in_cache: $configtoml_mempool_keep_invalid_txs_in_cache,
            configtoml_mempool_experimental_max_gossip_connections_to_persistent_peers: $configtoml_mempool_experimental_max_gossip_connections_to_persistent_peers,
            configtoml_mempool_experimental_max_gossip_connections_to_non_persistent_peers: $configtoml_mempool_experimental_max_gossip_connections_to_non_persistent_peers,
            configtoml_statesync_enable: $configtoml_statesync_enable,
            configtoml_statesync_rpc_servers: $configtoml_statesync_rpc_servers,
            configtoml_statesync_trust_height: $configtoml_statesync_trust_height,
            configtoml_statesync_trust_hash: $configtoml_statesync_trust_hash,
            configtoml_statesync_trust_period: $configtoml_statesync_trust_period,
            configtoml_statesync_discovery_time: $configtoml_statesync_discovery_time,
            configtoml_statesync_temp_dir: $configtoml_statesync_temp_dir,
            configtoml_statesync_chunk_request_timeout: $configtoml_statesync_chunk_request_timeout,
            configtoml_statesync_chunk_fetchers: $configtoml_statesync_chunk_fetchers,
            configtoml_blocksync_version: $configtoml_blocksync_version,
            configtoml_consensus_wal_file: $configtoml_consensus_wal_file,
            configtoml_consensus_timeout_propose: $configtoml_consensus_timeout_propose,
            configtoml_consensus_timeout_propose_delta: $configtoml_consensus_timeout_propose_delta,
            configtoml_consensus_timeout_prevote: $configtoml_consensus_timeout_prevote,
            configtoml_consensus_timeout_prevote_delta: $configtoml_consensus_timeout_prevote_delta,
            configtoml_consensus_timeout_precommit: $configtoml_consensus_timeout_precommit,
            configtoml_consensus_timeout_precommit_delta: $configtoml_consensus_timeout_precommit_delta,
            configtoml_consensus_timeout_commit: $configtoml_consensus_timeout_commit,
            configtoml_consensus_skip_timeout_commit: $configtoml_consensus_skip_timeout_commit,
            configtoml_consensus_double_sign_check_height: $configtoml_consensus_double_sign_check_height,
            configtoml_consensus_create_empty_blocks: $configtoml_consensus_create_empty_blocks,
            configtoml_consensus_create_empty_blocks_interval: $configtoml_consensus_create_empty_blocks_interval,
            configtoml_consensus_peer_gossip_sleep_duration: $configtoml_consensus_peer_gossip_sleep_duration,
            configtoml_consensus_peer_gossip_intraloop_sleep_duration: $configtoml_consensus_peer_gossip_intraloop_sleep_duration,
            configtoml_consensus_peer_query_maj23_sleep_duration: $configtoml_consensus_peer_query_maj23_sleep_duration,
            configtoml_storage_discard_abci_responses: $configtoml_storage_discard_abci_responses,
            configtoml_storage_experimental_db_key_layout: $configtoml_storage_experimental_db_key_layout,
            configtoml_storage_compact: $configtoml_storage_compact,
            configtoml_storage_compaction_interval: $configtoml_storage_compaction_interval,
            configtoml_storage_pruning_interval: $configtoml_storage_pruning_interval,
            configtoml_storage_pruning_data_companion_enabled: $configtoml_storage_pruning_data_companion_enabled,
            configtoml_storage_pruning_data_companion_initial_block_retain_height: $configtoml_storage_pruning_data_companion_initial_block_retain_height,
            configtoml_storage_pruning_data_companion_initial_block_results_retain_height: $configtoml_storage_pruning_data_companion_initial_block_results_retain_height,
            configtoml_tx_index_indexer: $configtoml_tx_index_indexer,
            configtoml_tx_index_psql_conn: $configtoml_tx_index_psql_conn,
            configtoml_instrumentation_prometheus: $configtoml_instrumentation_prometheus,
            configtoml_instrumentation_prometheus_listen_addr: $configtoml_instrumentation_prometheus_listen_addr,
            configtoml_instrumentation_max_open_connections: $configtoml_instrumentation_max_open_connections,
            configtoml_instrumentation_namespace: $configtoml_instrumentation_namespace,
          }' > "${config_json_path}"

        if [[ $? -eq 0 ]]; then
            log_success "Beranode configuration written to ${config_json_path}"
        else
            log_error "Could not write configuration to ${config_json_path}"
            return 1
        fi
    fi

    # Check if kzg-trusted-setup.json exists, otherwise download it
    if [[ ! -f "${BERANODES_PATH}/tmp/kzg-trusted-setup.json" ]]; then
        log_info "Downloading kzg-trusted-setup.json to ${BERANODES_PATH}/tmp"
        echo "$REPO_BEACONKIT/kzg-trusted-setup.json"
        curl -s -o "${BERANODES_PATH}/tmp/kzg-trusted-setup.json" "$REPO_BEACONKIT/kzg-trusted-setup.json"
        if [[ $? -eq 0 ]]; then
            log_success "Downloaded kzg-trusted-setup.json successfully."
        else
            log_error "Failed to download kzg-trusted-setup.json."
            return 1
        fi
    else
        log_info "kzg-trusted-setup.json already exists in ${BERANODES_PATH}/tmp"
    fi

    # Generate eth-genesis.json file
    if [[ -f "${BERANODES_PATH}/tmp/eth-genesis.json" ]]; then
        log_success "Found eth-genesis.json at ${BERANODES_PATH}/tmp/eth-genesis.json"
    else
        log_warn "eth-genesis.json not found at ${BERANODES_PATH}/tmp/eth-genesis.json creating it..."

        # Generates a eth-genesis.json file that is shared with all nodes
        generate_eth_genesis_file \
          --genesis-file-path "${BERANODES_PATH}/tmp/eth-genesis.json" \
          --chain-id "${CHAIN_ID_DEVNET}" \
          --prague1-time ${ETH_GENESIS_PRAGUE1_TIME} \
          --prague1-base-fee-change-denominator ${ETH_GENESIS_PRAGUE1_BASE_FEE_CHANGE_DENOMINATOR} \
          --prague1-min-base-fee ${ETH_GENESIS_PRAGUE1_MIN_BASE_FEE} \
          --prague1-pol-distributor ${ETH_GENESIS_PRAGUE1_POL_DISTRIBUTOR} \
          --prague2-time ${ETH_GENESIS_PRAGUE2_TIME} \
          --prague2-min-base-fee ${ETH_GENESIS_PRAGUE2_MIN_BASE_FEE} \
          --prague3-time ${ETH_GENESIS_PRAGUE3_TIME} \
          --prague3-bex-vault ${ETH_GENESIS_PRAGUE3_BEX_VAULT} \
          --prague3-rescue-address ${ETH_GENESIS_PRAGUE3_RESCUE_ADDRESS} \
          --prague3-blocked-addresses ${ETH_GENESIS_PRAGUE3_BLOCKED_ADDRESSES} \
          --prague4-time ${ETH_GENESIS_PRAGUE4_TIME} \
          --eth-genesis-custom0-contract-address ${wallet_address} \
          --eth-genesis-custom0-contract-balance ${wallet_balance}
    fi

    # Genate private and public keys for nodes
    generate_beacond_keys \
      --config-dir "${BERANODES_PATH}" \
      --chain-spec "${network}"
    
    # Generate beacon-kit genesis.json file
    generate_beacond_genesis \
      --config-dir "${BERANODES_PATH}" \
      --chain-spec "${network}"
}


# =============================================================================
# start
# Source: commands/start.sh
# =============================================================================

cmd_start() {
    [[ "$DEBUG_MODE" == "true" ]] && echo "[DEBUG] Function: cmd_start" >&2
    print_header "Starting Beranode"
    local beranodes_config_path="${BERANODES_PATH}/beranodes.config.json"

    if ! [[ -f "${beranodes_config_path}" ]]; then
        log_error "Beranode configuration file does not exist: ${BERANODES_PATH}/beranodes.config.json"
        return 1
    fi

    # TODO add check for beradenodes.config.json

    print_header "Beranode Configuration"
    log_info "Configuration file: ${beranodes_config_path}"
    jq . "${beranodes_config_path}"

    local config_json_path="${BERANODES_PATH}/beranodes.config.json"
    local beranodes_dir=$(jq -r '.beranode_dir' "${config_json_path}")
    local bin_beacond="$beranodes_dir${BERANODES_PATH_BIN}/${BIN_BEACONKIT}"
    local bin_bera_reth="$beranodes_dir${BERANODES_PATH_BIN}/${BIN_BERARETH}"
    local moniker=$(jq -r '.moniker' "${config_json_path}")
    local network=$(jq -r '.network' "${config_json_path}")
    local validators=$(jq -r '.validators' "${config_json_path}")
    local full_nodes=$(jq -r '.full_nodes' "${config_json_path}")
    local pruned_nodes=$(jq -r '.pruned_nodes' "${config_json_path}")
    local total_nodes=$(jq -r '.total_nodes' "${config_json_path}")
    local beranode_dir=$(jq -r '.beranode_dir' "${config_json_path}")
    local skip_genesis=$(jq -r '.skip_genesis' "${config_json_path}")
    local force=$(jq -r '.force' "${config_json_path}")
    local mode=$(jq -r '.mode' "${config_json_path}")
    local wallet_private_key=$(jq -r '.wallet_private_key' "${config_json_path}")
    local wallet_address=$(jq -r '.wallet_address' "${config_json_path}")
    local nodes=$(jq -r '.nodes' "${config_json_path}")

    # # echo "nodes: ${nodes}"
    # for node in $(echo "${nodes}" | jq -c '.[]'); do
    #     echo "node: ${node}"
    #     echo "node role: $(echo "${node}" | jq -r '.role')"
    #     echo "node moniker: $(echo "${node}" | jq -r '.moniker')"
    #     echo "node network: $(echo "${node}" | jq -r '.network')"
    #     echo "node wallet_address: $(echo "${node}" | jq -r '.wallet_address')"
    #     echo "node ethrpc_port: $(echo "${node}" | jq -r '.ethrpc_port')"
    #     echo "node ethp2p_port: $(echo "${node}" | jq -r '.ethp2p_port')"
    #     echo "node ethproxy_port: $(echo "${node}" | jq -r '.ethproxy_port')"
    #     echo "node el_ethrpc_port: $(echo "${node}" | jq -r '.el_ethrpc_port')"
    #     echo "node el_authrpc_port: $(echo "${node}" | jq -r '.el_authrpc_port')"
    #     echo "node el_eth_port: $(echo "${node}" | jq -r '.el_eth_port')"
    #     echo "node el_prometheus_port: $(echo "${node}" | jq -r '.el_prometheus_port')"
    #     echo "node cl_prometheus_port: $(echo "${node}" | jq -r '.cl_prometheus_port')"
    # done

    # # Check if kzg-trusted-setup.json exists, otherwise download it
    # if [[ ! -f "${beranodes_dir}/tmp/kzg-trusted-setup.json" ]]; then
    #     log_info "Downloading kzg-trusted-setup.json to ${beranodes_dir}/tmp"
    #     echo "$REPO_BEACONKIT/kzg-trusted-setup.json"
    #     curl -s -o "${beranodes_dir}/tmp/kzg-trusted-setup.json" "$REPO_BEACONKIT/kzg-trusted-setup.json"
    #     if [[ $? -eq 0 ]]; then
    #         log_success "Downloaded kzg-trusted-setup.json successfully."
    #     else
    #         log_error "Failed to download kzg-trusted-setup.json."
    #         return 1
    #     fi
    # else
    #     log_info "kzg-trusted-setup.json already exists in ${beranodes_dir}/tmp"
    # fi

    # devnet logic
    if [[ "${network}" == "${CHAIN_NAME_DEVNET}" ]]; then
        log_info "Starting Beranode in ${CHAIN_NAME_DEVNET} mode"

        if [[ "${mode}" == "local" ]]; then
            log_info "Starting Beranode in local mode"

            for i in $(seq 1 ${validators}); do
              local validator_dir="${beranodes_dir}${BERANODES_PATH_NODES}/val-${i}"
              mkdir -p "${validator_dir}"
                create_validator_node "${beranodes_dir}" "${validator_dir}" "${moniker}-val-${i}" "${network}" "${wallet_address}" "${bin_beacond}" "${bin_bera_reth}" "${beranodes_dir}/tmp/kzg-trusted-setup.json" "${ethrpc_port}" "${ethp2p_port}" "${ethproxy_port}" "${el_ethrpc_port}" "${el_authrpc_port}" "${el_eth_port}" "${el_prometheus_port}" "${cl_prometheus_port}"
            done

        else
            log_error "Unsupported mode: ${mode}"
            return 1
        fi
    fi
}


# =============================================================================
# dispatcher
# Source: core/dispatcher.sh
# =============================================================================

show_help() {
    [[ "$DEBUG_MODE" == "true" ]] && echo "[DEBUG] Function: show_help" >&2
    cat <<EOF
beranode - CLI for managing Berachain nodes

USAGE:
    beranode <command> [options]

COMMANDS:
    init        Initialize a new Berachain node configuration
    start       Start the Berachain node
    help        Show this help message
    version     Show version information

OPTIONS:
    -h, --help     Show this help message
    -v, --version  Show version information

EXAMPLES:
    beranode init --network devnet --validators 1
    beranode start

For more information, visit: https://github.com/berachain/beranode-cli2
EOF
}

show_version() {
    [[ "$DEBUG_MODE" == "true" ]] && echo "[DEBUG] Function: show_version" >&2
    echo "beranode v${BERANODE_VERSION}"
}

show_interactive_menu() {
    [[ "$DEBUG_MODE" == "true" ]] && echo "[DEBUG] Function: show_interactive_menu" >&2
    cat <<EOF

Welcome to beranode CLI!

Please run 'beranode --help' to see available commands.

EOF
}

main() {
    [[ "$DEBUG_MODE" == "true" ]] && echo "[DEBUG] Function: main" >&2
    # No arguments - show interactive menu
    if [[ $# -eq 0 ]]; then
        show_interactive_menu
        exit 0
    fi

    local command="$1"
    shift

    case "$command" in
        -h|--help|help)
            show_help
            ;;
        -v|--version|version)
            show_version
            ;;
        init)
            cmd_init "$@"
            ;;
        start)
            cmd_start "$@"
            ;;
        # stop)
        #     stop_node "$@"
        #     ;;
        # restart)
        #     restart_node "$@"
        #     ;;
        # status)
        #     show_node_status
        #     ;;
        # logs)
        #     show_logs "$@"
        #     ;;
        # config)
        #     show_config
        #     ;;
        # update)
        #     update_node
        #     ;;
        *)
            log_error "Unknown command: ${command}"
            echo ""
            show_help
            exit 1
            ;;
    esac
    # return 0
}


# =============================================================================
# Entry Point - Main script execution
# =============================================================================

main "$@"
